# Круговая статистика и визуализация {#circular}



[Программный код главы](https://github.com/tsamsonov/r-geo-course/blob/master/code/08-StatisticsCircular.R)

## Введение {#circular-intro}

В географии направления играют огромную роль. Ветер, морские течения, тектоника плит, миграция элементов в ландшафтно-геохимических катенах, миграции населения, перелеты птиц --- все эти явления характеризуются прежде всего их направлением. Для того, чтобы эффективно анализировать такие данные, необходимо владеть специализированным математическим аппаратом. 

Обработкой данных о направлениях занимается особая область математической статистики — __статистика направлений__, или __круговая (циркулярная)__ статистика (Mardia, Jupp, 2000; Pewsey et al., 2013). В круговой статистике каждое направление $\theta$ представляется в виде вектора $x = (\cos \theta, sin \theta)$. Все операции производятся над подобными векторами и их координатами. Аналогом нормального распределения для круговой случайной величины является распределение фон Мизеса (von Mises, 1918), которое задается функцией плотности вероятности:
$$
f(θ)=\frac{1}{2 \pi I_0(\kappa)} e^{\kappa \cos (\theta - \mu)},
$$

где $\kappa \geq 0$ — параметр концентрации, $\mu$ — среднее значение (для $\kappa > 0$) и 

$$
I_p(\kappa) = \frac{1}{2π} \int_{0}^{2\pi} \cos (p \theta) e^{\kappa \cos θ} d \theta
$$
есть модифицированная функция Бесселя первого рода и порядка $p$. Из формул видно, что по своему эффекту параметр концентрации противоположен среднеквадратическому отклонению $\sigma$, которое является параметром нормального распределения. Чем больше значение $\kappa$, тем более сконцентрировано распределение относительно среднего значения — отсюда идет название этого параметра. Распределение фон Мизеса можно использовать при вычислении основных направлений методом ядерной оценки плотности распределения (оценки по методу Парзена-Розенблатта.

## Вычисление статистических моментов {#circular-stats}

Для вычисления статистических моментов круговой случайной величины требуется найти средний равнодействующий вектор первого порядка $R = (C, S)$, где $C = \frac{1}{n} \sum_{j=1}^{n} \cos \theta_j$, $S = \frac{1}{n} \sum_{j=1}^{n} \sin \theta_j$. Данный вектор имеет направление $\bar\theta$, которое является выборочным средним направлением исследуемой величины. Выборочная средняя равнодействующая длина $\bar R = \sqrt{C^2 + S^2}$ принимает значения в диапазоне $[0, 1]$ и показывает меру концентрации направлений относительно $\theta$. $\bar R = 1$ означает, что все исходные направления совпадают, $\bar R = 0$ --- что данные равномерно распределены по кругу, либо распределение имеет несколько мод, которые уравновешивают друг друга. Стандартное отклонение направлений $v$ в радианах может быть найдено как $v=\sqrt{-2 \ln \bar R}$ (Mardia, Jupp, 2000).

Величина $\bar R$ дает важную информацию для предварительной диагностики картины направлений каньонов. Если значение $\bar R$ близко к единице, это означает, что распределение является унимодальным и в качестве основного направления можно принять значение $\bar θ$. На практике, однако, такая ситуация в городах достаточно редка, поскольку для каждого выбранного участка характерно как минимум две моды направлений каньонов, что требует их явного выделения статистическими методами.

Данные о направлениях каньонов специфичны, поскольку противоположные направления эквивалентны. Такие данные в теории круговой статистики называются _аксиальными_ (Mardia, Jupp, 2000). Для аксиальных данных возможный диапазон значений лежит в интервале $[0, \pi)$. Поскольку методы круговой статистики рассчитаны на круговое замыкание данных, стандартный подход к обработке аксиальных данных предполагает переход от направлений к их удвоенным значениям $\theta' = 2\theta$, обработку полученных значений стандартными методами и отображение полученных значение обратно на интервал $[0, \pi)$. Для среднего, медианы и моды распределения это означает простое деление полученного значения пополам (Pewsey et al., 2013).

## Определение модальных направлений {#circular-modes}

Модальные направления могут быть определены как по гистограмме распределения, так и методом ядерной оценки. Основной вопрос поиска эффективного ядра заключается в параметризации функции $K$. Для распределения фон Мизеса таким параметром является концентрация $\kappa$. Чем больше этот параметр, тем более локализованной будет оценка, тем сильнее будут проявляться в ней существующие моды распределения, но также будут и выделяться новые моды, которые на самом деле не значимы. Малые значения $\kappa$ приведут, наоборот, к «размыванию» плотности распределения в пределах полного круга. Как и в случае с количеством интервалов гистограммы, избыточно малые и большие значения κ нежелательны. Показано, что оптимальное значение κ может быть подобрано также для оценки распределений, являющихся конечной суммой $M$ распределений фон Мизеса, то есть, мультимодальных распределений, имеющих плотность (Oliveira et al., 2012):
$$
g(\theta)=\sum_{i=1}^{M} \alpha_i \frac{\exp\lbrace{\kappa_i \cos(\theta - \mu_i)\rbrace}}{2 \pi I_0 (\kappa_i)},
$$
где $\sum_{i=1}^{M} = 1$.

Поскольку в результате подбора определяется не только параметр концентрации, но и число компонент в сумме распределений (Oliveira et al., 2014), его можно также использовать для определения количества искомых мод, если это необходимо. 
Когда подобрана функция ядра и ее параметры, оценка плотности распределения (вычисление функции $\circ f _h (x)$) для круговых данных делается либо для исходных направлений $\theta_j$, либо с равным (достаточно малым) интервалом — например, через 1 градус (Pewsey et al., 2013). После того как произведена оценка, для решения нашей задачи могут быть выбраны направления, в которых функция плотности распределения достигает локального максимума — первого и второго по величине.  Эти направления и будут соответствовать первой и второй моде распределения направлений городских каньонов.

## Визуализация круговой статистики {#circular-stats-vis}
