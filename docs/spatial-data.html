<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Визуализация и анализ географических данных на языке R</title>
  <meta name="description" content="Курс лекций, посвященных использованию языка программирования R для визуализации и анализа географических данных">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="Визуализация и анализ географических данных на языке R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Курс лекций, посвященных использованию языка программирования R для визуализации и анализа географических данных" />
  <meta name="github-repo" content="tsamsonov/r-geo-course" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Визуализация и анализ географических данных на языке R" />
  
  <meta name="twitter:description" content="Курс лекций, посвященных использованию языка программирования R для визуализации и анализа географических данных" />
  

<meta name="author" content="Тимофей Самсонов">


<meta name="date" content="2017-11-05">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="controls.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-0.9/htmlwidgets.js"></script>
<script src="libs/datatables-binding-0.2/datatables.js"></script>
<link href="libs/dt-core-1.10.12/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.12/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.12/js/jquery.dataTables.min.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Визуализация и анализ географических данных на языке R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Введение</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#-"><i class="fa fa-check"></i>Программное обеспечение</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#---"><i class="fa fa-check"></i>Установка и подключение пакетов</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#--"><i class="fa fa-check"></i>Выполнение программного кода</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#--"><i class="fa fa-check"></i>Установка рабочей директории</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#-"><i class="fa fa-check"></i>Диагностические функции</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#-"><i class="fa fa-check"></i>Получение справки</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#d09ad0bed0bcd0bcd0b5d0bdd182d0b0d180d0b8d0b8"><i class="fa fa-check"></i>Комментарии</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#----r"><i class="fa fa-check"></i>Стандарт оформления кода на R</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#-"><i class="fa fa-check"></i>Зарезервированные слова</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#-"><i class="fa fa-check"></i>Названия переменных</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#--"><i class="fa fa-check"></i>Названия специальных символов</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#--"><i class="fa fa-check"></i>Ссылка на пособие</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="data-types.html"><a href="data-types.html"><i class="fa fa-check"></i><b>1</b> Типы данных, ввод и вывод</a><ul>
<li class="chapter" data-level="1.1" data-path="data-types.html"><a href="data-types.html#numbers"><i class="fa fa-check"></i><b>1.1</b> Числа</a><ul>
<li class="chapter" data-level="1.1.1" data-path="data-types.html"><a href="data-types.html#number_functions"><i class="fa fa-check"></i><b>1.1.1</b> Числовые функции</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="data-types.html"><a href="data-types.html#strings"><i class="fa fa-check"></i><b>1.2</b> Строки</a></li>
<li class="chapter" data-level="1.3" data-path="data-types.html"><a href="data-types.html#dates"><i class="fa fa-check"></i><b>1.3</b> Даты</a></li>
<li class="chapter" data-level="1.4" data-path="data-types.html"><a href="data-types.html#booleans"><i class="fa fa-check"></i><b>1.4</b> Логические</a></li>
<li class="chapter" data-level="1.5" data-path="data-types.html"><a href="data-types.html#determine_data_type"><i class="fa fa-check"></i><b>1.5</b> Определение типа данных</a></li>
<li class="chapter" data-level="1.6" data-path="data-types.html"><a href="data-types.html#---conversion"><i class="fa fa-check"></i><b>1.6</b> Преобразование типов данных {conversion}</a></li>
<li class="chapter" data-level="1.7" data-path="data-types.html"><a href="data-types.html#read_write_console"><i class="fa fa-check"></i><b>1.7</b> Ввод и вывод данных в консоли</a></li>
<li class="chapter" data-level="1.8" data-path="data-types.html"><a href="data-types.html#questions_tasks_basics"><i class="fa fa-check"></i><b>1.8</b> Контрольные вопросы и задачи</a><ul>
<li class="chapter" data-level="1.8.1" data-path="data-types.html"><a href="data-types.html#questions_basics"><i class="fa fa-check"></i><b>1.8.1</b> Вопросы</a></li>
<li class="chapter" data-level="1.8.2" data-path="data-types.html"><a href="data-types.html#tasks_basics"><i class="fa fa-check"></i><b>1.8.2</b> Задачи</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-structures.html"><a href="data-structures.html"><i class="fa fa-check"></i><b>2</b> Структуры данных</a><ul>
<li class="chapter" data-level="2.1" data-path="data-structures.html"><a href="data-structures.html#section-2.1"><i class="fa fa-check"></i><b>2.1</b> Векторы</a><ul>
<li class="chapter" data-level="2.1.1" data-path="data-structures.html"><a href="data-structures.html#vector_creation"><i class="fa fa-check"></i><b>2.1.1</b> Создание вектора</a></li>
<li class="chapter" data-level="2.1.2" data-path="data-structures.html"><a href="data-structures.html#vector_elements"><i class="fa fa-check"></i><b>2.1.2</b> Работа с элементами вектора</a></li>
<li class="chapter" data-level="2.1.3" data-path="data-structures.html"><a href="data-structures.html#vector_transform"><i class="fa fa-check"></i><b>2.1.3</b> Анализ и преобразования векторов</a></li>
<li class="chapter" data-level="2.1.4" data-path="data-structures.html"><a href="data-structures.html#vector_search_sorting"><i class="fa fa-check"></i><b>2.1.4</b> Поиск и сортировка элементов</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-structures.html"><a href="data-structures.html#matrices"><i class="fa fa-check"></i><b>2.2</b> Матрицы</a></li>
<li class="chapter" data-level="2.3" data-path="data-structures.html"><a href="data-structures.html#arrays"><i class="fa fa-check"></i><b>2.3</b> Массивы</a></li>
<li class="chapter" data-level="2.4" data-path="data-structures.html"><a href="data-structures.html#data_frames"><i class="fa fa-check"></i><b>2.4</b> Фреймы данных</a></li>
<li class="chapter" data-level="2.5" data-path="data-structures.html"><a href="data-structures.html#lists"><i class="fa fa-check"></i><b>2.5</b> Списки</a></li>
<li class="chapter" data-level="2.6" data-path="data-structures.html"><a href="data-structures.html#section-2.6"><i class="fa fa-check"></i><b>2.6</b> Факторы</a></li>
<li class="chapter" data-level="2.7" data-path="data-structures.html"><a href="data-structures.html#questions_tasks_vectors"><i class="fa fa-check"></i><b>2.7</b> Контрольные вопросы и задачи</a><ul>
<li class="chapter" data-level="2.7.1" data-path="data-structures.html"><a href="data-structures.html#questions_vectors"><i class="fa fa-check"></i><b>2.7.1</b> Вопросы</a></li>
<li class="chapter" data-level="2.7.2" data-path="data-structures.html"><a href="data-structures.html#tasks_vectors"><i class="fa fa-check"></i><b>2.7.2</b> Задачи</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tables.html"><a href="tables.html"><i class="fa fa-check"></i><b>3</b> Работа с таблицами</a><ul>
<li class="chapter" data-level="3.1" data-path="tables.html"><a href="tables.html#reading_tables"><i class="fa fa-check"></i><b>3.1</b> Чтение таблиц</a><ul>
<li class="chapter" data-level="3.1.1" data-path="tables.html"><a href="tables.html#reading_csv"><i class="fa fa-check"></i><b>3.1.1</b> Таблицы CSV</a></li>
<li class="chapter" data-level="3.1.2" data-path="tables.html"><a href="tables.html#excel_reading"><i class="fa fa-check"></i><b>3.1.2</b> Таблицы Microsoft Excel</a></li>
<li class="chapter" data-level="3.1.3" data-path="tables.html"><a href="tables.html#excel_read_types"><i class="fa fa-check"></i><b>3.1.3</b> Типы данных столбцов</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="tables.html"><a href="tables.html#view_table"><i class="fa fa-check"></i><b>3.2</b> Просмотр таблицы</a></li>
<li class="chapter" data-level="3.3" data-path="tables.html"><a href="tables.html#working_with_columns"><i class="fa fa-check"></i><b>3.3</b> Работа со столбцами</a><ul>
<li class="chapter" data-level="3.3.1" data-path="tables.html"><a href="tables.html#colnames"><i class="fa fa-check"></i><b>3.3.1</b> Названия столбцов</a></li>
<li class="chapter" data-level="3.3.2" data-path="tables.html"><a href="tables.html#col_calling"><i class="fa fa-check"></i><b>3.3.2</b> Обращение к столбцам</a></li>
<li class="chapter" data-level="3.3.3" data-path="tables.html"><a href="tables.html#col_select"><i class="fa fa-check"></i><b>3.3.3</b> Выбор и исключение столбцов</a></li>
<li class="chapter" data-level="3.3.4" data-path="tables.html"><a href="tables.html#----col_add"><i class="fa fa-check"></i><b>3.3.4</b> Добавление и вычисление столбцов {col_add}</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="tables.html"><a href="tables.html#filtering_sorting"><i class="fa fa-check"></i><b>3.4</b> Сортировка и фильтрация</a><ul>
<li class="chapter" data-level="3.4.1" data-path="tables.html"><a href="tables.html#table_sorting"><i class="fa fa-check"></i><b>3.4.1</b> Сортировка</a></li>
<li class="chapter" data-level="3.4.2" data-path="tables.html"><a href="tables.html#table_filtering"><i class="fa fa-check"></i><b>3.4.2</b> Фильтрация</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="tables.html"><a href="tables.html#missed_values"><i class="fa fa-check"></i><b>3.5</b> Пропущенные значения</a></li>
<li class="chapter" data-level="3.6" data-path="tables.html"><a href="tables.html#data_conversion"><i class="fa fa-check"></i><b>3.6</b> Преобразование типов и поиск ошибок</a></li>
<li class="chapter" data-level="3.7" data-path="tables.html"><a href="tables.html#table_writing"><i class="fa fa-check"></i><b>3.7</b> Сохранение таблиц</a></li>
<li class="chapter" data-level="3.8" data-path="tables.html"><a href="tables.html#dplyr"><i class="fa fa-check"></i><b>3.8</b> Обработка таблиц в dplyr</a></li>
<li class="chapter" data-level="3.9" data-path="tables.html"><a href="tables.html#table_rules"><i class="fa fa-check"></i><b>3.9</b> Правила подготовки таблиц для чтения в R</a></li>
<li class="chapter" data-level="3.10" data-path="tables.html"><a href="tables.html#questions_tasks_tables"><i class="fa fa-check"></i><b>3.10</b> Контрольные вопросы и задачи</a><ul>
<li class="chapter" data-level="3.10.1" data-path="tables.html"><a href="tables.html#questions_tables"><i class="fa fa-check"></i><b>3.10.1</b> Вопросы</a></li>
<li class="chapter" data-level="3.10.2" data-path="tables.html"><a href="tables.html#tasks_tables"><i class="fa fa-check"></i><b>3.10.2</b> Задачи</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="graphics.html"><a href="graphics.html"><i class="fa fa-check"></i><b>4</b> Основы графики в R</a><ul>
<li class="chapter" data-level="4.1" data-path="graphics.html"><a href="graphics.html#yfxcharts"><i class="fa fa-check"></i><b>4.1</b> Стандартные графики</a><ul>
<li class="chapter" data-level="4.1.1" data-path="graphics.html"><a href="graphics.html#scatterplots"><i class="fa fa-check"></i><b>4.1.1</b> Диаграммы рассеяния</a></li>
<li class="chapter" data-level="4.1.2" data-path="graphics.html"><a href="graphics.html#linear_graphs"><i class="fa fa-check"></i><b>4.1.2</b> Линейные графики</a></li>
<li class="chapter" data-level="4.1.3" data-path="graphics.html"><a href="graphics.html#graph_combining"><i class="fa fa-check"></i><b>4.1.3</b> Совмещение графиков</a></li>
<li class="chapter" data-level="4.1.4" data-path="graphics.html"><a href="graphics.html#func_parameters"><i class="fa fa-check"></i><b>4.1.4</b> Функциональные параметры</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="graphics.html"><a href="graphics.html#histograms"><i class="fa fa-check"></i><b>4.2</b> Гистограммы</a></li>
<li class="chapter" data-level="4.3" data-path="graphics.html"><a href="graphics.html#barplots"><i class="fa fa-check"></i><b>4.3</b> Столбчатые графики</a></li>
<li class="chapter" data-level="4.4" data-path="graphics.html"><a href="graphics.html#piecharts"><i class="fa fa-check"></i><b>4.4</b> Круговые (секторные) диаграммы</a></li>
<li class="chapter" data-level="4.5" data-path="graphics.html"><a href="graphics.html#colors"><i class="fa fa-check"></i><b>4.5</b> Цвет и прозрачность</a></li>
<li class="chapter" data-level="4.6" data-path="graphics.html"><a href="graphics.html#disp_settings"><i class="fa fa-check"></i><b>4.6</b> Настройки отображения</a><ul>
<li class="chapter" data-level="4.6.1" data-path="graphics.html"><a href="graphics.html#graph_params"><i class="fa fa-check"></i><b>4.6.1</b> Графические параметры</a></li>
<li class="chapter" data-level="4.6.2" data-path="graphics.html"><a href="graphics.html#axes"><i class="fa fa-check"></i><b>4.6.2</b> Разметка осей, рамка, сетка координат и произвольные линии</a></li>
<li class="chapter" data-level="4.6.3" data-path="graphics.html"><a href="graphics.html#annotations"><i class="fa fa-check"></i><b>4.6.3</b> Аннотации данных (текст на графике)</a></li>
</ul></li>
<li class="chapter" data-level="4.7" data-path="graphics.html"><a href="graphics.html#legend"><i class="fa fa-check"></i><b>4.7</b> Легенда</a></li>
<li class="chapter" data-level="4.8" data-path="graphics.html"><a href="graphics.html#questions_tasks_graphics"><i class="fa fa-check"></i><b>4.8</b> Контрольные вопросы и задачи</a><ul>
<li class="chapter" data-level="4.8.1" data-path="graphics.html"><a href="graphics.html#questions_graphics"><i class="fa fa-check"></i><b>4.8.1</b> Вопросы</a></li>
<li class="chapter" data-level="4.8.2" data-path="graphics.html"><a href="graphics.html#tasks_graphics"><i class="fa fa-check"></i><b>4.8.2</b> Задачи</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="controls.html"><a href="controls.html"><i class="fa fa-check"></i><b>5</b> Управление выполнением и векторизованные вычисления</a><ul>
<li class="chapter" data-level="5.1" data-path="controls.html"><a href="controls.html#cycles"><i class="fa fa-check"></i><b>5.1</b> Циклы</a></li>
<li class="chapter" data-level="5.2" data-path="controls.html"><a href="controls.html#ifelse"><i class="fa fa-check"></i><b>5.2</b> Условия</a></li>
<li class="chapter" data-level="5.3" data-path="controls.html"><a href="controls.html#functions"><i class="fa fa-check"></i><b>5.3</b> Функции</a></li>
<li class="chapter" data-level="5.4" data-path="controls.html"><a href="controls.html#vectorized"><i class="fa fa-check"></i><b>5.4</b> Векторизованые вычисления</a></li>
<li class="chapter" data-level="5.5" data-path="controls.html"><a href="controls.html#questions_tasks_controls"><i class="fa fa-check"></i><b>5.5</b> Контрольные вопросы и задачи</a><ul>
<li class="chapter" data-level="5.5.1" data-path="controls.html"><a href="controls.html#questions_controls"><i class="fa fa-check"></i><b>5.5.1</b> Вопросы</a></li>
<li class="chapter" data-level="5.5.2" data-path="controls.html"><a href="controls.html#tasks_controls"><i class="fa fa-check"></i><b>5.5.2</b> Задачи</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="spatial-data.html"><a href="spatial-data.html"><i class="fa fa-check"></i><b>6</b> Пространственные данные</a><ul>
<li class="chapter" data-level="6.1" data-path="spatial-data.html"><a href="spatial-data.html#spatial_models"><i class="fa fa-check"></i><b>6.1</b> Модели пространственных данных</a><ul>
<li class="chapter" data-level="6.1.1" data-path="spatial-data.html"><a href="spatial-data.html#simple_features"><i class="fa fa-check"></i><b>6.1.1</b> Векторные данные</a></li>
<li class="chapter" data-level="6.1.2" data-path="spatial-data.html"><a href="spatial-data.html#raster_data"><i class="fa fa-check"></i><b>6.1.2</b> Растровые данные</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="spatial-data.html"><a href="spatial-data.html#spatial_relations"><i class="fa fa-check"></i><b>6.2</b> Пространственные отношения</a></li>
<li class="chapter" data-level="6.3" data-path="spatial-data.html"><a href="spatial-data.html#spatref"><i class="fa fa-check"></i><b>6.3</b> Пространственная привязка</a><ul>
<li class="chapter" data-level="6.3.1" data-path="spatial-data.html"><a href="spatial-data.html#spatref_components"><i class="fa fa-check"></i><b>6.3.1</b> Компоненты пространственной привязки</a></li>
<li class="chapter" data-level="6.3.2" data-path="spatial-data.html"><a href="spatial-data.html#spatref_formats"><i class="fa fa-check"></i><b>6.3.2</b> Форматы описания пространственной привязки</a></li>
<li class="chapter" data-level="6.3.3" data-path="spatial-data.html"><a href="spatial-data.html#spatref_transform"><i class="fa fa-check"></i><b>6.3.3</b> Преобразование координат</a></li>
</ul></li>
<li class="chapter" data-level="6.4" data-path="spatial-data.html"><a href="spatial-data.html#vector_data_r"><i class="fa fa-check"></i><b>6.4</b> Векторные данные</a><ul>
<li class="chapter" data-level="6.4.1" data-path="index.html"><a href="index.html#-"><i class="fa fa-check"></i><b>6.4.1</b> Базовые библиотеки</a></li>
<li class="chapter" data-level="6.4.2" data-path="index.html"><a href="index.html#--"><i class="fa fa-check"></i><b>6.4.2</b> Чтение векторных данных</a></li>
<li class="chapter" data-level="6.4.3" data-path="index.html"><a href="index.html#-"><i class="fa fa-check"></i><b>6.4.3</b> Внутренняя структура</a></li>
<li class="chapter" data-level="6.4.4" data-path="index.html"><a href="index.html#--"><i class="fa fa-check"></i><b>6.4.4</b> Базовые возможности отображения</a></li>
<li class="chapter" data-level="6.4.5" data-path="spatial-data.html"><a href="spatial-data.html#section-6.4.5"><i class="fa fa-check"></i><b>6.4.5</b> Проецирование</a></li>
<li class="chapter" data-level="6.4.6" data-path="index.html"><a href="index.html#--"><i class="fa fa-check"></i><b>6.4.6</b> Операции с атрибутами</a></li>
<li class="chapter" data-level="6.4.7" data-path="index.html"><a href="index.html#--"><i class="fa fa-check"></i><b>6.4.7</b> Операции с геометрией</a></li>
<li class="chapter" data-level="6.4.8" data-path="index.html"><a href="index.html#---"><i class="fa fa-check"></i><b>6.4.8</b> Детали работы с геометрией</a></li>
</ul></li>
<li class="chapter" data-level="6.5" data-path="spatial-data.html"><a href="spatial-data.html#raster_data_r"><i class="fa fa-check"></i><b>6.5</b> Растровые данные</a><ul>
<li class="chapter" data-level="6.5.1" data-path="spatial-data.html"><a href="spatial-data.html#section-6.5.1"><i class="fa fa-check"></i><b>6.5.1</b> Чтение</a></li>
<li class="chapter" data-level="6.5.2" data-path="spatial-data.html"><a href="spatial-data.html#--1"><i class="fa fa-check"></i><b>6.5.2</b> Внутренняя структура</a></li>
<li class="chapter" data-level="6.5.3" data-path="index.html"><a href="index.html#--"><i class="fa fa-check"></i><b>6.5.3</b> Базовые возможности визуализации</a></li>
<li class="chapter" data-level="6.5.4" data-path="spatial-data.html"><a href="spatial-data.html#-1"><i class="fa fa-check"></i><b>6.5.4</b> Проецирование</a></li>
<li class="chapter" data-level="6.5.5" data-path="index.html"><a href="index.html#--"><i class="fa fa-check"></i><b>6.5.5</b> Операции со значениями</a></li>
<li class="chapter" data-level="6.5.6" data-path="spatial-data.html"><a href="spatial-data.html#---1"><i class="fa fa-check"></i><b>6.5.6</b> Операции с геометрией</a></li>
</ul></li>
<li class="chapter" data-level="6.6" data-path="spatial-data.html"><a href="spatial-data.html#questions_tasks_spatial"><i class="fa fa-check"></i><b>6.6</b> Контрольные вопросы и задачи</a><ul>
<li class="chapter" data-level="6.6.1" data-path="spatial-data.html"><a href="spatial-data.html#questions_spatial"><i class="fa fa-check"></i><b>6.6.1</b> Вопросы</a></li>
<li class="chapter" data-level="6.6.2" data-path="spatial-data.html"><a href="spatial-data.html#tasks_spatial"><i class="fa fa-check"></i><b>6.6.2</b> Задачи</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://istina.msu.ru/profile/tsamsonov/" target="blank">Тимофей Самсонов</a></li>
<li><a href="https://doi.org/10.5281/zenodo.901911"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.901911.svg" title="DOI"></a><li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Визуализация и анализ географических данных на языке R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="spatial_data" class="section level1">
<h1><span class="header-section-number">Глава 6</span> Пространственные данные</h1>
<p><strong>Необходимые пакеты:</strong> <code>sf, raster, dplyr, RColorBrewer</code></p>
<p>Данный модуль посвящен введению в работу с пространственными данными в R. Рассмотрены общие вопросы моделирования реального мира средствами моделей пространственных данных. Рассматривается чтение векторных и растровых данных, их визуализация стандартными средствами.</p>
<div id="spatial_models" class="section level2">
<h2><span class="header-section-number">6.1</span> Модели пространственных данных</h2>
<p><strong>Пространственные данные</strong> — это данные о пространственных объектах и их наборах. В свою очередь, пространственный объект определяется как <em>цифровая модель материального или абстрактного объекта реального или виртуального мира с указанием его идентификатора, координатных и атрибутивных данных</em>.<a href="#fn3" class="footnoteRef" id="fnref3"><sup>3</sup></a></p>
<p>Если говорить по сути, то пространственные данные можно определить как <em>данные о географических объектах или явлениях, фиксирующие их местоположение и/или распределение в системе координат, привязанной к телу Земли или любого другого небесного тела</em>. Таким образом, отличительной особенностью пространственных данных перед непространственными является координатное описание местоположения. Важно знать отличия между векторной и растровой моделью пространственных данных.</p>
<p><strong>Векторная модель</strong> пространственных данных включает описание координатных данных пространственных объектов и, возможно, топологических отношений между ними. Векторные данные фиксируют местоположение и форму объектов в виде геометрических примитивов, таких как точки, линии, полигоны, объемные тела. Выбор модели объекта (например, представить город точкой или полигоном) зависит от масштаба анализа и целей исследования. Векторная модель данных является объектно-ориентированной.</p>
<p><strong>Растровая модель</strong> описывает не объекты, а пространственное распределение некоторой (выбранной исследователем) характеристики. Пространство разбивается регулярной сеткой ячеек, в каждой ячейке фиксируется значение исследуемого параметра (путем статистического осреднения, семплирования в центре ячейки и т.п.). Растровые данные могут быть как количественными (например, поле температуры), так и качественными (например, растр классифицированного снимка, каждая ячейка которого фиксирует принадлежность к тому или иному типу объекта). Таким образом, растровая модель является пространственно-ориентированной (или феномен-ориентированной).</p>
<p>Существуют и другие модели пространственных данных, однако их рассмотрение выходит за рамки настоящей лекции.</p>
<p>В настоящей лекции мы познакомимся с чтением и визуализацией пространственных данных в векторном и растровом формате, а также рассмотрим вопросы связанные с использованием картографических проекций.</p>
<div id="simple_features" class="section level3">
<h3><span class="header-section-number">6.1.1</span> Векторные данные</h3>
<p><strong>Simple Features</strong> (официально <em>Simple Features Access</em>) — это стандарт <a href="http://www.opengeospatial.org/standards/sfa">OGC 06-103</a>, разработанный Open Geospatial Consortium (OGC) и реализованный также в виде международного стандарта <a href="https://www.iso.org/standard/40114.html">ISO 19125</a>, который определяет общую модель хранения и доступа к векторным объектам (точка, линия, многоугольник, мульти точечные, мультилинии и т. д.), в географических информационных системах.</p>
<p>Геометрическое представление пространственных объектов базируется на следующих принципах:</p>
<ul>
<li>Все геометрии состоят из точек.</li>
<li>Точки являются координатами в 2-, 3- или 4-мерном пространстве.</li>
<li>Все точки в геометрии имеют одинаковую размерность.</li>
</ul>
<p>В дополнение к координатам <span class="math inline">\(X\)</span> и <span class="math inline">\(Y\)</span> имеются два дополнительных дополнительных параметра:</p>
<ul>
<li>координата <span class="math inline">\(Z\)</span>, обозначающая высоту</li>
<li>координата <span class="math inline">\(M\)</span>, обозначающая некоторую меру, связанную с точкой, а не с признаком в целом (в этом случае это будет атрибут объекта).</li>
</ul>
<p>Измерение <span class="math inline">\(M\)</span> может быть использовано, например, для представления времени или линейных координат (для маршрутов).</p>
<p>Координаты простой геометрии всегда содержат компоненты <span class="math inline">\(X\)</span> и <span class="math inline">\(Y\)</span>, поэтому все разнообразие возможных представлений определяется наличием или отсутствием дополнительных измерений <span class="math inline">\(Z\)</span> и <span class="math inline">\(M\)</span> Таким образом, получаем <strong>четыре</strong> варианта геометрии:</p>
<ul>
<li>двумерные точки <span class="math inline">\(XY\)</span></li>
<li>трехмерные точки <span class="math inline">\(XYZ\)</span></li>
<li>трехмерные точки <span class="math inline">\(XYM\)</span></li>
<li>четырехмерные точки <span class="math inline">\(XYZM\)</span></li>
</ul>
<p>В случае использования широт и долгот <span class="math inline">\(X\)</span> соответствует долготе, <span class="math inline">\(Y\)</span> соответствует широте.</p>
<p>Всего стандарт <strong>Simple Features</strong> включает в себя 17 типов геометрий. Из них наиболее употребительными являются следующие 7:</p>
<table>
<colgroup>
<col width="5%" />
<col width="94%" />
</colgroup>
<thead>
<tr class="header">
<th>Тип</th>
<th>Описание</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>POINT</code></td>
<td>нуль-мерная геометрия, содержащая одну точку</td>
</tr>
<tr class="even">
<td><code>LINESTRING</code></td>
<td>последовательность точек, соединенных прямыми, несамопересекающимися отрезками; одномерная геометрия</td>
</tr>
<tr class="odd">
<td><code>POLYGON</code></td>
<td>геометрия с положительной площадью (двумерная); последовательность точек, отрезки между которыми формируют замкнутое кольцо без самопересечений; первое кольцо является внешним, ноль и более остальных колец представляют дырки внетри полигона</td>
</tr>
<tr class="even">
<td><code>MULTIPOINT</code></td>
<td>множество точек; геометрия типа <code>MULTIPOINT</code> называется <em>простой</em> если ни одна пара точек в <code>MULTIPOINT</code> не совпадает</td>
</tr>
<tr class="odd">
<td><code>MULTILINESTRING</code></td>
<td>множество линий</td>
</tr>
<tr class="even">
<td><code>MULTIPOLYGON</code></td>
<td>множество полигонов</td>
</tr>
<tr class="odd">
<td><code>GEOMETRYCOLLECTION</code></td>
<td>множество геометрий произвольного типа за исключением <code>GEOMETRYCOLLECTION</code></td>
</tr>
</tbody>
</table>
<p>Примеры различных видов геометрий представлены на рисунке ниже:</p>
<p><img src="07-SpatialData_files/figure-html/unnamed-chunk-2-1.png" width="1536" /></p>
<p>Оставшиеся виды геометрий <em>Simple Features</em> включают: <code>CIRCULARSTRING</code>, <code>COMPOUNDCURVE</code>, <code>CURVEPOLYGON</code>, <code>MULTICURVE</code>, <code>MULTISURFACE</code>, <code>CURVE</code>, <code>SURFACE</code>, <code>POLYHEDRALSURFACE</code>, <code>TIN</code>, <code>TRIANGLE</code>.</p>
<p>Существует два официально закрепленных формата представления SF: <em>Well-Known Text (WKT)</em> и <em>Well-Known Binary (WKB)</em>, которые необходимы для чтения таких данных человеком и машиной соответственно.</p>
<p><strong>Well-Known Text (WKT)</strong> — стандарт представления геометрии в виде множества списков координат, в которых координаты вершин разделены пробелами, вершины разделены запятыми, а компоненты полигонов и мультигеометрий заключены в круглые скобки и также разделены запятыми. Вышеприведенной картинке соответствуют следующие строки <em>WKT</em>:</p>
<pre><code>## MULTIPOINT (3.2 4, 3 4.6, 3.8 4.4, 3.5 3.8, 3.4 3.6, 3.9 4.5)
## LINESTRING (0 3, 0 4, 1 5, 2 5)
## MULTILINESTRING ((0 3, 0 4, 1 5, 2 5), (0.2 3, 0.2 4, 1 4.8, 2 4.8), (0 4.4, 0.6 5))
## POLYGON ((0 0, 1 0, 3 2, 2 4, 1 4, 0 0), (1 1, 1 2, 2 2, 1 1))
## MULTIPOLYGON (((0 0, 1 0, 3 2, 2 4, 1 4, 0 0), (1 1, 1 2, 2 2, 1 1)), ((3 0, 4 0, 4 1, 3 1, 3 0), (3.3 0.3, 3.3 0.8, 3.8 0.8, 3.8 0.3, 3.3 0.3)), ((3 3, 4 2, 4 3, 3 3)))
## GEOMETRYCOLLECTION (MULTIPOINT (3.2 4, 3 4.6, 3.8 4.4, 3.5 3.8, 3.4 3.6, 3.9 4.5), MULTIPOLYGON (((0 0, 1 0, 3 2, 2 4, 1 4, 0 0), (1 1, 1 2, 2 2, 1 1)), ((3 0, 4 0, 4 1, 3 1, 3 0), (3.3 0.3, 3.3 0.8, 3.8 0.8, 3.8 0.3, 3.3 0.3)), ((3 3, 4 2, 4 3, 3 3))), LINESTRING (0 3, 0 4, 1 5, 2 5))</code></pre>
<p><strong>Well-Known Binary (WKB)</strong> — бинарный формат хранения координат. Именно этот формат фактически используется в базах данных, поскольку он обеспечивает высокую скорость чтения и записи данных (в отлиие от текстового). Однако внешний вид данных в формате WKB мало о чем говорит человеку, поскольку он предназначен для чтения компьютером. Например, вышеприведенная строка <code>LINESTRING</code> будет выглядеть так:</p>
<pre><code>## 01 02 00 00 00 04 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 08 40 00 00 00 00 00 00 00 00 00 00 00 00 00 00 10 40 00 00 00 00 00 00 f0 3f 00 00 00 00 00 00 14 40 00 00 00 00 00 00 00 40 00 00 00 00 00 00 14 40</code></pre>
</div>
<div id="raster_data" class="section level3">
<h3><span class="header-section-number">6.1.2</span> Растровые данные</h3>
<p><strong>Растр</strong> представляет из себя матрицу значений. Каждой ячейке матрицы соответствует прямоугольная пространственная область фиксированного размера, которая называется <em>пикселом</em>. Различают растры <em>непрерывные</em> и <em>категориальные (классифицированные)</em>. Также необходимо разделять <em>одноканальные</em> и <em>многоканальные растры</em>. Примером одноканального растра является цифровая модель рельфа. В виде многоканальных растров часто представляют космические снимки.</p>
<p>В отличие от векторных данных, которые требут указания координат для каждой вершины, регулярно-ячеистый характер растровой модели позволяет вычислять координаты пикселов на основе их индексов. Поэтому фактически растровые данные хранятся в виде линейно упорядоченного списка значений <em>(raster values)</em> и описания геометрии растра <em>(raster geometry)</em>.</p>
<p><strong>Геометрия растра</strong> определяет, где именно располагаются в пространстве пикселы растра и может быть описана путем указания следующих компонент<a href="#fn4" class="footnoteRef" id="fnref4"><sup>4</sup></a>:</p>
<table>
<thead>
<tr class="header">
<th>Параметр</th>
<th>Назначение</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>NCOLS</code></td>
<td>Количество столбцов</td>
</tr>
<tr class="even">
<td><code>NROWS</code></td>
<td>Количество строк</td>
</tr>
<tr class="odd">
<td><code>XLLCENTER</code></td>
<td>Координата <span class="math inline">\(X\)</span> центра левой нижней ячейки растра</td>
</tr>
<tr class="even">
<td><code>YLLCENTER</code></td>
<td>Координата <span class="math inline">\(Y\)</span> центра левой нижней ячейки растра</td>
</tr>
<tr class="odd">
<td><code>CELLSIZE</code></td>
<td>Размер ячейки</td>
</tr>
</tbody>
</table>
<p>Иногда вместо параметров <code>XLLCENTER</code>/<code>YLLCENTER</code> указываются <code>XLLCORNER</code>/<code>YLLCORNER</code>, которые кодируют координаты левого нижнего угла, а не центра левой нижней ячейки растра. Выбор одного из двух этих вариантов определяет тип <em>регистрации растра</em>, а их значения указывают, в какое именно место необходимо “посадить” растр, чтобы его ячейки заняли соответствующие им области в системе координат. Если геометрия растра характеризуется <em>анизотропией</em>, то вместо одного значения <code>CELLSIZE</code> могут быть указаны разные размеры ячеек по осям координат <code>CELLSIZEX</code> и <code>CELLSIZEY</code>.</p>
<p>В отличие от векторной модели, которая позволяет хранить данные только о нужных географических локациях, растровая модель такой свободы не предоставляет. Матрица ячеек растра всегда покрывает область данных целиком, и за простоту растровой структуры приходится расплачиваться ее неэкономичностью. Поскольку часто данные имеются не на всю территорию, возникает необходимость кодирования ячеек, для которых данные не известны, специальным числом (назовем его условно <code>NODATA_VALUE</code>). Значение этого числа хранится в метаданных растра и позволяет интерпретировать соответствующие ячейки как пустые.</p>
</div>
</div>
<div id="spatial_relations" class="section level2">
<h2><span class="header-section-number">6.2</span> Пространственные отношения</h2>
<p>Координаты точек векторных объектов и координаты пикселов растра, вычисленные в соответствии с описанием его геометрии, не имеют содержательного смысла, покуда не известно, в какой системе координат они заданы. Эта информация берется из описания пространственной привязки данных.</p>
</div>
<div id="spatref" class="section level2">
<h2><span class="header-section-number">6.3</span> Пространственная привязка</h2>
<div id="spatref_components" class="section level3">
<h3><span class="header-section-number">6.3.1</span> Компоненты пространственной привязки</h3>
<p><strong>Пространственная привязка</strong> (<em>spatial reference</em> или <em>georeference</em>) — важнейшая составляющая пространственных данных, которая говорит нам о том, как правильно интерпретировать координаты объектов. Пространственная привязка в простейшем случае включает несколько фундаментальных компонент:</p>
<ol style="list-style-type: decimal">
<li><em>Эллипсоид вращения</em> — тело, по отношению к которому вычисляются геодезические координаты точек (широты и долготы)</li>
<li><em>Исходные геодезические даты (датум)</em> — параметры положения эллипсоида в теле Земли</li>
<li><em>Географическая система координат</em> — включает датум, положение начального меридиана и единицы измерения широт и долгот</li>
<li><em>Проекция</em> — математический спопоб перехода от географических координат на эллипсоиде к плоским прямоугольным координатам карты.</li>
<li><em>Плоская прямоугольная система координат</em> — включает проекцию, ее параметры и единицы измерения координат.</li>
</ol>
<p>Если точки имеют также координаты <span class="math inline">\(Z\)</span>, то для их правильной интерпретации необходимы дополнительные компоненты пространственной привязки:</p>
<ol style="list-style-type: decimal">
<li><em>Система счета высот</em> (геодезические, нормальные, ортометрические) - определяют содержательный смысл и порядок вычисления высот и глубин (координата Z)</li>
<li><em>Модель геоида, квазигеоида или эллипсоида</em> — определяет поверхность, относительно которой вычисляются высоты точек.</li>
<li><em>Вертикальная система координат</em> — фактическая реализация системы счета высот относительно конкретной поверхности относимости с заданным положением нулевого уровня. Например, в России это <em>Балтийская система нормальных высот</em> с нулем в г. Кронштадт.</li>
</ol>
<p>Аналогичным образом требуется введение системы счета дополнительных координат <span class="math inline">\(M\)</span>, если они используются в представлении координат.</p>
</div>
<div id="spatref_formats" class="section level3">
<h3><span class="header-section-number">6.3.2</span> Форматы описания пространственной привязки</h3>
<p>Существует три распространенных способа задания (хранения) пространственной привязки:</p>
<ul>
<li><em>PROJ.4 String</em> — представление в виде строки.</li>
<li><em>WKT (Well-Known Text)</em> — представление в виде иерархического списка.</li>
<li><em>EPSG (European Petroleum Survey Group)</em> — представление в виде числового кода.</li>
</ul>
<p>Для поиска проекций в перечисленных форматах представления удобно воспользоваться порталом <a href="spatialreference.org" class="uri">spatialreference.org</a>.</p>
<p><strong>PROJ.4 String</strong> — строковый формат представления информации о пространственной привязки, используемый в библиотеке <a href="http://proj4.org">PROJ.4</a>. Данная библиотека лежит в основе координатных систем пространственных данных, используется в <strong>R</strong>, <strong>Python</strong>, <strong>QGIS</strong> и прочих средах. Основные параметры строки:</p>
<pre><code>+datum     Datum name (see `proj -ld`)
+ellps     Ellipsoid name (see `proj -le`)
+lat_0     Latitude of origin
+lat_1     Latitude of first standard parallel
+lat_2     Latitude of second standard parallel
+lat_ts    Latitude of true scale
+lon_0     Central meridian
+proj      Projection name (see `proj -l`)
+units     meters, US survey feet, etc.
+vunits    vertical units.
+x_0       False easting
+y_0       False northing
+zone      UTM zone</code></pre>
<p>Примеры записи координат в формате PROJ.4:</p>
<ul>
<li>Географические координаты в <em>WGS84</em> (без проекции):</li>
</ul>
<pre><code>## +proj=longlat +datum=WGS84 +no_defs</code></pre>
<ul>
<li>Координаты в проекции <em>Web Mercator</em> (проекция Google Maps, Яндекс.Карт и т.д.):</li>
</ul>
<pre><code>## +proj=merc +a=6378137 +b=6378137 +lat_ts=0.0 +lon_0=0.0 +x_0=0.0 +y_0=0 +k=1.0 +units=m +nadgrids=@null +wktext +no_defs</code></pre>
<ul>
<li>Координаты в <em>конической равнопромежуточной проекции</em>:</li>
</ul>
<pre><code>## +proj=eqdc +lat_0=0 +lon_0=0 +lat_1=60 +lat_2=60 +x_0=0 +y_0=0 +datum=WGS84 +units=m +no_defs</code></pre>
<ul>
<li>Координаты в проекции <em>UTM, зона 37</em>:</li>
</ul>
<pre><code>## +proj=utm +zone=37 +datum=WGS84 +units=m +no_defs</code></pre>
<p>Запись координат в формате WKT предполагает представление вышеуказанных компонент пространственной привязки к виде иерерхического списка. Например, так будет выглядеть информация о <em>полярной стереографической проекции для карт России</em>:</p>
<pre><code>PROJCS[&quot;WGS 84 / EPSG Russia Polar Stereographic&quot;,
    GEOGCS[&quot;WGS 84&quot;,
        DATUM[&quot;WGS_1984&quot;,
            SPHEROID[&quot;WGS 84&quot;,6378137,298.257223563,
                AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],
            AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],
        PRIMEM[&quot;Greenwich&quot;,0,
            AUTHORITY[&quot;EPSG&quot;,&quot;8901&quot;]],
        UNIT[&quot;degree&quot;,0.0174532925199433,
            AUTHORITY[&quot;EPSG&quot;,&quot;9122&quot;]],
        AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]],
    PROJECTION[&quot;Polar_Stereographic&quot;],
    PARAMETER[&quot;latitude_of_origin&quot;,90],
    PARAMETER[&quot;central_meridian&quot;,105],
    PARAMETER[&quot;scale_factor&quot;,0.994],
    PARAMETER[&quot;false_easting&quot;,2000000],
    PARAMETER[&quot;false_northing&quot;,2000000],
    UNIT[&quot;metre&quot;,1,
        AUTHORITY[&quot;EPSG&quot;,&quot;9001&quot;]],
    AXIS[&quot;X&quot;,EAST],
    AXIS[&quot;Y&quot;,NORTH],
    AUTHORITY[&quot;EPSG&quot;,&quot;5940&quot;]]</code></pre>
<p><strong>EPSG (European Petroleum Survey Group)</strong> — европейская рабочая группа нефтегазовой области, которая ведет реестр систем координат с уникальными цифровыми кодами вида <code>EPSG:xxxxxx</code>. Коды EPSG оказались настолько удобны, что используются повсеместно для быстрой инициализации проекций со стандартными параметрами. Например, вышеприведенные проекции имеют следующие коды EPSG:</p>
<ul>
<li><em>WGS84</em>: <code>EPSG:4326</code></li>
<li><em>Web Mercator</em>: <code>EPSG:3857</code></li>
<li><em>UTM</em>: <code>EPSG:326..</code> , например для UTM 37N: <code>EPSG:32637</code></li>
</ul>
</div>
<div id="spatref_transform" class="section level3">
<h3><span class="header-section-number">6.3.3</span> Преобразование координат</h3>
<p>Преобразование координат включает три различных операции:</p>
<ol style="list-style-type: decimal">
<li><p><strong>Трансформирование</strong> — пересчет географических координат с одного датума на другой</p></li>
<li><p><strong>Проецирование</strong> — переход от географических координат к плоским прямоугольным</p></li>
<li><p><strong>Обратное проецирование</strong> — переход от плоских координат к прямоугольным.</p></li>
</ol>
<p>Например, чтобы пересчитать координаты <em>UTM</em> в проекцию <em>Гаусса-Крюгера</em>, необходимо:</p>
<ol style="list-style-type: decimal">
<li>Обратно проецировать координаты в географические <em>WGS84</em></li>
<li>Трансформировать географические координаты c <em>WGS84</em> в <em>ГСК-2011</em></li>
<li>Проецировать координаты <em>ГСК-2011</em> в проекцию <em>Гаусса-Крюгера</em></li>
</ol>
<p><em>Несоответствие датумов часто является причиной того, что данные из разных наборов плохо совмещаются друг с другом</em></p>
</div>
</div>
<div id="vector_data_r" class="section level2">
<h2><span class="header-section-number">6.4</span> Векторные данные</h2>
<div id="-" class="section level3">
<h3><span class="header-section-number">6.4.1</span> Базовые библиотеки</h3>
<p>В R существует высоко развитая инфраструктура для работы с векторными данными, которая обеспечивается пакетом <a href="https://cran.r-project.org/web/packages/sf/index.html">sf</a>. Этот пакет появился сосвсем недавно (в 2016 году). Ранее поддержка пространственных данных обеспечивалась пакетом <a href="https://cran.r-project.org/web/packages/sp/index.html">sp</a>, который по прежнему активно используется, и на который “завязано” множество других библиотек. Существующая в настоящий момент инфраструктура кратко показана ниже:</p>
<div class="figure">
<img src="images/sf_architecture.png" alt="Архитектура программных библиотек для работы с пространственными данными в R" />
<p class="caption">Архитектура программных библиотек для работы с пространственными данными в R</p>
</div>
<p>Исторический пакет <code>sp</code> обеспечивал (и продолжает обеспечивать) поддержку пространственных данных в виде специальных классов данных типа <code>Spatial</code>, реализуя классы как для чисто геометрических объектов (<code>SpatialPolygons</code>), так и для пространственных объектов с атрибутами (<code>SpatialPolygonsDataFrame</code>). Во втором случае набор объектов имеет ассоциированную с ним таблицу атрибутов. С классами типа <code>Spatial</code> существут несколько проблем. Во-первых, они не являются объектами типа <code>data.frame</code> (не расширяют их), а являются самостоятельным классом объектов, поэтому к ним часто невозможно корректно применить стандартные операции трансформации таблиц (типа тех, что доступны в пакете <strong>dplyr</strong>). Во-вторых, объекты типа <code>Spatial</code> не реализуют существующие стандарты представления пространственных данных (типа <em>Simple Features</em>), что накладывает ограничения на их интероперабельность с современными форматами данных (например, <a href="http://www.geopackage.org">GeoPackage</a>).</p>
<p>Пакет <a href="https://cran.r-project.org/web/packages/sf/index.html">sf</a> решает все эти проблемы. Множество функций, которые были раньше разбросаны по нескольким пакетам <strong>R</strong> (sp, rgdal, rgeos), теперь доступны в одном интерфейсе:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(sf)
<span class="kw">methods</span>(<span class="dt">class =</span> <span class="st">&quot;sf&quot;</span>) <span class="co"># Посмотрим, какие методы доступных для объектов класса sf</span>
##  [1] [                     [[&lt;-                  $&lt;-                  
##  [4] aggregate             cbind                 coerce               
##  [7] initialize            merge                 plot                 
## [10] print                 rbind                 show                 
## [13] slotsFromS3           st_agr                st_agr&lt;-             
## [16] st_as_sf              st_bbox               st_boundary          
## [19] st_buffer             st_cast               st_centroid          
## [22] st_collection_extract st_convex_hull        st_coordinates       
## [25] st_crs                st_crs&lt;-              st_difference        
## [28] st_geometry           st_geometry&lt;-         st_intersection      
## [31] st_is                 st_line_merge         st_make_valid        
## [34] st_node               st_point_on_surface   st_polygonize        
## [37] st_precision          st_segmentize         st_set_precision     
## [40] st_simplify           st_split              st_sym_difference    
## [43] st_transform          st_triangulate        st_union             
## [46] st_voronoi            st_zm                
## see &#39;?methods&#39; for accessing help and source code</code></pre></div>
<p>Cо многими из этих функций мы познакомимся в последующих разделах нашего курса. Некоторые из них (такие как <code>arrange</code>, <code>filter</code>, <code>mutate</code> из пакета <strong>dplyr</strong>), должны быть уже знакомы вам по предыдущим лекциям. Можно обратить внимание на то, что практически все функции начинаются с префикса <code>st_</code>, что означает <strong>“spatiotemporal”</strong>. Данные префиксы были выбраны для унификации с аналогичными названиями функций, используемых в широко распространенной СУБД PostgreSQL для оперирования объектами Simple Features.</p>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">6.4.2</span> Чтение векторных данных</h3>
<p>Существует большое множество форматов хранения пространственных данных. Но в общем и целом их можно разделить на две категории: файловые форматы (наиболее привычные пользователям) и хранение данных в СУБД — системах управления базами данных. Благодаря библиотеке GDAL пакет <strong>sf</strong> имеет возможность читать и записывать <a href="http://www.gdal.org/ogr_formats.html">более 90 различных форматов векторных даных</a>. Разумеется, не все из них общеупотребительны. Исторически наиболее распространенным форматом был (и остается) <a href="https://www.esri.com/library/whitepapers/pdfs/shapefile.pdf">ESRI Shapefile</a>. Данный формат, однако не отвечает современным техническим требованиям с точки зрения гибкости, соответствия стандартам и возможностям хранения разнообразных типов геометрий (напомним, что в стандарте Simple Features их 17, а с учетом четырех вариантов размерности точек получается целых 68 ). Современный формат, который позволяет делать это (и не только), это <a href="http://www.geopackage.org">GeoPackage</a>. Именно его мы и будем использовать в нашем практикуме.</p>
<p>Для чтения данных средствами sf необходимо использовать функцию <code>st_read()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">countries &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&#39;ne/countries.gpkg&#39;</span>)
## Reading layer `admin_0_map_units&#39; from data source `/Volumes/Data/GitHub/r-geo-course/data/ne/countries.gpkg&#39; using driver `GPKG&#39;
## Simple feature collection with 183 features and 72 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -180 ymin: -90 xmax: 180 ymax: 83.64513
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs</code></pre></div>
<p>Лог функции сообщил нам следующую информацию:</p>
<ul>
<li>Набор данных представляет собой коллекцию из 183 пространственных объектов с 72 атрибутами</li>
<li>Тип геометрии <code>MULTIPOLYGON</code></li>
<li>Размерность геометрии <span class="math inline">\(XY\)</span></li>
<li>Ограничивающий прямоугольник (разброс координат) по осям <span class="math inline">\(X\)</span> и <span class="math inline">\(Y\)</span> имеет диапазон <span class="math inline">\([-180, 180] \times [-90, 83.64513]\)</span></li>
<li>EPSG-код пространственной привязки равен <code>4326</code></li>
<li>PROJ.4-строка пространственной привязки равна <code>+proj=longlat +datum=WGS84 +no_defs</code></li>
</ul>
</div>
<div id="-" class="section level3">
<h3><span class="header-section-number">6.4.3</span> Внутренняя структура</h3>
<p>Традиционно во всех ГИС-приложениях и базах пространственных данных множество пространственных объектов представляется в виде таблицы атрибутов, где каждая строка соответствует объекту, а каждый столбец — атрибуту объекта. С каждой строкой таблицы должна быть ассоциирована информация о геометрии объекта, которая, в зависимости от формата данных, может либо храниться непосредственно в таблице (в специальном столбце), либо быть вынесена в отдельную структуру данных, которая связана с таблицей атрибутов посредством ключа<a href="#fn5" class="footnoteRef" id="fnref5"><sup>5</sup></a>.</p>
<p>В <strong>R</strong> используется первый подход, в котором информация о геометрии хранится в специальном столбце таблицы. Каждая ячейка этого столбца соответствует геометрическому объекту <em>Simple Features</em>. Представление геометрических объектов реализовано стандартными средствами, такими как списки, матрицы и векторы. Эти структуры данных упорядоченным образом хранят координаты объектов и естественным образом соответствуют способу организации данных, который регламентируется стандартом <em>Simple Features</em>. Поскольку геометрический столбец хранит не обычные переменные, а структуры данных, он реализуется в виде так называемого <em>списка-колонки (list-column)</em>, каждый элемент которой соответствует отдельному объекту.</p>
<p>Исходя из этих соображений, представление пространственных объектов реализовано в <strong>R</strong> в виде иерархии из трех классов объектов:</p>
<ol style="list-style-type: decimal">
<li><code>sf</code> (simple features) — объект класса <code>data.frame</code>, представляющий множество пространственных объектов со списком-колонкой для хранения геометрии</li>
<li><code>sfc</code> (simple features geometry column) — список-колонка в объекте <code>sf</code>, представляющий множество геометрий пространственных объектов</li>
<li><code>sfg</code> (simple feature geometry) — геометрия пространственного объекта внутри списка <code>sfc</code></li>
</ol>
<p>В соответствии с перечисленными спецификациями происходит работа с пространственными объектами. То что, объекты типа Simple Features реализованы в виде самых обычных фреймов данных, означает что <em>любая операция, применимая к фрейму данных, будет также применима к объекту типа</em> <code>sf</code>. Это очень важная особенность объектов типа sf, которой сильно не хватало в экосистеме исторического пакета <code>sp</code>.</p>
<p>Посмотрим, как все это реализовано, на конкретном примере:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(countries)
## [1] &quot;sf&quot;         &quot;data.frame&quot;</code></pre></div>
<p>Данная форма записи говорит о том, что прочитанный слой имеет класс <em>sf</em>, который, в свою очередь, является расширением класса <em>data.frame</em>.</p>
<p>А теперь посмотрим на последние колонки в первых строках таблицы:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(countries[<span class="kw">tail</span>(<span class="kw">colnames</span>(countries))])
## Simple feature collection with 6 features and 5 fields
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -73.41544 ymin: -55.25 xmax: 75.15803 ymax: 42.68825
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
##   tiny homepart min_zoom min_label max_label
## 1  -99        1        0         3         7
## 2  -99        1        0         3         7
## 3  -99        1        0         5        10
## 4  -99        1        0         4         9
## 5  -99        1        0         2         7
## 6  -99        1        0         5        10
##                         geometry
## 1 MULTIPOLYGON (((61.21081709...
## 2 MULTIPOLYGON (((23.90415368...
## 3 MULTIPOLYGON (((21.02004031...
## 4 MULTIPOLYGON (((51.57951867...
## 5 MULTIPOLYGON (((-66.95992 -...
## 6 MULTIPOLYGON (((43.58274580...</code></pre></div>
<p>Видно, что геометрия пространственных объектов хранится в заключительном столбце с названием <code>geometry</code>. Данный столбец можно быстро извлечь, применив функцию <code>st_geometry()</code>. Полученный объект будет иметь тип <strong>sfc</strong> (Simple Feature Geometry Column)</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">outlines &lt;-<span class="st"> </span><span class="kw">st_geometry</span>(countries)
<span class="kw">class</span>(outlines)
## [1] &quot;sfc_MULTIPOLYGON&quot; &quot;sfc&quot;</code></pre></div>
<p>Полученный вывод говорит нам о том, что наши объекты имеют класс <code>sfc_MULTIPOLYGON</code>, который является расширением класса <code>sfc</code> (simple feature geometry column).</p>
<p>Теперь если просмотреть начало данных, то мы увидим, что это больше не фрейм данных, а аннотированный список:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(outlines)
## Geometry set for 6 features 
## geometry type:  MULTIPOLYGON
## dimension:      XY
## bbox:           xmin: -73.41544 ymin: -55.25 xmax: 75.15803 ymax: 42.68825
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
## First 5 geometries:</code></pre></div>
<p>Наконец, можно опуститься на базовый уровень геометрии, получив доступ к отдельному объекту. Поскольку объект класса <code>sfc</code> представляет собой список, любой элемент можно извлечь по его порядковому номеру:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">outlines[[<span class="dv">8</span>]]</code></pre></div>
<p>Класс полученного объекта будет:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">class</span>(outlines[[<span class="dv">8</span>]])
## [1] &quot;XY&quot;           &quot;MULTIPOLYGON&quot; &quot;sfg&quot;</code></pre></div>
<p>Исходя из полученной информации можно сделать вывод, что наш объект имеет класс простой геометрии (<code>sfg</code>), реализованный в виде мультиполигонов (<code>MULTIPOLYGON</code>) с плоскими координатами (<code>XY</code>)</p>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">6.4.4</span> Базовые возможности отображения</h3>
<p>Если попытаться применить функцию <code>plot()</code> к геометрии объекта, она попытается нарисовать тематические карты по всем имеющимся атрибутам (но остановится, если их более 9):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(countries)</code></pre></div>
<p><img src="07-SpatialData_files/figure-html/unnamed-chunk-17-1.png" width="672" /></p>
<p>Если задача стоит нарисовать границы объектов, то нужно отображать объект <strong>sfc</strong>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(outlines, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>)</code></pre></div>
<p><img src="07-SpatialData_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Для быстрого построения тематических карт по выбранному показателю необходимо при вызове функции <code>plot()</code> указать соответствующий атрибут фрейма данных:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(countries[<span class="st">&#39;sovereignt&#39;</span>], <span class="dt">key.pos =</span> <span class="ot">NULL</span>) <span class="co"># Здесь легенда не нужна</span></code></pre></div>
<p><img src="07-SpatialData_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(countries[<span class="st">&#39;gdp_md_est&#39;</span>])</code></pre></div>
<p><img src="07-SpatialData_files/figure-html/unnamed-chunk-19-2.png" width="672" /></p>
<p>Ясно, что на этих картах можно много что улучшить, однако это мы отложим до следующей главы, где подробно разбирается построение тематических карт в R.</p>
</div>
<div id="section-6.4.5" class="section level3">
<h3><span class="header-section-number">6.4.5</span> Проецирование</h3>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">6.4.6</span> Операции с атрибутами</h3>
<p>Поскольку пространственные объекты хранятся в фреймах данных, к ним можно применять стандартные операции выборки по атрибутам и преобразования таблиц. Например, можно выбрать Италию и отобразить ее на отдельной карте:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)

italy &lt;-<span class="st"> </span>countries <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(sovereignt <span class="op">==</span><span class="st"> &#39;Italy&#39;</span>)
<span class="kw">plot</span>(<span class="kw">st_geometry</span>(italy))</code></pre></div>
<p><img src="07-SpatialData_files/figure-html/unnamed-chunk-20-1.png" width="672" /></p>
<p>Следующий пример иллюстрирует как выбрать страны с населением более 100 млн человек:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">largest &lt;-<span class="st"> </span>countries <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">select</span>(pop_est) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(pop_est <span class="op">&gt;</span><span class="st"> </span><span class="dv">100000000</span>)
<span class="kw">plot</span>(outlines, <span class="dt">col =</span> <span class="st">&#39;lightgrey&#39;</span>)
<span class="kw">plot</span>(largest, <span class="dt">col =</span> <span class="st">&#39;red&#39;</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="07-SpatialData_files/figure-html/unnamed-chunk-21-1.png" width="672" /></p>
<p>Обратите внимание на то, что при вызове функции <code>select()</code> столец <code>geometry</code> не был указан в числе выбираемых переменных. Тем не менее, то, что мы смоги построить карту по результатам выборки, говорит о том, что данный столбец был сохранен. <em>Функции <strong>dplyr</strong> определены для объектов <code>sf</code> таким образом, чтобы всегда сохранять геометрический столбец.</em></p>
<p>Еще интереснее работает агрегирование объектов по атрибутам. В случае, когда агрегируются пространственные объекты, необходимо объединять и их геометрию. При этом если у агрегируемых объектов имеется общая граница, ее необходимо удалить, а если объекты разнесены в пространстве, из них нужно собрать новый мульти-объект.</p>
<p>Например, мы можем агрегировать валовый региональный продукт по континентам:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">continents &lt;-<span class="st"> </span>countries <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">group_by</span>(continent) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">summarise</span>(<span class="dt">gdp =</span> <span class="kw">sum</span>(gdp_md_est))
<span class="kw">plot</span>(continents[<span class="st">&#39;gdp&#39;</span>])</code></pre></div>
<p><img src="07-SpatialData_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p>Потрясающе просто, не правда ли? Вдобавок, мы еще и получили границы континентов (достаточно условные, конечно), которых у нас раньше не было. Данный пример также показывает, что атрибутивные операции над пространственными объектами всегда учитывают их геометрию.</p>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">6.4.7</span> Операции с геометрией</h3>
<p>Стандартные операции с геометрией базируются на пространственных отношениях объектов и включают в себя определение отношений, выборку с использованием отношений и получение новой геометрии на основе отношений.</p>
<div id="-" class="section level4">
<h4><span class="header-section-number">6.4.7.1</span> Пространственные отношения</h4>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">6.4.7.2</span> Пространственная выборка</h4>
<p>Наиболее простой способ выбрать объекты по пространственному местоположению — это использовать один слой в качестве фильтра для другого слоя. В этом случае будет по умолчанию использовано отношение <code>intersects</code> (пересекает). Никаких отличий от работы с обычными таблицами нет. Например, вот так можно выбрать точки, находящиеся внутри ранее отобранных стран с максимальным ВВП:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cities &lt;-<span class="st"> </span><span class="kw">st_read</span>(<span class="st">&#39;ne/cities.gpkg&#39;</span>)
## Reading layer `populated_places&#39; from data source `/Volumes/Data/GitHub/r-geo-course/data/ne/cities.gpkg&#39; using driver `GPKG&#39;
## Simple feature collection with 243 features and 103 fields
## geometry type:  POINT
## dimension:      XY
## bbox:           xmin: -175.2206 ymin: -41.29999 xmax: 179.2166 ymax: 64.15002
## epsg (SRID):    4326
## proj4string:    +proj=longlat +datum=WGS84 +no_defs
city.pts &lt;-<span class="st"> </span><span class="kw">st_geometry</span>(cities)

<span class="co"># Наносим исходную конфигурацию</span>
<span class="kw">plot</span>(outlines, <span class="dt">lwd =</span> <span class="fl">0.5</span>)
<span class="kw">plot</span>(cities, <span class="dt">col =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">cex =</span> <span class="fl">0.5</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)

<span class="co"># Отбираем точки внутри стран с максимальным ВВП</span>
sel &lt;-<span class="st"> </span>cities[largest, ]

<span class="co"># Смотрим что получилось</span>
<span class="kw">plot</span>(outlines, <span class="dt">lwd =</span> <span class="fl">0.5</span>)
<span class="kw">plot</span>(largest, <span class="dt">col =</span> <span class="st">&#39;gray&#39;</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)
<span class="kw">plot</span>(sel, <span class="dt">pch =</span> <span class="dv">20</span>, <span class="dt">col =</span> <span class="st">&#39;black&#39;</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="07-SpatialData_files/figure-html/unnamed-chunk-23-1.png" width="672" /></p>
<p>Разумеется, при выполнении пространственных запросов могут возникать и другие пространственные отношения. Например, мы можем выбрать все страны, имеющие общую границу с Чехией. Отношение <code>st_touches</code> вместо <code>st_intersects</code> будет гарантировать, что сама Чехия в результате не выберется (касающиеся объекты не могут перекрываться):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">cz &lt;-<span class="st"> </span>countries <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(sovereignt <span class="op">==</span><span class="st"> &#39;Czechia&#39;</span>)
neighbors &lt;-<span class="st"> </span>countries[cz, op =<span class="st"> </span>st_touches]

<span class="kw">plot</span>(<span class="kw">st_geometry</span>(neighbors), <span class="dt">col =</span> <span class="st">&#39;lightgray&#39;</span>, <span class="dt">lwd =</span> <span class="fl">0.5</span>)
<span class="kw">plot</span>(cz, <span class="dt">col =</span> <span class="st">&#39;darkgray&#39;</span>, <span class="dt">add =</span> <span class="ot">TRUE</span>)</code></pre></div>
<p><img src="07-SpatialData_files/figure-html/unnamed-chunk-24-1.png" width="672" /></p>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">6.4.7.3</span> Пространственные операции</h4>
<p>Один из очевидных примеров того, когда требуется выполнить операцию, основанную на пространственных отношениях — это обрезка данных.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">box &lt;-<span class="st"> </span><span class="kw">st_bbox</span>(neighbors)</code></pre></div>
</div>
</div>
<div id="---" class="section level3">
<h3><span class="header-section-number">6.4.8</span> Детали работы с геометрией</h3>
<div id="-" class="section level4">
<h4><span class="header-section-number">6.4.8.1</span> Разбор геометрии</h4>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(dplyr)

georgia &lt;-<span class="st"> </span>countries <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(sovereignt <span class="op">==</span><span class="st"> &#39;Georgia&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">st_geometry</span>()
<span class="kw">plot</span>(georgia)
<span class="kw">st_as_text</span>(georgia)
## [1] &quot;MULTIPOLYGON (((44.9724800962181 41.2481285670556, 43.5827458025927 41.0921432561826, 42.6195487811045 41.5831727158199, 41.5540841001107 41.5356562363276, 41.7031706072727 41.9629428167329, 41.4534700864384 42.6451233994179, 40.8754691912538 43.0136280380913, 40.3213944842203 43.1286339381568, 39.9550085792709 43.4349976669992, 40.0769649594798 43.5531041530023, 40.9221900000001 43.3821500000002, 42.3944000000002 43.2203000000001, 43.7559900000001 42.7408300000001, 43.9312100000001 42.5549600000001, 44.537622918482 42.7119927028036, 45.4702791684857 42.50278066667, 45.7764000000001 42.0924400000002, 46.4049507993488 41.8606751572273, 46.145431756379 41.7228024358726, 46.6379081561206 41.1816726751282, 46.5016374041669 41.0644446884741, 45.9626005389304 41.1238725856098, 45.2174263852816 41.411451931314, 44.9724800962181 41.2481285670556)))&quot;
georgia[[<span class="dv">1</span>]][[<span class="dv">1</span>]]
## [[1]]
##           [,1]     [,2]
##  [1,] 44.97248 41.24813
##  [2,] 43.58275 41.09214
##  [3,] 42.61955 41.58317
##  [4,] 41.55408 41.53566
##  [5,] 41.70317 41.96294
##  [6,] 41.45347 42.64512
##  [7,] 40.87547 43.01363
##  [8,] 40.32139 43.12863
##  [9,] 39.95501 43.43500
## [10,] 40.07696 43.55310
## [11,] 40.92219 43.38215
## [12,] 42.39440 43.22030
## [13,] 43.75599 42.74083
## [14,] 43.93121 42.55496
## [15,] 44.53762 42.71199
## [16,] 45.47028 42.50278
## [17,] 45.77640 42.09244
## [18,] 46.40495 41.86068
## [19,] 46.14543 41.72280
## [20,] 46.63791 41.18167
## [21,] 46.50164 41.06444
## [22,] 45.96260 41.12387
## [23,] 45.21743 41.41145
## [24,] 44.97248 41.24813

italy &lt;-<span class="st"> </span>countries <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">filter</span>(sovereignt <span class="op">==</span><span class="st"> &#39;Italy&#39;</span>) <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">st_geometry</span>()
<span class="kw">plot</span>(italy)</code></pre></div>
<p><img src="07-SpatialData_files/figure-html/unnamed-chunk-26-1.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">st_as_text</span>(italy)
## [1] &quot;MULTIPOLYGON (((10.4427014502466 46.8935462509974, 11.0485559424365 46.7513585475463, 11.1648279150933 46.9415794948127, 12.153088006243 47.1153931748265, 12.3764852230408 46.7675591090698, 13.8064754574215 46.5093061386912, 13.6981099789055 46.0167780625174, 13.9376302425783 45.5910159368646, 13.1416064795543 45.7366917994954, 12.3285811703063 45.3817780625149, 12.3838749528585 44.8853742539191, 12.2614534847591 44.600482082694, 12.5892370947865 44.0913658717545, 13.5269059587226 43.5877273626379, 14.0298209977871 42.7610077988325, 15.1425696143279 41.9551396754568, 15.9261910336019 41.9613150091158, 16.1698970882904 41.7402949082034, 15.8893457373778 41.5410822617182, 16.7850016618606 41.1796056178366, 17.5191687354312 40.8771434596323, 18.3766874528825 40.3556249049427, 18.4802470231955 40.1688662786399, 18.2933850440281 39.8107744410733, 17.7383801612133 40.2776710068303, 16.8695959815224 40.4422346054638, 16.4487431169374 39.7954007024664, 17.1714896989715 39.4246998154207, 17.0528406104294 38.9028712021373, 16.6350883317818 38.8435724960824, 16.100960727613 37.9858987493342, 15.6840869483145 37.9088491887871, 15.6879626807364 38.2145928004419, 15.8919812354247 38.7509424911993, 16.1093323096443 38.9645470240777, 15.7188135108146 39.544072374015, 15.4136125016989 40.0483568385352, 14.9984957210982 40.1729487167908, 14.7032682634147 40.6045502792927, 14.0606718278653 40.7863479680954, 13.6279850602854 41.1882872584616, 12.8880819027304 41.2530895045556, 12.106682570045 41.7045348170574, 11.1919063656142 42.3554253199897, 10.5119478695177 42.9314625107473, 10.200028924204 43.9200068222746, 9.70248823409787 44.0362787949313, 8.8889461605269 44.3663361679796, 8.42856082523861 44.2312281357524, 7.85076663578317 43.7671479355553, 7.4351847672919 43.6938449163492, 7.54959638838614 44.1279011093848, 7.00756229007661 44.2547667506614, 6.74995527510166 45.0285179713675, 7.09665245934787 45.3330988632959, 6.80235517744561 45.7085798203287, 6.84359297041451 45.9911465521006, 7.27385094567666 45.7769477402508, 7.75599205895983 45.8244900579593, 8.31662967289438 46.1636424830909, 8.48995242680132 46.0051508652517, 8.96630577966778 46.0369318711112, 9.18288170740306 46.440214748717, 9.92283654139038 46.3148994004092, 10.3633781266786 46.4835712754099, 10.4427014502466 46.8935462509974)), ((15.5203760108138 38.2311550969915, 15.1602429541718 37.4440455185378, 15.3098979020891 37.1342194687318, 15.0999882341195 36.6199872909954, 14.335228712632 36.9966309677548, 13.82673261888 37.1045313583801, 12.4310038591088 37.6129499374837, 12.5709436377552 38.1263811305196, 13.7411564470046 38.0349655217954, 14.7612492204462 38.1438736028504, 15.5203760108138 38.2311550969915)), ((9.21001183435632 41.2099913600242, 9.80997521326495 40.5000088567661, 9.66951867029562 39.1773764104718, 9.21481774255946 39.2404733343002, 8.80693566247967 38.9066177434785, 8.42830244307717 39.1718470322166, 8.38825320805088 40.3783108587188, 8.15999840661772 40.9500072291637, 8.70999067550017 40.8999844427053, 9.21001183435632 41.2099913600242)))&quot;

italy[[<span class="dv">1</span>]][[<span class="dv">2</span>]] <span class="co"># Сицилия</span>
## [[1]]
##           [,1]     [,2]
##  [1,] 15.52038 38.23116
##  [2,] 15.16024 37.44405
##  [3,] 15.30990 37.13422
##  [4,] 15.09999 36.61999
##  [5,] 14.33523 36.99663
##  [6,] 13.82673 37.10453
##  [7,] 12.43100 37.61295
##  [8,] 12.57094 38.12638
##  [9,] 13.74116 38.03497
## [10,] 14.76125 38.14387
## [11,] 15.52038 38.23116
italy[[<span class="dv">1</span>]][[<span class="dv">3</span>]] <span class="co"># Сардиния</span>
## [[1]]
##           [,1]     [,2]
##  [1,] 9.210012 41.20999
##  [2,] 9.809975 40.50001
##  [3,] 9.669519 39.17738
##  [4,] 9.214818 39.24047
##  [5,] 8.806936 38.90662
##  [6,] 8.428302 39.17185
##  [7,] 8.388253 40.37831
##  [8,] 8.159998 40.95001
##  [9,] 8.709991 40.89998
## [10,] 9.210012 41.20999

sicilia &lt;-<span class="st"> </span><span class="kw">st_polygon</span>(italy[[<span class="dv">1</span>]][[<span class="dv">2</span>]])
sardinia &lt;-<span class="st"> </span><span class="kw">st_polygon</span>(italy[[<span class="dv">1</span>]][[<span class="dv">3</span>]])
islands &lt;-<span class="st"> </span><span class="kw">st_multipolygon</span>(<span class="kw">list</span>(sicilia, sardinia))

<span class="kw">plot</span>(sicilia)
<span class="kw">plot</span>(sardinia)</code></pre></div>
<p><img src="07-SpatialData_files/figure-html/unnamed-chunk-26-2.png" width="672" /></p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">plot</span>(islands)</code></pre></div>
<p><img src="07-SpatialData_files/figure-html/unnamed-chunk-26-3.png" width="672" /></p>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">6.4.8.2</span> Создание геометрии</h4>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">6.4.8.3</span> Преобразование геометрии</h4>
</div>
<div id="-" class="section level4">
<h4><span class="header-section-number">6.4.8.4</span> Описание геометрии</h4>
<p>К описательным параметрам относятся базовые характеристики геометрии: ограничивающий прямоугольник, центроид, периметр (для линий и полигонов) и площадь (для полигонов).</p>
</div>
</div>
</div>
<div id="raster_data_r" class="section level2">
<h2><span class="header-section-number">6.5</span> Растровые данные</h2>
<div id="section-6.5.1" class="section level3">
<h3><span class="header-section-number">6.5.1</span> Чтение</h3>
</div>
<div id="--1" class="section level3">
<h3><span class="header-section-number">6.5.2</span> Внутренняя структура</h3>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">6.5.3</span> Базовые возможности визуализации</h3>
</div>
<div id="-1" class="section level3">
<h3><span class="header-section-number">6.5.4</span> Проецирование</h3>
</div>
<div id="--" class="section level3">
<h3><span class="header-section-number">6.5.5</span> Операции со значениями</h3>
</div>
<div id="---1" class="section level3">
<h3><span class="header-section-number">6.5.6</span> Операции с геометрией</h3>
</div>
</div>
<div id="questions_tasks_spatial" class="section level2">
<h2><span class="header-section-number">6.6</span> Контрольные вопросы и задачи</h2>
<div id="questions_spatial" class="section level3">
<h3><span class="header-section-number">6.6.1</span> Вопросы</h3>
</div>
<div id="tasks_spatial" class="section level3">
<h3><span class="header-section-number">6.6.2</span> Задачи</h3>

</div>
</div>
</div>










<div class="footnotes">
<hr />
<ol start="3">
<li id="fn3"><p>ГОСТ Р 52438-2005 &lt;<Географические информационные системы. Термины и определения>&gt;. В стандарте поясняется, что объектом может быть неподвижный или движущийся простой или сложный объект, явление, событие, процесс и ситуация. Моделируемый объект может относиться к территории, акватории, недрам и воздушному пространству Земли, околоземному космическому пространству, другим космическим телам и небесной сфере. В широком смысле под пространственным объектом в геоинформатике понимается как сам объект, так и адекватная ему цифровая модель<a href="spatial-data.html#fnref3">↩</a></p></li>
<li id="fn4"><p>Названия перечисленных компонент геометрии растра укоренились благодаря распространенности стандарта <a href="https://en.wikipedia.org/wiki/Esri_grid">Esri ASCII Grid</a><a href="spatial-data.html#fnref4">↩</a></p></li>
<li id="fn5"><p>Например, в широко распространенном формате <strong>Esri Shapefile</strong> атрибутивная таблица хранится в файле <code>*.dbf</code> формата <em>DBASE</em>, геометрия хранится в отдельном файле <code>*.shp</code>, а связь между ними осуществляется через файл <code>*.shx</code>. Разбиение формата хранения на несколько файлов — это одна из уязвимостей шейп-файлов: при отсутствии хотя бы одного из этих файлов данные прочесть стандартными средствами (без дополнительного хакинга) будет нельзя.<a href="spatial-data.html#fnref5">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="controls.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["r-geo-course.pdf", "r-geo-course.epub"],
"toc": {
"collapse": "section",
"edit": "https://github.com/tsamsonov/r-geo-course/edit/master/%s"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
