[
["circular.html", "Глава 8 Статистика направлений и времени 8.1 Предварительные требования 8.2 Статистика направлений 8.3 Статистика временных данных 8.4 Контрольные вопросы и упражнения", " Глава 8 Статистика направлений и времени 8.1 Предварительные требования Для работы по теме текущей лекции вам понадобятся пакеты из tidyverse. Помимо этого, необходимы методы круговой статистики из пакетов circular и NPCirc, и методы из пакета pracma. Для работы с временными данными мы воспользуемся пакетом lubridate, который входит в tidyverse, но автоматически не подключается в сессию. Мы также воспользуемся пакетом gganimate, который позволяет анимировать графики, построенные с помощью ggplot: library(tidyverse) library(circular) library(NPCirc) library(pracma) library(lubridate) library(gganimate) Пакет gganimate пока что не опубликован на CRAN, но доступен на GitHub. Для его установки последовательно выполните в консоли (не в скрипте!) следующие команды: install.packages(&#39;devtools&#39;) devtools::install_github(&#39;thomasp85/gganimate&#39;) После этого пакет можно подключать в привычном режиме: 8.2 Статистика направлений 8.2.1 Теория 8.2.1.1 Распределение фон Мизеса В географии направления играют огромную роль. Ветер, морские течения, уличная сеть, перелеты птиц — все эти явления можно охарактеризовать их направленностью. Для того, чтобы эффективно анализировать такие данные, необходимо владеть специализированным математическим аппаратом. Обработкой данных о направлениях занимается особая область математической статистики — статистика направлений, или круговая (циркулярная) статистика (Mardia, Jupp, 2000; Pewsey et al., 2013). В круговой статистике каждое направление \\(\\theta \\in [0, 2\\pi)\\) представляется в виде вектора \\(x = (\\cos \\theta, sin \\theta)\\). Все операции производятся над подобными векторами и их координатами. Аналогом нормального распределения для круговой случайной величины является распределение фон Мизеса (von Mises, 1918), которое задается функцией плотности вероятности: \\[ f(θ)=\\frac{1}{2 \\pi I_0(\\kappa)} e^{\\kappa \\cos (\\theta - \\mu)}, \\] где \\(\\kappa \\geq 0\\) — параметр концентрации, \\(\\mu\\) — среднее значение (для \\(\\kappa &gt; 0\\)) и \\[ I_p(\\kappa) = \\frac{1}{2π} \\int_{0}^{2\\pi} \\cos (p \\theta) e^{\\kappa \\cos θ} d \\theta \\] есть модифицированная функция Бесселя первого рода и порядка \\(p\\). Из формул видно, что по своему эффекту параметр концентрации противоположен среднеквадратическому отклонению \\(\\sigma\\), которое является параметром нормального распределения. Чем больше значение \\(\\kappa\\), тем более сконцентрировано распределение относительно среднего значения — отсюда идет название этого параметра. Распределение фон Мизеса используется для построения ядра при аппроксимации плотности распределения направлений методом ядерной оценки (оценки по методу Парзена-Розенблатта). В метеорологии значения \\(\\cos \\theta\\) и \\(\\sin \\theta\\) определяют соотношение зональной и меридиональной составляющей скорости [ветра] (для получения самих составляющих их надо умножить на скорость ветра). 8.2.1.2 Вычисление статистических моментов Для вычисления статистических моментов круговой случайной величины требуется найти средний равнодействующий вектор первого порядка \\(R = (C, S)\\), где \\(C = \\frac{1}{n} \\sum_{j=1}^{n} \\cos \\theta_j\\), \\(S = \\frac{1}{n} \\sum_{j=1}^{n} \\sin \\theta_j\\). Данный вектор имеет направление \\(\\bar\\theta\\), которое является выборочным средним направлением исследуемой величины. Выборочная средняя равнодействующая длина \\(\\bar R = \\sqrt{C^2 + S^2}\\) принимает значения в диапазоне \\([0, 1]\\) и показывает меру концентрации направлений относительно \\(\\theta\\). \\(\\bar R = 1\\) означает, что все исходные направления совпадают, \\(\\bar R = 0\\) — что данные равномерно распределены по кругу, либо распределение имеет несколько мод, которые уравновешивают друг друга. Стандартное отклонение направлений \\(v\\) в радианах может быть найдено как \\(v=\\sqrt{-2 \\ln \\bar R}\\) (Mardia, Jupp, 2000). Величина \\(\\bar R\\) дает важную информацию для предварительной диагностики картины направлений. Если значение \\(\\bar R\\) близко к единице, это означает, что распределение является унимодальным и в качестве основного направления можно принять значение \\(\\bar θ\\). В ряде случаев противоположнееы направления считаются эквивалентными. Например, нельзя сказать, идет ли улица с юга на север или с севера на юг. Такие данные в теории круговой статистики называются аксиальными (Mardia, Jupp, 2000). Для аксиальных данных возможный диапазон значений лежит в интервале \\([0, \\pi)\\). Поскольку методы круговой статистики рассчитаны на круговое замыкание данных, стандартный подход к обработке аксиальных данных предполагает переход от направлений к их удвоенным значениям \\(\\theta&#39; = 2\\theta\\), обработку полученных значений стандартными методами и отображение полученных значение обратно на интервал \\([0, \\pi)\\). Для среднего, медианы и моды распределения это означает простое деление полученного значения пополам (Pewsey et al., 2013). 8.2.1.3 Определение модальных направлений Модальные направления могут быть определены как по гистограмме распределения, так и методом ядерной оценки. Основной вопрос поиска эффективного ядра заключается в параметризации функции \\(K\\). Для распределения фон Мизеса таким параметром является концентрация \\(\\kappa\\). Чем больше этот параметр, тем более локализованной будет оценка, тем сильнее будут проявляться в ней существующие моды распределения, но также будут и выделяться новые моды, которые на самом деле не значимы. Малые значения \\(\\kappa\\) приведут, наоборот, к «размыванию» плотности распределения в пределах полного круга. Как и в случае с количеством интервалов гистограммы, избыточно малые и большие значения κ нежелательны. Показано, что оптимальное значение κ может быть подобрано также для оценки распределений, являющихся конечной суммой \\(M\\) распределений фон Мизеса, то есть, мультимодальных распределений, имеющих плотность (Oliveira et al., 2012): \\[ g(\\theta)=\\sum_{i=1}^{M} \\alpha_i \\frac{\\exp\\lbrace{\\kappa_i \\cos(\\theta - \\mu_i)\\rbrace}}{2 \\pi I_0 (\\kappa_i)}, \\] где \\(\\sum_{i=1}^{M} = 1\\). Поскольку в результате подбора определяется не только параметр концентрации, но и число компонент в сумме распределений (Oliveira et al., 2014), его можно также использовать для определения количества искомых мод, если это необходимо. Когда подобрана функция ядра и ее параметры, оценка плотности распределения (вычисление функции \\(\\circ f _h (x)\\)) для круговых данных делается либо для исходных направлений \\(\\theta_j\\), либо с равным (достаточно малым) интервалом — например, через 1 градус (Pewsey et al., 2013). После того как произведена оценка, могут быть выбраны направления, в которых функция плотности распределения достигает локального максимума — первого и второго по величине. Эти направления и будут соответствовать первой и второй моде распределения направлений. 8.2.2 Практика В практической части данного раздела мы будем работать с массивом среднемесячных значений метеопараметров в пограничном слое атмосферы по полярным аэрологическим обсерваториям России. Массив данных ежемесячно обновляется на портале Аисори-М ВНИИГМИ-МЦД. В системе доступны данные по следующим обсерваториям: obs = readxl::read_excel(&#39;bound/scheme.xlsx&#39;, 2) Индекс Название Широта Долгота 20674 Остров Диксон 73.50 80.42 21824 Тикси 71.35 128.55 22113 Мурманск 68.59 33.07 22217 Кандалакша 67.09 32.21 22271 Шойна 67.53 44.09 23078 Норильск 69.20 88.18 23205 Нарьян-Мар 67.39 53.07 23330 Салехард 66.32 66.40 24125 Оленек 68.31 112.26 24266 Верхоянск 67.55 133.38 24343 Жиганск 66.46 123.21 89512 Новолазаревская -70.75 11.83 89592 Мирный -66.65 19.71 Для каждой обсерватории даны следующие параметры: Призначная часть/ метеоэлемент/число наблюдений Обозначение Число цифр Единицы измерения Константа отсутствия Индекс станции INDEX 5 - нет Год GGGG 5 - нет Месяц MM 3 - нет Срок HH 3 GMT нет Стандартное значение высоты Z 6 м нет Среднемесячные значения давления MP 6 10·гПа -9999 Среднеквадратические отклонения давления SP 6 10·гПа -9999 Число наблюдений для давления NP 3 - нет Среднемесячные значения температуры MT 6 10·°C -9999 Среднеквадратические отклонения температуры ST 6 10·°C -9999 Число наблюдений для температуры NT 3 - нет Среднемесячные значения дефицита точки росы MD 6 10·°C -9999 Среднеквадратические отклонения дефицита точки росы SD 6 10·°C -9999 Число наблюдений для дефицита точки росы ND 3 - нет Среднемесячные значения скалярной скорости ветра MS 6 10·м/с -9999 Среднеквадратические отклонения скалярной скорости ветра SS 6 10·м/с -9999 Число наблюдений для скалярной скорости ветра NS 3 - нет Среднемесячные значения зональной составляющей скорости ветра MU 6 10·м/с -9999 Среднеквадратические отклонения зональной составляющей скорости ветра SU 6 10·м/с -9999 Число наблюдений для зональной составляющей скорости ветра NU 3 - нет Среднемесячные значения меридиональной составляющей скорости ветра MV 6 10·м/с -9999 Среднеквадратические отклонения меридиональной составляющей скорости ветра SV 6 10·м/с -9999 Число наблюдений для меридиональной составляющей скорости ветра NV 3 - нет Загрузим данные по обсерватории в городе Кандалакша: (kand = readr::read_table(&#39;bound/b22217.txt&#39;, col_names = params$Обозначение)) ## # A tibble: 6,279 x 23 ## INDEX GGGG MM HH Z MP SP NP MT ST NT MD ## &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; &lt;int&gt; ## 1 22217 2007 1 0 2000 7625 64 31 -143 44 31 87 ## 2 22217 2007 1 0 1900 7726 66 31 -137 44 31 85 ## 3 22217 2007 1 0 1800 7829 67 31 -130 44 31 80 ## 4 22217 2007 1 0 1700 7932 68 31 -124 44 31 72 ## 5 22217 2007 1 0 1600 8037 69 31 -118 43 31 67 ## 6 22217 2007 1 0 1500 8143 71 31 -113 42 31 61 ## 7 22217 2007 1 0 1400 8250 72 31 -107 41 31 57 ## 8 22217 2007 1 0 1300 8358 73 31 -102 40 31 55 ## 9 22217 2007 1 0 1200 8467 75 31 -97 39 31 53 ## 10 22217 2007 1 0 1100 8577 76 31 -92 39 31 51 ## # ... with 6,269 more rows, and 11 more variables: SD &lt;int&gt;, ND &lt;int&gt;, ## # MS &lt;int&gt;, SS &lt;int&gt;, NS &lt;int&gt;, MU &lt;int&gt;, SU &lt;int&gt;, NU &lt;int&gt;, MV &lt;int&gt;, ## # SV &lt;int&gt;, NV &lt;int&gt; Выберем данные по высоте 50 метров за 12 часов дня, сохранив только составляющие скорости и ее скалярную величину: (kand_wind = kand %&gt;% filter(HH == 12, Z == 0) %&gt;% dplyr::select(MU, MV, SS)) ## # A tibble: 135 x 3 ## MU MV SS ## &lt;int&gt; &lt;int&gt; &lt;int&gt; ## 1 -3 3 25 ## 2 -4 -6 13 ## 3 -2 16 13 ## 4 7 0 23 ## 5 1 6 23 ## 6 -4 -12 16 ## 7 -3 4 12 ## 8 -3 10 12 ## 9 -1 12 14 ## 10 4 11 10 ## # ... with 125 more rows Создадим объект типа circular для анализа, предварительно определив вспомогательную функцию, вычисляющую географический азимут на основе компонент скорости: geo_azimuth = function(dx, dy) { a = atan2(dx, dy) ifelse(a &lt;= pi/2, pi/2 - a, 5*pi/2 - a) } (winds = circular(geo_azimuth(kand_wind$MV, kand_wind$MU), template = &#39;geographics&#39;)) ## Circular Data: ## Type = angles ## Units = radians ## Template = geographics ## Modulo = asis ## Zero = 1.570796 ## Rotation = clock ## [1] 5.49778714 3.72959526 6.15883031 1.57079633 0.16514868 3.46334321 ## [7] 5.63968420 5.99172851 6.20004408 0.34877100 5.81953770 0.00000000 ## [13] 5.49778714 4.71238898 5.49778714 6.15883031 4.51499342 5.58844703 ## [19] 3.38657132 0.32175055 1.47112767 6.15883031 5.23153509 5.86496098 ## [25] 4.33188260 5.23153509 1.81577499 2.24553727 5.96143475 3.78509376 ## [31] 0.00000000 5.92441464 0.34877100 2.15879893 5.78383859 4.03764804 ## [37] 4.46741032 5.11728077 2.77441882 0.27829966 5.74276581 0.58800260 ## [43] 0.18534795 0.78539816 2.35619449 1.24904577 2.97644398 3.66073877 ## [49] 5.60844436 3.46334321 0.69473828 1.69515132 5.86496098 6.05638646 ## [55] 0.00000000 5.99172851 5.72458599 0.24497866 0.00000000 5.87829352 ## [61] 5.49778714 6.02258292 0.32175055 5.90267893 0.64350111 6.01693326 ## [67] 0.64350111 6.15883031 5.88839419 4.39063843 5.90267893 5.03413953 ## [73] 3.14159265 4.71238898 2.81984210 0.21866895 5.98030044 5.72458599 ## [79] 5.60844436 6.18351665 5.42101525 2.26553460 5.03413953 5.03413953 ## [85] 3.70019197 6.13053598 2.03444394 2.24553727 5.03413953 4.57049193 ## [91] 5.84655815 5.49778714 1.89254688 5.81953770 3.14159265 5.11728077 ## [97] 5.30039158 0.09065989 0.64350111 5.09289536 4.95736764 0.00000000 ## [103] 2.35619449 5.99172851 4.71238898 3.83633093 5.94016137 1.10714872 ## [109] 5.58844703 5.90267893 2.03444394 5.78383859 0.32175055 4.71238898 ## [115] 1.57079633 5.25280848 2.94419709 5.17603659 1.57079633 1.24904577 ## [121] 3.92699082 2.78282198 4.39063843 5.49778714 0.32175055 5.21948748 ## [127] 4.71238898 6.03820664 5.49778714 5.03413953 4.12438638 2.67794504 ## [133] 6.06451636 0.00000000 2.67794504 Отобразим распределение направлений, розу-диаграмму, плотность распределения и преобладающее направление: plot.circular(winds, cex = 0.5, stack = TRUE, sep = 0.035, axes = FALSE) rose.diag(winds, bins = 8, col = &#39;gray70&#39;, border = &#39;gray30&#39;, prop = 1, add = TRUE, tick = FALSE, lwd = 0.5) kden = kern.den.circ(winds) lines(kden, shrink = 3, join=F) peak = findpeaks(kden$y, sortstr = T)[1,2] xp &lt;- sin(kden$x[peak]) yp &lt;- cos(kden$x[peak]) lines(c(0, xp), c(0, yp), lwd = 2) На график можно добавить оценку плотности распределения, для этого ее необъодимо предварительно вычислить: 8.3 Статистика временных данных 8.3.1 Работа с датами в lubridate 8.3.2 Проверка гипотез 8.3.3 Анимация 8.4 Контрольные вопросы и упражнения 8.4.1 Вопросы 8.4.2 Упражнения "]
]
