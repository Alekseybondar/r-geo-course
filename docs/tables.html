<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Визуализация и анализ географических данных на языке R</title>
  <meta name="description" content="Курс лекций, посвященных использованию языка программирования R для визуализации и анализа географических данных">
  <meta name="generator" content="bookdown 0.5 and GitBook 2.6.7">

  <meta property="og:title" content="Визуализация и анализ географических данных на языке R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Курс лекций, посвященных использованию языка программирования R для визуализации и анализа географических данных" />
  <meta name="github-repo" content="tsamsonov/r-geo-course" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Визуализация и анализ географических данных на языке R" />
  
  <meta name="twitter:description" content="Курс лекций, посвященных использованию языка программирования R для визуализации и анализа географических данных" />
  

<meta name="author" content="Тимофей Самсонов">


<meta name="date" content="2017-09-30">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="matrix-dataframes.html">

<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-0.9/htmlwidgets.js"></script>
<script src="libs/datatables-binding-0.2/datatables.js"></script>
<link href="libs/dt-core-1.10.12/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.12/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.12/js/jquery.dataTables.min.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Визуализация и анализ географических данных на языке R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Введение</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#---"><i class="fa fa-check"></i>Установка и подключение пакетов</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#---"><i class="fa fa-check"></i>Как работать с кодом</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#------"><i class="fa fa-check"></i>Как получить справку по функциям и пакетам</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#----r"><i class="fa fa-check"></i>Стандарт оформления кода на R</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#d09ad0bed0bcd0bcd0b5d0bdd182d0b0d180d0b8d0b8"><i class="fa fa-check"></i>Комментарии</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#--"><i class="fa fa-check"></i>Названия специальных символов</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#-"><i class="fa fa-check"></i>Как ссылаться</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="data-types.html"><a href="data-types.html"><i class="fa fa-check"></i><b>1</b> Атомарные типы данных</a><ul>
<li class="chapter" data-level="1.1" data-path="data-types.html"><a href="data-types.html#numbers"><i class="fa fa-check"></i><b>1.1</b> Числа</a><ul>
<li class="chapter" data-level="1.1.1" data-path="data-types.html"><a href="data-types.html#number_functions"><i class="fa fa-check"></i><b>1.1.1</b> Числовые функции</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="data-types.html"><a href="data-types.html#strings"><i class="fa fa-check"></i><b>1.2</b> Строки</a></li>
<li class="chapter" data-level="1.3" data-path="data-types.html"><a href="data-types.html#dates"><i class="fa fa-check"></i><b>1.3</b> Даты</a></li>
<li class="chapter" data-level="1.4" data-path="data-types.html"><a href="data-types.html#booleans"><i class="fa fa-check"></i><b>1.4</b> Логические</a></li>
<li class="chapter" data-level="1.5" data-path="data-types.html"><a href="data-types.html#questions_tasks_basics"><i class="fa fa-check"></i><b>1.5</b> Контрольные вопросы и задачи</a><ul>
<li class="chapter" data-level="1.5.1" data-path="data-types.html"><a href="data-types.html#questions_basics"><i class="fa fa-check"></i><b>1.5.1</b> Вопросы</a></li>
<li class="chapter" data-level="1.5.2" data-path="data-types.html"><a href="data-types.html#tasks_basics"><i class="fa fa-check"></i><b>1.5.2</b> Задачи</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="vectors.html"><a href="vectors.html"><i class="fa fa-check"></i><b>2</b> Векторы</a><ul>
<li class="chapter" data-level="2.1" data-path="vectors.html"><a href="vectors.html#vector_creation"><i class="fa fa-check"></i><b>2.1</b> Создание вектора</a></li>
<li class="chapter" data-level="2.2" data-path="vectors.html"><a href="vectors.html#vector_elements"><i class="fa fa-check"></i><b>2.2</b> Работа с элементами вектора</a></li>
<li class="chapter" data-level="2.3" data-path="vectors.html"><a href="vectors.html#vector_transform"><i class="fa fa-check"></i><b>2.3</b> Анализ и преобразования векторов</a></li>
<li class="chapter" data-level="2.4" data-path="vectors.html"><a href="vectors.html#vector_search_sorting"><i class="fa fa-check"></i><b>2.4</b> Поиск и сортировка элементов</a></li>
<li class="chapter" data-level="2.5" data-path="vectors.html"><a href="vectors.html#questions_tasks_vectors"><i class="fa fa-check"></i><b>2.5</b> Контрольные вопросы и задачи</a><ul>
<li class="chapter" data-level="2.5.1" data-path="vectors.html"><a href="vectors.html#questions_vectors"><i class="fa fa-check"></i><b>2.5.1</b> Вопросы</a></li>
<li class="chapter" data-level="2.5.2" data-path="vectors.html"><a href="vectors.html#tasks_vectors"><i class="fa fa-check"></i><b>2.5.2</b> Задачи</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="matrix-dataframes.html"><a href="matrix-dataframes.html"><i class="fa fa-check"></i><b>3</b> Матрицы, фреймы данных и списки</a><ul>
<li class="chapter" data-level="3.1" data-path="matrix-dataframes.html"><a href="matrix-dataframes.html#matrices"><i class="fa fa-check"></i><b>3.1</b> Матрицы</a></li>
<li class="chapter" data-level="3.2" data-path="matrix-dataframes.html"><a href="matrix-dataframes.html#arrays"><i class="fa fa-check"></i><b>3.2</b> Массивы</a></li>
<li class="chapter" data-level="3.3" data-path="matrix-dataframes.html"><a href="matrix-dataframes.html#data_frames"><i class="fa fa-check"></i><b>3.3</b> Фреймы данных</a></li>
<li class="chapter" data-level="3.4" data-path="matrix-dataframes.html"><a href="matrix-dataframes.html#lists"><i class="fa fa-check"></i><b>3.4</b> Списки</a></li>
<li class="chapter" data-level="3.5" data-path="matrix-dataframes.html"><a href="matrix-dataframes.html#questions_tasks_matrix"><i class="fa fa-check"></i><b>3.5</b> Контрольные вопросы и задачи</a><ul>
<li class="chapter" data-level="3.5.1" data-path="matrix-dataframes.html"><a href="matrix-dataframes.html#questions_matrix"><i class="fa fa-check"></i><b>3.5.1</b> Вопросы</a></li>
<li class="chapter" data-level="3.5.2" data-path="matrix-dataframes.html"><a href="matrix-dataframes.html#tasks_matrix"><i class="fa fa-check"></i><b>3.5.2</b> Задачи</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="tables.html"><a href="tables.html"><i class="fa fa-check"></i><b>4</b> Чтение и обработка таблиц</a><ul>
<li class="chapter" data-level="4.1" data-path="tables.html"><a href="tables.html#set_directory"><i class="fa fa-check"></i><b>4.1</b> Установка рабочей директории</a></li>
<li class="chapter" data-level="4.2" data-path="tables.html"><a href="tables.html#reading_csv"><i class="fa fa-check"></i><b>4.2</b> Чтение таблиц CSV</a></li>
<li class="chapter" data-level="4.3" data-path="tables.html"><a href="tables.html#filtering_sorting"><i class="fa fa-check"></i><b>4.3</b> Фильтрация, сортировка, работа с элементами таблицы</a></li>
<li class="chapter" data-level="4.4" data-path="tables.html"><a href="tables.html#excel_reading"><i class="fa fa-check"></i><b>4.4</b> Чтение таблиц Microsoft Excel</a></li>
<li class="chapter" data-level="4.5" data-path="tables.html"><a href="tables.html#missed_values"><i class="fa fa-check"></i><b>4.5</b> Пропущенные значения</a></li>
<li class="chapter" data-level="4.6" data-path="tables.html"><a href="tables.html#filtering_text"><i class="fa fa-check"></i><b>4.6</b> Фильтрация по текстовым полям</a></li>
<li class="chapter" data-level="4.7" data-path="tables.html"><a href="tables.html#data_conversion"><i class="fa fa-check"></i><b>4.7</b> Преобразование типов данных и исправление ошибок</a></li>
<li class="chapter" data-level="4.8" data-path="tables.html"><a href="tables.html#table_writing"><i class="fa fa-check"></i><b>4.8</b> Сохранение таблиц CSV и Microsoft Excel</a></li>
<li class="chapter" data-level="4.9" data-path="tables.html"><a href="tables.html#table_rules"><i class="fa fa-check"></i><b>4.9</b> Правила подготовки таблиц для чтения в R</a></li>
<li class="chapter" data-level="4.10" data-path="tables.html"><a href="tables.html#questions_tables"><i class="fa fa-check"></i><b>4.10</b> Контрольные вопросы</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://istina.msu.ru/profile/tsamsonov/" target="blank">Тимофей Самсонов</a></li>
<li><a href="https://doi.org/10.5281/zenodo.901911"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.901911.svg" title="DOI"></a><li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Визуализация и анализ географических данных на языке R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="tables" class="section level1">
<h1><span class="header-section-number">Глава 4</span> Чтение и обработка таблиц</h1>
<p>Данный модуль посвящен введению в работу с таблицами. В модуле рассмотрены важные процедуры предварительной обработки таблиц, такие как фильтрация, исправление ошибок, преобразование типов — необходимые для дальнейшей визуализации и анализа данных</p>
<p>Выполните установку и подключение пакета <code>openxlsx</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(openxlsx)</code></pre></div>
<div id="set_directory" class="section level2">
<h2><span class="header-section-number">4.1</span> Установка рабочей директории</h2>
<p>Прежде чем мы начнем работать с данными, необходимо установить рабочую директорию. Это папка, в которой лежат необходимые вам таблицы. Для этого используем функцию <code>setwd()</code>. Аргумент функции нужно заменить на адрес каталога на вашем компьютере, в который вы положили присланные файлы:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">setwd</span>(<span class="st">&quot;/Volumes/Data/GitHub/r-geo-course/data&quot;</span>)</code></pre></div>
<blockquote>
<p>Внимание: если вы выполняете данный модуль на своем компьютере, замените вышеуказанный путь на путь к каталогу, в который вы положили исходные данные.</p>
</blockquote>
<p>Теоретически рабочую директорию можно и не устанавливать, однако тогда при чтении файлов вам придется каждый раз указывать полный путь, что неудобно.</p>
<blockquote>
<p>Рабочая директория и местоположение скрипта могут не совпадать. Вы можете хранить их в разных местах. Однако рекомендуется держать их вместе, что облегчит передачу вашей программы вместе с данными другим пользователям.</p>
</blockquote>
</div>
<div id="reading_csv" class="section level2">
<h2><span class="header-section-number">4.2</span> Чтение таблиц CSV</h2>
<p>Таблицы в формате <strong>CSV</strong> (Comma-Separated Values) можно прочесть с помощью универсальной функции <code>read.table()</code>. Следующие ее параметры важно указать:</p>
<ul>
<li><code>file</code> — название файла</li>
<li><code>sep</code> — разделитель ячеек</li>
<li><code>dec</code> — десятичный разделитель</li>
<li><code>header</code> — содержится ли в первой строке заголовок — <code>encoding</code> — кодировка символов, в которой сохранен файл (чаще всего <code>UTF-8</code> или <code>CP1251</code>)</li>
</ul>
<blockquote>
<p>Стандартной кодировкой для представления текста в UNIX-подобных системах (<em>Ubuntu</em>, <em>macOS</em> и т.д.) является <strong>UTF-8 (Unicode)</strong>, в русскоязычных версиях <em>Windows</em> — <strong>CP1251 (Windows-1251)</strong>. Текстовый файл <strong>CSV</strong>, созданный в разных операционных системах, будет по умолчанию сохраняться в соответствующей кодировке, если вы не указали ее явным образом. Если при загрузке таблицы в <strong>R</strong> вы видите вместо текста нечитаемые символы — <em>кракозябры</em> — то, скорее всего, вы читаете файл не в той кодировке, в которой он был сохранен. Попробуйте поменять <code>UTF-8</code> на <code>CP1251</code> или наоборот. Если вы не знаете, что такое кодировка и Юникод, то вам <a href="https://ru.wikipedia.org/wiki/Набор_символов">сюда</a>.</p>
</blockquote>
<p>Прочтем таблицу с данными Росстата по объему сброса сточных вод в бассейны некоторых морей России (в млн. м<span class="math inline">\(^3\)</span>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tab &lt;-<span class="st"> </span><span class="kw">read.table</span>(<span class="st">&quot;oxr_vod.csv&quot;</span>,
                  <span class="dt">sep =</span> <span class="st">&#39;;&#39;</span>,
                  <span class="dt">dec =</span> <span class="st">&#39;,&#39;</span>,
                  <span class="dt">header =</span> <span class="ot">TRUE</span>,
                  <span class="dt">encoding =</span> <span class="st">&#39;UTF-8&#39;</span>)</code></pre></div>
<p>Для просмотра таблицы в привычном виде воспользуйтесь функцией <code>View()</code>. В этом представлении вы можете фильтровать и сортировать данные:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">View</span>(tab)</code></pre></div>
<div id="htmlwidget-f2fc454a9f4da1dd0963" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f2fc454a9f4da1dd0963">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22"],[1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014],[27.2,24.6,24.5,22.4,23,22,20.7,20.3,19.8,19.8,19,18.5,17.7,17.5,17.2,17.1,15.9,16.5,16,15.7,15.2,14.8],[2.5,2.3,2.3,2.2,2.2,2.2,2.2,2.2,2.1,2,2,2,2,1.9,1.9,1.9,1.8,2,1.9,1.8,1.8,1.7],[0.4,0.4,0.4,0.3,0.3,0.3,0.3,0.3,0.3,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2],[4.3,3.2,3.5,3.1,3.8,3.2,2.5,2,1.9,2,2.1,2.1,1.6,1.7,1.7,1.6,1.5,1.6,1.6,1.6,1.6,1.5],[12.1,11,10.4,9.8,9.8,9.5,9.1,9.2,8.9,9.2,8.4,8.3,8,7.8,7.4,7.5,6.8,7.3,7.1,7,6.9,6.4],[5.3,5,5.2,4.7,4.4,4.2,4.1,4.2,4.2,4.1,4,3.8,3.8,3.8,3.8,3.9,3.5,3.3,3.2,3,3,3.2],[1,0.9,0.9,0.8,0.8,0.8,0.8,0.9,0.9,0.8,0.8,0.8,0.8,0.8,0.8,0.8,0.7,0.7,0.7,0.7,0.6,0.6],[1.6,1.8,1.8,1.5,1.7,1.8,1.7,1.5,1.5,1.5,1.5,1.3,1.3,1.3,1.4,1.2,1.4,1.4,1.3,1.4,1.1,1.2]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Год<\/th>\n      <th>Всего<\/th>\n      <th>Балтийское<\/th>\n      <th>Черное<\/th>\n      <th>Азовское<\/th>\n      <th>Каспийское<\/th>\n      <th>Карское<\/th>\n      <th>Белое<\/th>\n      <th>Прочие<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
<p>Существуют более специальные функции для чтения таблиц <strong>CSV</strong>: <code>read.csv()</code> и <code>read.csv2()</code>. По сути они являются “обертками” (<em>wrappers</em>) функции <code>read.table()</code> и выполняют ее вызов с автоматической подстановкой параметров <code>sep</code>, <code>dec</code> и <code>header</code>. Обе функции по умолчанию предполагают, что в файле имеется заголовок. <code>read.csv()</code> удобна для чтения таблиц с десятичной точкой и запятой-разделителем, а <code>read.csv2()</code> — для таблиц с десятичной запятой и точкой-с-запятой в качестве разделителя.</p>
<p>Используем для чтения <code>read.csv2()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tab2&lt;-<span class="kw">read.csv2</span>(<span class="st">&quot;oxr_vod.csv&quot;</span>, <span class="dt">encoding =</span> <span class="st">&#39;UTF-8&#39;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">View</span>(tab2)</code></pre></div>
<p><div id="htmlwidget-749f4194093f16bf5ac2" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-749f4194093f16bf5ac2">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22"],[1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014],[27.2,24.6,24.5,22.4,23,22,20.7,20.3,19.8,19.8,19,18.5,17.7,17.5,17.2,17.1,15.9,16.5,16,15.7,15.2,14.8],[2.5,2.3,2.3,2.2,2.2,2.2,2.2,2.2,2.1,2,2,2,2,1.9,1.9,1.9,1.8,2,1.9,1.8,1.8,1.7],[0.4,0.4,0.4,0.3,0.3,0.3,0.3,0.3,0.3,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2,0.2],[4.3,3.2,3.5,3.1,3.8,3.2,2.5,2,1.9,2,2.1,2.1,1.6,1.7,1.7,1.6,1.5,1.6,1.6,1.6,1.6,1.5],[12.1,11,10.4,9.8,9.8,9.5,9.1,9.2,8.9,9.2,8.4,8.3,8,7.8,7.4,7.5,6.8,7.3,7.1,7,6.9,6.4],[5.3,5,5.2,4.7,4.4,4.2,4.1,4.2,4.2,4.1,4,3.8,3.8,3.8,3.8,3.9,3.5,3.3,3.2,3,3,3.2],[1,0.9,0.9,0.8,0.8,0.8,0.8,0.9,0.9,0.8,0.8,0.8,0.8,0.8,0.8,0.8,0.7,0.7,0.7,0.7,0.6,0.6],[1.6,1.8,1.8,1.5,1.7,1.8,1.7,1.5,1.5,1.5,1.5,1.3,1.3,1.3,1.4,1.2,1.4,1.4,1.3,1.4,1.1,1.2]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Год<\/th>\n      <th>Всего<\/th>\n      <th>Балтийское<\/th>\n      <th>Черное<\/th>\n      <th>Азовское<\/th>\n      <th>Каспийское<\/th>\n      <th>Карское<\/th>\n      <th>Белое<\/th>\n      <th>Прочие<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4,5,6,7,8,9]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script> Как видно, данная таблица не отличается от предыдущей, но ее чтение более компактно.</p>
</div>
<div id="filtering_sorting" class="section level2">
<h2><span class="header-section-number">4.3</span> Фильтрация, сортировка, работа с элементами таблицы</h2>
<p>Распространенные операции с таблицами — это упорядочение по определенному столбцу и фильтрация по значениям. Мы уже знаем что из вектора, матрицы или таблицы можно извлекать элементы: <code>tab[V, ]</code>, где <code>tab</code> — имя таблицы, <code>V</code> — это вектор из номеров элементов. Например, извлечь 5, 2 и 4 строку таблицы можно так:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tab[<span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">2</span>,<span class="dv">4</span>), ]
##    Год Всего Балтийское Черное Азовское Каспийское Карское Белое Прочие
## 5 1997  23.0        2.2    0.3      3.8        9.8     4.4   0.8    1.7
## 2 1994  24.6        2.3    0.4      3.2       11.0     5.0   0.9    1.8
## 4 1996  22.4        2.2    0.3      3.1        9.8     4.7   0.8    1.5</code></pre></div>
<p>Логично предположить, что таким же образом можно извлечь элементы таблицы в порядке, обеспечивающем возрастание или убывание значений в каком-то столбце. Для этого нужно правильным образом расставить индексы в векторе <code>c(...)</code>. Существует специальная функция <code>order()</code>, которая позволяет это сделать. Например, отсортируем таблицу по возрастанию сбросов в Каспийское море:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">indexes&lt;-<span class="kw">order</span>(tab<span class="op">$</span>Каспийское)
<span class="kw">head</span>(tab[indexes, ])
##     Год Всего Балтийское Черное Азовское Каспийское Карское Белое Прочие
## 22 2014  14.8        1.7    0.2      1.5        6.4     3.2   0.6    1.2
## 17 2009  15.9        1.8    0.2      1.5        6.8     3.5   0.7    1.4
## 21 2013  15.2        1.8    0.2      1.6        6.9     3.0   0.6    1.1
## 20 2012  15.7        1.8    0.2      1.6        7.0     3.0   0.7    1.4
## 19 2011  16.0        1.9    0.2      1.6        7.1     3.2   0.7    1.3
## 18 2010  16.5        2.0    0.2      1.6        7.3     3.3   0.7    1.4</code></pre></div>
<blockquote>
<p>Используйте функцию <code>head()</code>, чтобы отобразить первые несколько строк таблицы. Эта возможность особенно полезна при работе с большими таблицами</p>
</blockquote>
<p>Если упорядочение несложное, программист его скорее всего вставит непосредственно в инструкцию обращения к таблице:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(tab[<span class="kw">order</span>(tab<span class="op">$</span>Каспийское), ])
##     Год Всего Балтийское Черное Азовское Каспийское Карское Белое Прочие
## 22 2014  14.8        1.7    0.2      1.5        6.4     3.2   0.6    1.2
## 17 2009  15.9        1.8    0.2      1.5        6.8     3.5   0.7    1.4
## 21 2013  15.2        1.8    0.2      1.6        6.9     3.0   0.6    1.1
## 20 2012  15.7        1.8    0.2      1.6        7.0     3.0   0.7    1.4
## 19 2011  16.0        1.9    0.2      1.6        7.1     3.2   0.7    1.3
## 18 2010  16.5        2.0    0.2      1.6        7.3     3.3   0.7    1.4</code></pre></div>
<p>Схожим образом реализована <em>фильтрация данных</em> по значению. Например, вы хотите извлечь из таблицы только те года, в которых объем сбросов в Каспийское море составил более 10 млн м<span class="math inline">\(^3\)</span>. Здесь используется еще одна возможность извлечения элементов таблицы — с помощью вектора логических значений <code>TRUE/FALSE</code>. Число элементов в этом векторе должно быть равно числу элементов в индексируемом векторе, а значение указывает на то, нужно ли извлекать (<code>TRUE</code>) или нет (<code>FALSE</code>) элемент с текущим индексом. Вектор логических значений получается естественным путем с помощью операции сравнения:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">condition &lt;-<span class="st"> </span>tab<span class="op">$</span>Каспийское <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>
condition  <span class="co"># посмотрим что получилось</span>
##  [1]  TRUE  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [12] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
tab[condition, ] <span class="co"># используем его для фильтрации строк таблицы:</span>
##    Год Всего Балтийское Черное Азовское Каспийское Карское Белое Прочие
## 1 1993  27.2        2.5    0.4      4.3       12.1     5.3   1.0    1.6
## 2 1994  24.6        2.3    0.4      3.2       11.0     5.0   0.9    1.8
## 3 1995  24.5        2.3    0.4      3.5       10.4     5.2   0.9    1.8</code></pre></div>
<p>Опять же, весьма часто используется запись одним выражением:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tab[tab<span class="op">$</span>Каспийское <span class="op">&gt;</span><span class="st"> </span><span class="dv">10</span>, ]
##    Год Всего Балтийское Черное Азовское Каспийское Карское Белое Прочие
## 1 1993  27.2        2.5    0.4      4.3       12.1     5.3   1.0    1.6
## 2 1994  24.6        2.3    0.4      3.2       11.0     5.0   0.9    1.8
## 3 1995  24.5        2.3    0.4      3.5       10.4     5.2   0.9    1.8</code></pre></div>
<p>Можно создать новую таблицу, выбрав необходимые столбцы:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">caspian &lt;-<span class="st"> </span><span class="kw">data.frame</span>(tab<span class="op">$</span>Год, tab<span class="op">$</span>Всего, tab<span class="op">$</span>Каспийское)</code></pre></div>
<p>Следует заметить, что не рекомендуется использовать кириллические названия столбцов (см. <a href="tables.html#table_rules">Правила подготовки таблиц для чтения в R</a> в конце данного модуля), поэтому переименуем их:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colnames</span>(caspian)&lt;-<span class="kw">c</span>(<span class="st">&quot;Year&quot;</span>, <span class="st">&quot;Total&quot;</span>, <span class="st">&quot;Caspian&quot;</span>)</code></pre></div>
<p>Предположим, что теперь нам необходимо вычислить долю сбросов в Каспийское море в общем объеме и записать ее в новый столбец с точностью до 3 знаков после запятой. Для этого сначала произведем вычисления:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ratio &lt;-<span class="st"> </span>caspian<span class="op">$</span>Caspian <span class="op">/</span><span class="st"> </span>caspian<span class="op">$</span>Total
ratio
##  [1] 0.4448529 0.4471545 0.4244898 0.4375000 0.4260870 0.4318182 0.4396135
##  [8] 0.4532020 0.4494949 0.4646465 0.4421053 0.4486486 0.4519774 0.4457143
## [15] 0.4302326 0.4385965 0.4276730 0.4424242 0.4437500 0.4458599 0.4539474
## [22] 0.4324324</code></pre></div>
<p>Далее округлим результат с помощью функции <code>round()</code> с параметром <code>digits</code>, указывающим число значащих цифр в ответе:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">ratio &lt;-<span class="st"> </span><span class="kw">round</span>(ratio, <span class="dt">digits =</span> <span class="dv">3</span>)
ratio
##  [1] 0.445 0.447 0.424 0.438 0.426 0.432 0.440 0.453 0.449 0.465 0.442
## [12] 0.449 0.452 0.446 0.430 0.439 0.428 0.442 0.444 0.446 0.454 0.432</code></pre></div>
<p>Существует простой и элегантный способ создать новый столбец в таблице — достаточно указать его название после значка <code>$</code>. Если среда R не обнаруживает столбец с таким названием, она его создаст:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">caspian<span class="op">$</span>CaspianRatio &lt;-<span class="st"> </span>ratio</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">View</span>(caspian)</code></pre></div>
<p><div id="htmlwidget-58e8dc784decbfd648f5" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-58e8dc784decbfd648f5">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22"],[1993,1994,1995,1996,1997,1998,1999,2000,2001,2002,2003,2004,2005,2006,2007,2008,2009,2010,2011,2012,2013,2014],[27.2,24.6,24.5,22.4,23,22,20.7,20.3,19.8,19.8,19,18.5,17.7,17.5,17.2,17.1,15.9,16.5,16,15.7,15.2,14.8],[12.1,11,10.4,9.8,9.8,9.5,9.1,9.2,8.9,9.2,8.4,8.3,8,7.8,7.4,7.5,6.8,7.3,7.1,7,6.9,6.4],[0.445,0.447,0.424,0.438,0.426,0.432,0.44,0.453,0.449,0.465,0.442,0.449,0.452,0.446,0.43,0.439,0.428,0.442,0.444,0.446,0.454,0.432]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Year<\/th>\n      <th>Total<\/th>\n      <th>Caspian<\/th>\n      <th>CaspianRatio<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[1,2,3,4]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script> К столбцу таблицы можно обращаться по номеру, а не названию. Если вы указываете в квадратных скобках номер без запятой, он трактуется как номер столбца. При этом возвращаемый столбец имеет тип <code>data.frame</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">head</span>(caspian[<span class="dv">2</span>])  <span class="co"># второй столбец (фактически — таблица из одного столбца)</span>
##   Total
## 1  27.2
## 2  24.6
## 3  24.5
## 4  22.4
## 5  23.0
## 6  22.0
<span class="kw">head</span>(caspian[<span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">4</span>)])  <span class="co"># первый и четвертый столбец</span>
##   Year CaspianRatio
## 1 1993        0.445
## 2 1994        0.447
## 3 1995        0.424
## 4 1996        0.438
## 5 1997        0.426
## 6 1998        0.432</code></pre></div>
<p>В противоположность этому, более привычная форма обращения к двумерным данным через запятую приведет к тому, что столбец будет возвращен как вектор:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">caspian[,<span class="dv">2</span>]
##  [1] 27.2 24.6 24.5 22.4 23.0 22.0 20.7 20.3 19.8 19.8 19.0 18.5 17.7 17.5
## [15] 17.2 17.1 15.9 16.5 16.0 15.7 15.2 14.8</code></pre></div>
<p>Использование той или иной формы зависит от контекста.</p>
</div>
<div id="excel_reading" class="section level2">
<h2><span class="header-section-number">4.4</span> Чтение таблиц Microsoft Excel</h2>
<p>Чтение таблиц <strong>Microsoft Excel</strong> производится с помощью функции <code>read.xlsx()</code> из пакета <code>openxlsx</code>. В качестве обязательных параметров они принимают следующие аргументы:</p>
<ul>
<li><code>xlsxFile</code> — название файла</li>
<li><code>sheet</code> — номер листа</li>
</ul>
<p>Убедитесь, что у вас установлена и подключена библиотека <code>openxlsx</code>.</p>
<p>Откроем таблицу с данными Росстата по сбросу загрязненных сточных вод в поверхностные водные объекты (млн м<span class="math inline">\(^3\)</span>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">sewage&lt;-<span class="kw">read.xlsx</span>(<span class="st">&quot;sewage.xlsx&quot;</span>,<span class="dv">1</span>) <span class="co"># Читаем таблицу из первого листа</span>
## Warning in read.xlsx.default(&quot;sewage.xlsx&quot;, 1): &#39;.Random.seed&#39; не является
## целочисленным вектором, он типа &#39;NULL&#39;, и поэтому пропущен</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">View</span>(sewage)</code></pre></div>
<p><div id="htmlwidget-ee63615de203760b95e4" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-ee63615de203760b95e4">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97"],["Российская Федерация","Центральный федеральный округ ","Белгородская область","Брянская область","Владимирская область","Воронежская область","Ивановская область","Калужская область","Костромская область","Курская область","Липецкая область","Московская область1) ","Орловская область","Рязанская область","Смоленская область","Тамбовская область","Тверская область","Тульская область","Ярославская область","г. Москва1)","Северо-Западный федеральный округ ","Республика Карелия","Республика Коми","Архангельская область","в том числе:","Ненецкий автономный округ","Архангельская область без автономного округа","Вологодская область","Калинингpадская область","Ленинградская область","Мурманская область","Новгородская область","Псковская область","г. Санкт-Петербург","Южный федеральный округ ","Республика Адыгея","Республика Калмыкия","Краснодарский край","Астраханская область","Волгоградская область","Ростовская область","Северо-Кавказский федеральный округ ","Республика Дагестан","Республика Ингушетия ","Кабардино-Балкарская Республика","Карачаево-Черкесская Республика","Республика Северная Осетия - Алания","Чеченская Республика ","Приволжский федеральный округ ","Республика Башкортостан","Республика Марий Эл","Республика Мордовия","Республика Татарстан","Удмуртская Республика","Чувашская Республика","Пермский край","Кировская область","Нижегородская область","Оренбургская область","Пензенская область","Самарская область","Саратовская область","Ульяновская область","Уральский федеральный округ ","Курганская область","Свердловская область","Тюменская область","в том числе:","Ханты-Мансийский автономный округ - Югра","Ямало-Ненецкий автономный округ","Тюменская область без автономных округов","Челябинская область","Сибирский федеральный округ ","Республика Алтай","Республика Бурятия","Республика Тыва","Республика Хакасия","Алтайский край","Забайкальский край","Красноярский край","Иркутская область","Кемеровская область","Новосибирская область","Омская область","Томская область","Дальневосточный федеральный округ ","Республика Саха (Якутия)","Камчатский край","Приморский край","Хабаровский край","Амурская область","Магаданская область","Сахалинская область","Еврейская автономная область","Чукотский автономный округ","ѕ ѕ ѕ ѕ ѕ ","1) Данные за 2012-2013 гг. по Москве и Московской области приведены с учетом изменения их границ с 1 июля 2012 г."],[17727,4341,11,89,155,169,144,99,64,34,127,635,68,20,90,59,79,252,287,1959,3192,205,133,465,null,1.2,464,172,139,356,394,78,61,1188,1409,24,36,795,68,204,282,496,78,1.6,47,53,96,0,3162,388,64,53,529,28,121,317,132,425,149,139,465,237,115,1681,59,814,148,null,31,31,86,660,2575,0.5,61,8,50,34,83,531,814,695,72,214,12,871,79,29,348,217,100,28,52,14,4,null,null],[16516,3761,77,78,129,134,102,92,47,37,87,1309,50,89,73,13,99,196,240,909,3088,190,117,416,null,0.3,415,152,88,291,339,97,52,1346,1446,29,29,863,69,186,270,390,77,2.7,33,51,82,0,2883,341,60,46,490,105,86,313,205,472,122,111,397,24,111,1860,50,763,202,null,55,44,103,845,2218,0.3,41,9,38,15,78,444,594,700,107,177,14,870,86,46,371,191,82,27,46,15,5,null,null],[15966,3613,72,75,126,135,99,88,46,50,82,1220,54,84,68,9.2,93,187,218,908,2866,175,129,375,null,0.2,375,157,91,231,334,92,45,1239,1436,28,33,920,71,150,235,397,78,4.3,32,47,97,0,2857,321,57,42,498,127,10,397,176,461,132,108,395,18,115,1834,46,770,183,null,39,39,105,836,2142,0.3,8,9,36,12,95,448,583,661,94,170,26,821,87,38,336,188,79,26,46,16,5,null,null],[15678,3651,71,71,124,131,97,84,47,45,87,1219,53,86,67,42,90,185,229,925,2877,177,120,364,null,0.1,364,154,103,241,376,87,40,1215,1394,28,21,892,56,144,253,395,79,4.2,30,45,107,0,2854,311,51,39,480,117,11,407,171,451,127,105,362,112,110,1665,43,712,167,null,41,34,92,744,2077,0.3,35,8,34,8,86,426,614,572,113,158,24,765,81,32,318,176,78,17,44,15,5,null,null],[15189,3570,71,68,120,129,88,93,41,16,80,1190,54,85,62,39,90,187,212,946,2796,220,106,341,null,0.1,341,148,102,277,334,73,39,1157,1321,26,26,839,52,141,236,374,77,4.1,29,45,87,0,2849,305,55,35,467,112,10,410,169,525,120,100,351,84,105,1624,40,687,184,null,78,25,81,713,1941,0.2,32,7.5,30,8.1,35,391,538,598,115,159,27,713,76,29,285,178,77,16,33,14,4.9,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>X1<\/th>\n      <th>2005<\/th>\n      <th>2010<\/th>\n      <th>2011<\/th>\n      <th>2012<\/th>\n      <th>2013<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script> Следует дать адекватные названия столбцам таблицы:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">colnames</span>(sewage) &lt;-<span class="st"> </span><span class="kw">c</span>(<span class="st">&quot;Region&quot;</span>, <span class="st">&quot;Year05&quot;</span>, <span class="st">&quot;Year10&quot;</span>, <span class="st">&quot;Year11&quot;</span>, <span class="st">&quot;Year12&quot;</span>, <span class="st">&quot;Year13&quot;</span>)</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">View</span>(sewage)</code></pre></div>
<div id="htmlwidget-1e838d4f21f33a18439b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-1e838d4f21f33a18439b">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97"],["Российская Федерация","Центральный федеральный округ ","Белгородская область","Брянская область","Владимирская область","Воронежская область","Ивановская область","Калужская область","Костромская область","Курская область","Липецкая область","Московская область1) ","Орловская область","Рязанская область","Смоленская область","Тамбовская область","Тверская область","Тульская область","Ярославская область","г. Москва1)","Северо-Западный федеральный округ ","Республика Карелия","Республика Коми","Архангельская область","в том числе:","Ненецкий автономный округ","Архангельская область без автономного округа","Вологодская область","Калинингpадская область","Ленинградская область","Мурманская область","Новгородская область","Псковская область","г. Санкт-Петербург","Южный федеральный округ ","Республика Адыгея","Республика Калмыкия","Краснодарский край","Астраханская область","Волгоградская область","Ростовская область","Северо-Кавказский федеральный округ ","Республика Дагестан","Республика Ингушетия ","Кабардино-Балкарская Республика","Карачаево-Черкесская Республика","Республика Северная Осетия - Алания","Чеченская Республика ","Приволжский федеральный округ ","Республика Башкортостан","Республика Марий Эл","Республика Мордовия","Республика Татарстан","Удмуртская Республика","Чувашская Республика","Пермский край","Кировская область","Нижегородская область","Оренбургская область","Пензенская область","Самарская область","Саратовская область","Ульяновская область","Уральский федеральный округ ","Курганская область","Свердловская область","Тюменская область","в том числе:","Ханты-Мансийский автономный округ - Югра","Ямало-Ненецкий автономный округ","Тюменская область без автономных округов","Челябинская область","Сибирский федеральный округ ","Республика Алтай","Республика Бурятия","Республика Тыва","Республика Хакасия","Алтайский край","Забайкальский край","Красноярский край","Иркутская область","Кемеровская область","Новосибирская область","Омская область","Томская область","Дальневосточный федеральный округ ","Республика Саха (Якутия)","Камчатский край","Приморский край","Хабаровский край","Амурская область","Магаданская область","Сахалинская область","Еврейская автономная область","Чукотский автономный округ","ѕ ѕ ѕ ѕ ѕ ","1) Данные за 2012-2013 гг. по Москве и Московской области приведены с учетом изменения их границ с 1 июля 2012 г."],[17727,4341,11,89,155,169,144,99,64,34,127,635,68,20,90,59,79,252,287,1959,3192,205,133,465,null,1.2,464,172,139,356,394,78,61,1188,1409,24,36,795,68,204,282,496,78,1.6,47,53,96,0,3162,388,64,53,529,28,121,317,132,425,149,139,465,237,115,1681,59,814,148,null,31,31,86,660,2575,0.5,61,8,50,34,83,531,814,695,72,214,12,871,79,29,348,217,100,28,52,14,4,null,null],[16516,3761,77,78,129,134,102,92,47,37,87,1309,50,89,73,13,99,196,240,909,3088,190,117,416,null,0.3,415,152,88,291,339,97,52,1346,1446,29,29,863,69,186,270,390,77,2.7,33,51,82,0,2883,341,60,46,490,105,86,313,205,472,122,111,397,24,111,1860,50,763,202,null,55,44,103,845,2218,0.3,41,9,38,15,78,444,594,700,107,177,14,870,86,46,371,191,82,27,46,15,5,null,null],[15966,3613,72,75,126,135,99,88,46,50,82,1220,54,84,68,9.2,93,187,218,908,2866,175,129,375,null,0.2,375,157,91,231,334,92,45,1239,1436,28,33,920,71,150,235,397,78,4.3,32,47,97,0,2857,321,57,42,498,127,10,397,176,461,132,108,395,18,115,1834,46,770,183,null,39,39,105,836,2142,0.3,8,9,36,12,95,448,583,661,94,170,26,821,87,38,336,188,79,26,46,16,5,null,null],[15678,3651,71,71,124,131,97,84,47,45,87,1219,53,86,67,42,90,185,229,925,2877,177,120,364,null,0.1,364,154,103,241,376,87,40,1215,1394,28,21,892,56,144,253,395,79,4.2,30,45,107,0,2854,311,51,39,480,117,11,407,171,451,127,105,362,112,110,1665,43,712,167,null,41,34,92,744,2077,0.3,35,8,34,8,86,426,614,572,113,158,24,765,81,32,318,176,78,17,44,15,5,null,null],[15189,3570,71,68,120,129,88,93,41,16,80,1190,54,85,62,39,90,187,212,946,2796,220,106,341,null,0.1,341,148,102,277,334,73,39,1157,1321,26,26,839,52,141,236,374,77,4.1,29,45,87,0,2849,305,55,35,467,112,10,410,169,525,120,100,351,84,105,1624,40,687,184,null,78,25,81,713,1941,0.2,32,7.5,30,8.1,35,391,538,598,115,159,27,713,76,29,285,178,77,16,33,14,4.9,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Region<\/th>\n      <th>Year05<\/th>\n      <th>Year10<\/th>\n      <th>Year11<\/th>\n      <th>Year12<\/th>\n      <th>Year13<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="missed_values" class="section level2">
<h2><span class="header-section-number">4.5</span> Пропущенные значения</h2>
<p>Можно ли осуществлять обработку таблицы <code>sewage</code>? Попробуем в качестве примера найти минимум сбросов за 2012 год:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">max</span>(sewage<span class="op">$</span>Year12)
## [1] NA</code></pre></div>
<p>Результат имеет тип <code>NA</code>, потому что в данном столбце имеются пропуски. В некоторых статистических задачах это недопустимо. Если вы хотите проигнорировать значения пропусков, следует в вызываемой статистической функции указать дополнительный параметр <code>na.rm = TRUE</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">max</span>(sewage<span class="op">$</span>Year13, <span class="dt">na.rm =</span> <span class="ot">TRUE</span>)
## [1] 15189</code></pre></div>
<p>Еще один вариант — исключить из таблицы те строки, в которых имеются пропущенные значения (хотя бы одно!). Для этого существует функция <code>complete.cases()</code>, возвращающая вектор логических значений:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">filter&lt;-<span class="kw">complete.cases</span>(sewage)
filter  <span class="co"># посмотрим что получилось. Там где видим FALSE - есть пропуски в строках</span>
##  [1]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
## [12]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
## [23]  TRUE  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
## [34]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
## [45]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
## [56]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
## [67]  TRUE FALSE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
## [78]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE
## [89]  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE  TRUE FALSE FALSE

sewage.complete &lt;-<span class="st"> </span>sewage[filter, ] <span class="co"># отфильтруем полные строки</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">View</span>(sewage.complete)</code></pre></div>
<div id="htmlwidget-c3a740d369b950e80f34" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-c3a740d369b950e80f34">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95"],["Российская Федерация","Центральный федеральный округ ","Белгородская область","Брянская область","Владимирская область","Воронежская область","Ивановская область","Калужская область","Костромская область","Курская область","Липецкая область","Московская область1) ","Орловская область","Рязанская область","Смоленская область","Тамбовская область","Тверская область","Тульская область","Ярославская область","г. Москва1)","Северо-Западный федеральный округ ","Республика Карелия","Республика Коми","Архангельская область","Ненецкий автономный округ","Архангельская область без автономного округа","Вологодская область","Калинингpадская область","Ленинградская область","Мурманская область","Новгородская область","Псковская область","г. Санкт-Петербург","Южный федеральный округ ","Республика Адыгея","Республика Калмыкия","Краснодарский край","Астраханская область","Волгоградская область","Ростовская область","Северо-Кавказский федеральный округ ","Республика Дагестан","Республика Ингушетия ","Кабардино-Балкарская Республика","Карачаево-Черкесская Республика","Республика Северная Осетия - Алания","Чеченская Республика ","Приволжский федеральный округ ","Республика Башкортостан","Республика Марий Эл","Республика Мордовия","Республика Татарстан","Удмуртская Республика","Чувашская Республика","Пермский край","Кировская область","Нижегородская область","Оренбургская область","Пензенская область","Самарская область","Саратовская область","Ульяновская область","Уральский федеральный округ ","Курганская область","Свердловская область","Тюменская область","Ханты-Мансийский автономный округ - Югра","Ямало-Ненецкий автономный округ","Тюменская область без автономных округов","Челябинская область","Сибирский федеральный округ ","Республика Алтай","Республика Бурятия","Республика Тыва","Республика Хакасия","Алтайский край","Забайкальский край","Красноярский край","Иркутская область","Кемеровская область","Новосибирская область","Омская область","Томская область","Дальневосточный федеральный округ ","Республика Саха (Якутия)","Камчатский край","Приморский край","Хабаровский край","Амурская область","Магаданская область","Сахалинская область","Еврейская автономная область","Чукотский автономный округ"],[17727,4341,11,89,155,169,144,99,64,34,127,635,68,20,90,59,79,252,287,1959,3192,205,133,465,1.2,464,172,139,356,394,78,61,1188,1409,24,36,795,68,204,282,496,78,1.6,47,53,96,0,3162,388,64,53,529,28,121,317,132,425,149,139,465,237,115,1681,59,814,148,31,31,86,660,2575,0.5,61,8,50,34,83,531,814,695,72,214,12,871,79,29,348,217,100,28,52,14,4],[16516,3761,77,78,129,134,102,92,47,37,87,1309,50,89,73,13,99,196,240,909,3088,190,117,416,0.3,415,152,88,291,339,97,52,1346,1446,29,29,863,69,186,270,390,77,2.7,33,51,82,0,2883,341,60,46,490,105,86,313,205,472,122,111,397,24,111,1860,50,763,202,55,44,103,845,2218,0.3,41,9,38,15,78,444,594,700,107,177,14,870,86,46,371,191,82,27,46,15,5],[15966,3613,72,75,126,135,99,88,46,50,82,1220,54,84,68,9.2,93,187,218,908,2866,175,129,375,0.2,375,157,91,231,334,92,45,1239,1436,28,33,920,71,150,235,397,78,4.3,32,47,97,0,2857,321,57,42,498,127,10,397,176,461,132,108,395,18,115,1834,46,770,183,39,39,105,836,2142,0.3,8,9,36,12,95,448,583,661,94,170,26,821,87,38,336,188,79,26,46,16,5],[15678,3651,71,71,124,131,97,84,47,45,87,1219,53,86,67,42,90,185,229,925,2877,177,120,364,0.1,364,154,103,241,376,87,40,1215,1394,28,21,892,56,144,253,395,79,4.2,30,45,107,0,2854,311,51,39,480,117,11,407,171,451,127,105,362,112,110,1665,43,712,167,41,34,92,744,2077,0.3,35,8,34,8,86,426,614,572,113,158,24,765,81,32,318,176,78,17,44,15,5],[15189,3570,71,68,120,129,88,93,41,16,80,1190,54,85,62,39,90,187,212,946,2796,220,106,341,0.1,341,148,102,277,334,73,39,1157,1321,26,26,839,52,141,236,374,77,4.1,29,45,87,0,2849,305,55,35,467,112,10,410,169,525,120,100,351,84,105,1624,40,687,184,78,25,81,713,1941,0.2,32,7.5,30,8.1,35,391,538,598,115,159,27,713,76,29,285,178,77,16,33,14,4.9]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Region<\/th>\n      <th>Year05<\/th>\n      <th>Year10<\/th>\n      <th>Year11<\/th>\n      <th>Year12<\/th>\n      <th>Year13<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="filtering_text" class="section level2">
<h2><span class="header-section-number">4.6</span> Фильтрация по текстовым полям</h2>
<p>Часто бывает необходимо отобрать данные из таблицы, содержащей разнородные данные. В частности, в нашей таблице смешаны данные по субъектам и федеральным округам. Предположим, необходимо выгрузить в отдельную таблицу данные по федеральным округам. Для этого нужно найти строки, в которых столбец <code>Region</code> содержит фразу <code>&quot;федеральный округ&quot;</code>. Для поиска по текстовым эталонам импользуется функция <code>grep()</code>, выдающая номера элементов, или ее разновидность <code>grepl()</code>, выдающая список логических констант</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="co"># Первый параметр - искомое выражение, второй параметр - где искть</span>
rows &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;федеральный округ&quot;</span>,sewage<span class="op">$</span>Region)
rows  <span class="co"># посмотрим, какие элементы столбца Region ему соответствуют</span>
## [1]  2 21 35 42 49 64 73 86
okruga &lt;-<span class="st"> </span>sewage[rows,] <span class="co"># отфильтруем найденные строки</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">View</span>(okruga)</code></pre></div>
<p><div id="htmlwidget-59dab2bc925f93b7dd01" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-59dab2bc925f93b7dd01">{"x":{"filter":"none","data":[["2","21","35","42","49","64","73","86"],["Центральный федеральный округ ","Северо-Западный федеральный округ ","Южный федеральный округ ","Северо-Кавказский федеральный округ ","Приволжский федеральный округ ","Уральский федеральный округ ","Сибирский федеральный округ ","Дальневосточный федеральный округ "],[4341,3192,1409,496,3162,1681,2575,871],[3761,3088,1446,390,2883,1860,2218,870],[3613,2866,1436,397,2857,1834,2142,821],[3651,2877,1394,395,2854,1665,2077,765],[3570,2796,1321,374,2849,1624,1941,713]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Region<\/th>\n      <th>Year05<\/th>\n      <th>Year10<\/th>\n      <th>Year11<\/th>\n      <th>Year12<\/th>\n      <th>Year13<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script> Наоборот — для <strong>исключения</strong> найденных объектов удобнее воспользоваться разновидностью <code>grepl()</code>, которая возвращает вектор из логических значений:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rows2 &lt;-<span class="st"> </span><span class="kw">grepl</span>(<span class="st">&quot;федеральный округ&quot;</span>,sewage<span class="op">$</span>Region)
rows2 <span class="co"># вот так выглядит результат grepl</span>
##  [1] FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [12] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE
## [23] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [34] FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE
## [45] FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE
## [56] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE
## [67] FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE
## [78] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE
## [89] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE

neokruga &lt;-<span class="st"> </span>sewage[<span class="op">!</span>rows2,]</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">View</span>(neokruga)</code></pre></div>
<p><div id="htmlwidget-20b5915587fb41fa9151" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-20b5915587fb41fa9151">{"x":{"filter":"none","data":[["1","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","22","23","24","25","26","27","28","29","30","31","32","33","34","36","37","38","39","40","41","43","44","45","46","47","48","50","51","52","53","54","55","56","57","58","59","60","61","62","63","65","66","67","68","69","70","71","72","74","75","76","77","78","79","80","81","82","83","84","85","87","88","89","90","91","92","93","94","95","96","97"],["Российская Федерация","Белгородская область","Брянская область","Владимирская область","Воронежская область","Ивановская область","Калужская область","Костромская область","Курская область","Липецкая область","Московская область1) ","Орловская область","Рязанская область","Смоленская область","Тамбовская область","Тверская область","Тульская область","Ярославская область","г. Москва1)","Республика Карелия","Республика Коми","Архангельская область","в том числе:","Ненецкий автономный округ","Архангельская область без автономного округа","Вологодская область","Калинингpадская область","Ленинградская область","Мурманская область","Новгородская область","Псковская область","г. Санкт-Петербург","Республика Адыгея","Республика Калмыкия","Краснодарский край","Астраханская область","Волгоградская область","Ростовская область","Республика Дагестан","Республика Ингушетия ","Кабардино-Балкарская Республика","Карачаево-Черкесская Республика","Республика Северная Осетия - Алания","Чеченская Республика ","Республика Башкортостан","Республика Марий Эл","Республика Мордовия","Республика Татарстан","Удмуртская Республика","Чувашская Республика","Пермский край","Кировская область","Нижегородская область","Оренбургская область","Пензенская область","Самарская область","Саратовская область","Ульяновская область","Курганская область","Свердловская область","Тюменская область","в том числе:","Ханты-Мансийский автономный округ - Югра","Ямало-Ненецкий автономный округ","Тюменская область без автономных округов","Челябинская область","Республика Алтай","Республика Бурятия","Республика Тыва","Республика Хакасия","Алтайский край","Забайкальский край","Красноярский край","Иркутская область","Кемеровская область","Новосибирская область","Омская область","Томская область","Республика Саха (Якутия)","Камчатский край","Приморский край","Хабаровский край","Амурская область","Магаданская область","Сахалинская область","Еврейская автономная область","Чукотский автономный округ","ѕ ѕ ѕ ѕ ѕ ","1) Данные за 2012-2013 гг. по Москве и Московской области приведены с учетом изменения их границ с 1 июля 2012 г."],[17727,11,89,155,169,144,99,64,34,127,635,68,20,90,59,79,252,287,1959,205,133,465,null,1.2,464,172,139,356,394,78,61,1188,24,36,795,68,204,282,78,1.6,47,53,96,0,388,64,53,529,28,121,317,132,425,149,139,465,237,115,59,814,148,null,31,31,86,660,0.5,61,8,50,34,83,531,814,695,72,214,12,79,29,348,217,100,28,52,14,4,null,null],[16516,77,78,129,134,102,92,47,37,87,1309,50,89,73,13,99,196,240,909,190,117,416,null,0.3,415,152,88,291,339,97,52,1346,29,29,863,69,186,270,77,2.7,33,51,82,0,341,60,46,490,105,86,313,205,472,122,111,397,24,111,50,763,202,null,55,44,103,845,0.3,41,9,38,15,78,444,594,700,107,177,14,86,46,371,191,82,27,46,15,5,null,null],[15966,72,75,126,135,99,88,46,50,82,1220,54,84,68,9.2,93,187,218,908,175,129,375,null,0.2,375,157,91,231,334,92,45,1239,28,33,920,71,150,235,78,4.3,32,47,97,0,321,57,42,498,127,10,397,176,461,132,108,395,18,115,46,770,183,null,39,39,105,836,0.3,8,9,36,12,95,448,583,661,94,170,26,87,38,336,188,79,26,46,16,5,null,null],[15678,71,71,124,131,97,84,47,45,87,1219,53,86,67,42,90,185,229,925,177,120,364,null,0.1,364,154,103,241,376,87,40,1215,28,21,892,56,144,253,79,4.2,30,45,107,0,311,51,39,480,117,11,407,171,451,127,105,362,112,110,43,712,167,null,41,34,92,744,0.3,35,8,34,8,86,426,614,572,113,158,24,81,32,318,176,78,17,44,15,5,null,null],[15189,71,68,120,129,88,93,41,16,80,1190,54,85,62,39,90,187,212,946,220,106,341,null,0.1,341,148,102,277,334,73,39,1157,26,26,839,52,141,236,77,4.1,29,45,87,0,305,55,35,467,112,10,410,169,525,120,100,351,84,105,40,687,184,null,78,25,81,713,0.2,32,7.5,30,8.1,35,391,538,598,115,159,27,76,29,285,178,77,16,33,14,4.9,null,null]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Region<\/th>\n      <th>Year05<\/th>\n      <th>Year10<\/th>\n      <th>Year11<\/th>\n      <th>Year12<\/th>\n      <th>Year13<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script> Обратите внимание на восклицательный знак перед <code>rows2</code>. Он меняет все значения <code>TRUE</code> на <code>FALSE</code> и наоборот, что позволяет исключить найденные объекты</p>
<p>В полученной таблице все еще содержится текстовая шелуха типа <code>&quot;в том числе&quot;</code>, <code>&quot;Данные за...&quot;</code>, а также строка <code>&quot;Российская Федерация&quot;</code>. К счастью, функция <code>grep()</code> достаточо умна и возволяет искать сразу по нескольким образцам строк. Для этого их нужно разделить вертикальной чертой — <em>пайпом</em> (<code>|</code>):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">rows2 &lt;-<span class="st"> </span><span class="kw">grepl</span>(<span class="st">&quot;федеральный|числе|Российская|за|ѕ&quot;</span>,sewage<span class="op">$</span>Region)
rows2
##  [1]  TRUE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [12] FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE
## [23] FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
## [34] FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE
## [45] FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE FALSE
## [56] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE
## [67] FALSE  TRUE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE FALSE
## [78] FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE
## [89] FALSE FALSE FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE
neokruga &lt;-<span class="st"> </span>sewage[<span class="op">!</span>rows2,] <span class="co"># обратите внимание на восклицательный знак перед rows2</span></code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">View</span>(neokruga)</code></pre></div>
<div id="htmlwidget-f566f9aa8c4652d9498b" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-f566f9aa8c4652d9498b">{"x":{"filter":"none","data":[["3","4","5","6","7","8","9","10","11","12","13","15","16","17","18","19","20","22","23","24","26","27","28","29","30","31","32","33","34","36","37","38","39","40","41","43","44","45","46","47","48","50","51","52","53","54","55","56","57","58","59","60","61","62","63","65","66","67","69","70","71","72","74","75","76","77","78","79","80","81","82","83","84","85","87","88","89","90","91","92","93","94","95"],["Белгородская область","Брянская область","Владимирская область","Воронежская область","Ивановская область","Калужская область","Костромская область","Курская область","Липецкая область","Московская область1) ","Орловская область","Смоленская область","Тамбовская область","Тверская область","Тульская область","Ярославская область","г. Москва1)","Республика Карелия","Республика Коми","Архангельская область","Ненецкий автономный округ","Архангельская область без автономного округа","Вологодская область","Калинингpадская область","Ленинградская область","Мурманская область","Новгородская область","Псковская область","г. Санкт-Петербург","Республика Адыгея","Республика Калмыкия","Краснодарский край","Астраханская область","Волгоградская область","Ростовская область","Республика Дагестан","Республика Ингушетия ","Кабардино-Балкарская Республика","Карачаево-Черкесская Республика","Республика Северная Осетия - Алания","Чеченская Республика ","Республика Башкортостан","Республика Марий Эл","Республика Мордовия","Республика Татарстан","Удмуртская Республика","Чувашская Республика","Пермский край","Кировская область","Нижегородская область","Оренбургская область","Пензенская область","Самарская область","Саратовская область","Ульяновская область","Курганская область","Свердловская область","Тюменская область","Ханты-Мансийский автономный округ - Югра","Ямало-Ненецкий автономный округ","Тюменская область без автономных округов","Челябинская область","Республика Алтай","Республика Бурятия","Республика Тыва","Республика Хакасия","Алтайский край","Забайкальский край","Красноярский край","Иркутская область","Кемеровская область","Новосибирская область","Омская область","Томская область","Республика Саха (Якутия)","Камчатский край","Приморский край","Хабаровский край","Амурская область","Магаданская область","Сахалинская область","Еврейская автономная область","Чукотский автономный округ"],[11,89,155,169,144,99,64,34,127,635,68,90,59,79,252,287,1959,205,133,465,1.2,464,172,139,356,394,78,61,1188,24,36,795,68,204,282,78,1.6,47,53,96,0,388,64,53,529,28,121,317,132,425,149,139,465,237,115,59,814,148,31,31,86,660,0.5,61,8,50,34,83,531,814,695,72,214,12,79,29,348,217,100,28,52,14,4],[77,78,129,134,102,92,47,37,87,1309,50,73,13,99,196,240,909,190,117,416,0.3,415,152,88,291,339,97,52,1346,29,29,863,69,186,270,77,2.7,33,51,82,0,341,60,46,490,105,86,313,205,472,122,111,397,24,111,50,763,202,55,44,103,845,0.3,41,9,38,15,78,444,594,700,107,177,14,86,46,371,191,82,27,46,15,5],[72,75,126,135,99,88,46,50,82,1220,54,68,9.2,93,187,218,908,175,129,375,0.2,375,157,91,231,334,92,45,1239,28,33,920,71,150,235,78,4.3,32,47,97,0,321,57,42,498,127,10,397,176,461,132,108,395,18,115,46,770,183,39,39,105,836,0.3,8,9,36,12,95,448,583,661,94,170,26,87,38,336,188,79,26,46,16,5],[71,71,124,131,97,84,47,45,87,1219,53,67,42,90,185,229,925,177,120,364,0.1,364,154,103,241,376,87,40,1215,28,21,892,56,144,253,79,4.2,30,45,107,0,311,51,39,480,117,11,407,171,451,127,105,362,112,110,43,712,167,41,34,92,744,0.3,35,8,34,8,86,426,614,572,113,158,24,81,32,318,176,78,17,44,15,5],[71,68,120,129,88,93,41,16,80,1190,54,62,39,90,187,212,946,220,106,341,0.1,341,148,102,277,334,73,39,1157,26,26,839,52,141,236,77,4.1,29,45,87,0,305,55,35,467,112,10,410,169,525,120,100,351,84,105,40,687,184,78,25,81,713,0.2,32,7.5,30,8.1,35,391,538,598,115,159,27,76,29,285,178,77,16,33,14,4.9]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>Region<\/th>\n      <th>Year05<\/th>\n      <th>Year10<\/th>\n      <th>Year11<\/th>\n      <th>Year12<\/th>\n      <th>Year13<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":[2,3,4,5,6]},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script>
</div>
<div id="data_conversion" class="section level2">
<h2><span class="header-section-number">4.7</span> Преобразование типов данных и исправление ошибок</h2>
<p>Достаточно часто при работе с реальными данными возникает необходимость преобразования их типов. Например, вам необходимо перевести строки в даты, чтобы оперировать ими соответствующим образом. Или принудительным образом указать, что столбец со строками не хранит номинальную переменную (фактор), а его нужно интерпретировать именно как строковый столбец (обычно это полезно, когда столбец содержит какую-то текстовую информацию в виде комментариев по каждому измерению). Наконец, в данных могут быть ошибки, опечатки и так далее, которые могут препятствовать правильному их чтению.</p>
<p>В этом разделе мы рассмотрим, как можно:</p>
<ol style="list-style-type: decimal">
<li>Найти и исправить множественные варианты одного названия с опечатками</li>
<li>Исправить ошибки в числовых данных</li>
<li>Преобразовать факторы в строки и наоборот</li>
<li>Преобразовать строки в числа и наоборот</li>
</ol>
<p>Рассмотрим возможные манипуляции с данными на примере таблицы о землепользовании на территории Сатинского учебного полигоны Географического факультета МГУ:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tab &lt;-<span class="st"> </span><span class="kw">read.csv2</span>(<span class="st">&quot;SatinoLanduse.csv&quot;</span>, <span class="dt">encoding =</span> <span class="st">&#39;UTF-8&#39;</span>)
<span class="kw">str</span>(tab) <span class="co"># посмотрим, какова структура данных</span>
## &#39;data.frame&#39;:    160 obs. of  6 variables:
##  $ ID            : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ Type          : Factor w/ 12 levels &quot;Выгоны&quot;,&quot;Вырубки&quot;,..: 11 1 1 9 5 1 5 12 9 10 ...
##  $ Administration: Factor w/ 7 levels &quot;&quot;,&quot;РФ&quot;,&quot;Совьяковская администрация&quot;,..: 5 5 5 1 1 5 1 5 5 6 ...
##  $ Comment       : Factor w/ 35 levels &quot;&quot;,&quot;АО \&quot;Родина\&quot;&quot;,..: 30 1 1 1 1 1 1 3 2 1 ...
##  $ Perimeter     : Factor w/ 160 levels &quot;1014.155593894044800&quot;,..: 67 155 51 104 78 153 17 19 108 57 ...
##  $ Area          : Factor w/ 160 levels &quot;0.238070145845919&quot;,..: 73 49 121 100 63 72 88 128 99 24 ...</code></pre></div>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">View</span>(tab)</code></pre></div>
<p><div id="htmlwidget-bf63e50fd1f9febeadda" style="width:100%;height:auto;" class="datatables html-widget"></div>
<script type="application/json" data-for="htmlwidget-bf63e50fd1f9febeadda">{"x":{"filter":"none","data":[["1","2","3","4","5","6","7","8","9","10","11","12","13","14","15","16","17","18","19","20","21","22","23","24","25","26","27","28","29","30","31","32","33","34","35","36","37","38","39","40","41","42","43","44","45","46","47","48","49","50","51","52","53","54","55","56","57","58","59","60","61","62","63","64","65","66","67","68","69","70","71","72","73","74","75","76","77","78","79","80","81","82","83","84","85","86","87","88","89","90","91","92","93","94","95","96","97","98","99","100","101","102","103","104","105","106","107","108","109","110","111","112","113","114","115","116","117","118","119","120","121","122","123","124","125","126","127","128","129","130","131","132","133","134","135","136","137","138","139","140","141","142","143","144","145","146","147","148","149","150","151","152","153","154","155","156","157","158","159","160"],[1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51,52,53,54,55,56,57,58,59,60,61,62,63,64,65,66,67,68,69,70,71,72,73,74,75,76,77,78,79,80,81,82,83,84,85,86,87,88,89,90,91,92,93,94,95,96,97,98,99,100,101,102,103,104,105,106,107,108,109,110,111,112,113,114,115,116,117,118,119,120,121,122,123,124,125,126,127,128,129,130,131,132,133,134,135,136,137,138,139,140,141,142,143,144,145,146,147,148,149,150,151,152,153,154,155,156,157,158,159,160],["Территории населенных пунктов","Выгоны","Выгоны","Пашни","Леса","Выгоны","Леса","Фермерские хозяйства","Пашни","Сады","Фермерские хозяйства","Фермерские хозяйства","Фермерские хозяйства","Фермерские хозяйства","Фермерские хозяйства","Фермерские хозяйства","Выгоны","Территории населенных пунктов","Территории населенных пунктов","Лесные поляны","Фермерские хозяйства","Фермерские хозяйства","Фермерские хозяйства","Пашни","Фермерские хозяйства","Фермерские хозяйства","Фермерские хозяйства","Фермерские хозяйства","Луга","Фермерские хозяйства","Луга","Фермерские хозяйства","Леса","Леса","Леса","Леса","Леса","Леса","Леса","Леса","Леса","Леса","Леса","Леса","Леса","Леса","Леса","Леса","Леса","Леса","Леса","Леса","Леса","Леса","Леса","Леса","Леса","Луга","Леса","Леса","Леса","Леса","Леса","Леса","Леса","Луга","Леса","Леса","Фермерские хозяйства","Леса","Выгоны","Фермерские хозяйства","Сады","Луга","Пашни","Луга","Луга","Леса","Заболоченные земли","Леса","Леса","Леса","Леса","Леса","Нет данных","Вырубки","Вырубки","Вырубки","Леса","Леса","Леса","Пашни","Фермерские хозяйства","Сады","Леса","Сады","Фермерские хозяйства","Вырубки","Выгоны","Выгоны","Выгоны","Выгоны","Выгоны","Леса","Вырубки","Вырубки","Вырубки","Выгоны","Нет данных","Пашни","Выгоны","Лесные поляны","Выгоны","Заболоченные земли","Выгоны","Выгоны","Выгоны","Луга","Лесные поляны","Пашни","Выгоны","Выгоны","Выгоны","Территории населенных пунктов","Выгоны","Территории населенных пунктов","Выгоны","Выгоны","Выгоны","Выгоны","Выгоны","Фермерские хозяйства","Пашни","Пашни","Выгоны","Заболоченные земли","Пашни","Леса","Территории населенных пунктов","Леса","Фермерские хозяйства","Луга","Территории населенных пунктов","Пашни","Заболоченные земли","Леса","Пашни","Гидрологические объекты","Выгоны","Пашни","Луга","Пашни","Территории населенных пунктов","Гидрологические объекты","Гидрологические объекты","Нет данных","Гидрологические объекты","Пашни","Леса","Луга"],["Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","","","Совьяковская сельская администрация","","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская Администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","","","","","","","","","","","","","","","","","","","","","","","","","","Совьяковская сельская администрация","","","","","","","","Совьяковская сельская администрация","","","Совьяковская сельская администрация","","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","РФ","Совьяковская сельскаая администрация","Совьяковская сельская админитрация","","","","","","","","","","","","","","","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","","Совьяковская сельская администрация","Совьяковская сельская администрация","РФ","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","","","","","Совьяковская сельская администрация","","Совьяковская сельская администрация","Совьяковская сельская администрация","","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская администрация","Совьяковская сельская администрация","","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","РФ","","Совьяковская сельская администрация","","Совьяковская сельская администрация","Совьяковская сельская администрация","Совьяковская сельская администрация","","Совьяковская сельская администрация","","","","Совьяковская сельская администрация","","","","Совьяковская сельская администрация","","","","","Совьяковская сельская администрация","","Совьяковская сельская администрация"],["Село Беницы","","","","","","","Владелец - Айвозян","АО \"Родина\"","","Владелец - Кожокарь А.Ф.","Владелец - Кожокарь А.Ф.","Владелец - Сизанов","Владелец - Смородин","Владелец - Родинкин","Владелец - Жуков","","Село Сатино","Деревня Бутовка","","Владелец - Кожокарь М.Ф.","Владелец - Семенищев Н.А.","Владелец - Неверов","","Владелец - Горохов","Владелец - Солныкина","Владелец - Соловецкий","Владелец - Соловецкая","","Владелец - Семчук","","Владелец - Жуков","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","","Владелец - Легков В.И.","","","Владелец - Жуков","Коллективные сады товарищества \"Винт\"","","Федеральная собственность","","","","","","","","","Урочище Борок","","","","","","","","Урочище Дощечное","Владелец - Безрядин","Коллективные сады \"Эльф\"","","","Владелец - Фёдоров","","","","","","","","","","","","","","","","","","","","","","","","","","","Деревня Дедюевка","","Деревня Рыжково","","","","","","Владелец - Семчук","АО \"Родина\"","АО \"Родина\"","","","Федеральная собственность","","Деревня Ивановское","","Территория молочной фермы","","Деревня Загрязье","","","","","река Протва","","","","","Деревня Митинки","Озеро","Озеро","","","АО \"Родина\"","",""],["2395.725463843722500","922.314163446381600","2180.787622893539300","3947.940266502537700","278.569432215831970","875.438381164973630","12768.489513668199000","1285.637868954036100","4165.304881235649200","2276.494254985449100","1081.964408568060900","1020.278536197552200","955.245764593231120","987.238935738203510","923.493120570405610","2178.194227396214000","329.779915090419370","7797.569103061144200","1060.678503301135200","229.722576344810990","1021.109926202218700","1041.122684298658400","637.625220395232760","828.735132375886000","445.273316350918890","593.761730765728320","811.773990223761300","446.591223888069630","114.701418496307100","1282.216799368403800","492.557716818656050","658.044528067592980","2974.387632216028600","682.133273739147850","2913.012537616505100","1882.984892231590500","628.503509570987940","3544.869605738307700","296.955526951002750","9465.261080523363500","190.162157356840570","3520.181376630148000","2536.270353066599900","739.839528673226480","1094.945610298295600","372.424478591613480","1735.219181750783500","1014.155593894044800","3023.575166620509700","2767.036734352273500","991.756897880632780","345.001538925804540","505.717151349551840","313.301421769596120","258.619660986542390","175.421903279478530","557.414799680944720","867.460782446246640","381.026959675226410","711.182786063959840","1576.781840020214800","417.166384849397670","422.853128265023370","390.430477124089520","259.749731341368370","1190.198805959317700","160.308140233701070","234.354769745643610","806.348356707244190","227.482699039905870","385.442410488905580","1395.061678932684100","2358.080745882565700","303.226006081840350","2556.264468639007200","223.872618708442300","336.587519659077770","15354.682867180587000","469.693448694413520","2560.164619581864800","1942.663858781144400","2255.524732974263300","523.146454934524060","2000.574091337482500","222.364743390340890","1410.860705357233700","465.757326894891430","837.550517393744940","506.268371870586860","2009.694257792927600","140.498152700021900","1890.406103668618000","1019.457949256323400","2322.323294761477000","177.128454964415370","535.480506184955290","1490.866170010731600","868.590643296811210","784.919336080663810","396.566060884559080","593.035692141365870","1183.776899540326200","4667.526630330259600","349.478207826485230","293.448125744845750","807.368355582933420","755.135016833356990","2481.927468409167900","1307.095535218648600","2121.917315495333200","724.044910501994760","395.530650270342960","897.530950496543140","547.003638035006130","2071.426159798443700","2336.509349443190300","1655.312967754795000","282.729961911075750","353.455730955488600","2354.362993245422300","1155.916232728818800","269.740632059119380","423.879939058014540","1172.234440960391600","426.637291845218900","3074.046138125749600","147.523204483101130","619.822999428146320","2409.847196649397100","1801.488864110087900","217.448328183814680","30.213895842173304","3525.118948109050100","2311.525491311364500","1360.250444238750800","715.974579669219220","2017.730069296692100","869.011223067728220","2265.856027132804200","1210.155888961538000","360.328581498529050","3.086953443396793","1348.846937244813000","5877.198981566753000","1276.809801687205200","5245.058162376556500","2791.519179861358200","23920.944648227432000","6603.955909968268300","13493.773620681737000","4076.707549162360500","1795.590885848397400","722.879255316470560","119.083106284324340","71.543820942051099","1773.051855263179700","73.693186724796703","2519.712412758317000","1296.647097772085500","2338.524893045367200"],["286159.158855028570000","21651.963989321295000","56826.463220403260000","450293.758854912190000","2612.615315620203500","28608.401312941853000","3469445.792599530000000","62299.630521423671000","450291.261113939570000","147943.134285204400000","54440.358069744660000","53291.798236783667000","53457.621679177879000","57698.660258261974000","51281.983266728945000","312762.042063507660000","5941.499366660677000","830862.391512097560000","50478.678222297574000","3265.314293738872500","55861.392252290992000","65716.647795004552000","23869.914283815866000","25882.353530118649000","4603.953526588094100","4381.645029546117300","32036.296324754723000","7506.719090626902500","608.206081330334430","89499,573298880117000","3843.130646728627700","20738.846350572821000","227134.820162281510000","9621.367410346487300","181121.543272139530000","90314.422604615742000","14027.297670484913000","640110.951121168680000","4679.883188862047100","1092606.851056342700000","2411.255045553898100","121638.279177417540000","33752.794040286550000","8341.599124097163400","3617.243308510424000","1567.104813126887600","9865.323033935605100","3842.890721919666200","21384.109233813440000","14476.930711173922000","7301.141991778400600","6486.956681001920500","3803.477358724781900","1131.496066112815700","3002.504191971309000","539.123727506730010","11656.669250498955000","24185.158251040797000","1742.637023635242000","23433.587558919378000","8273.779426722529000","2952.616318962082500","1031.970181480255000","930.964001734238310","595.676646849412010","27357.732994543410000","1182.852128971498100","2946.442415283197500","34542.382853718096000","2119.622296355390100","6488.708338066418900","65059.301585804147000","171401.654524252810000","5899.447777935165500","198987.206721941820000","2835.948220782285300","3340.438498735139100","1693194.137634886200000","10703.189785344441000","20150.803155476631000","14668.634190504757000","20957.275579485271000","2270.043268259560100","53372.990081921045000","2754.008770193891000","18087.857495015258000","5489.955910415563300","11922,638460079328000","9061.158003221207800","14745.378415189980000","1249.715547920420900","161947.865081757050000","46765.120784921062000","108784.937946770630000","1981.382884888466400","10153.773347663515000","77374.938296643610000","50136.205656653998000","16622.017692742542000","8661.893137167837300","15533.889665445700000","49077.278244379464000","105469.258406255660000","5153,570673500797100","5528.939993184026200","23776.888687917577000","26269.470572935079000","103952.438739990700000","82555.307564889037000","85791.501222018822000","24123.584689912164000","4887.857056873202100","21135.851338957618000","7818.729506617504700","31958.770190284285000","29476.450655787026000","46859.503767767157000","4304.998783309750300","7802.791685541597000","103683.248190403130000","16903.853690979999000","3026.566822507951700","6209.206484740834600","78502.938905644885000","2849.291253874679100","197579.031028344530000","899.602008063114230","9008.261211555049200","75472.527696543737000","104968.978540695590000","2889.842511804906300","42.676917220700894","227408.935134828180000","279386.229946879550000","18938.366466128515000","27777.201578799330000","118823.585181967850000","7195.906821987659000","192862.712873304610000","23255.185056499882000","8658.590843035126500","0.238070145845919","84410.339552943304000","763452.968717598710000","43168.646454190544000","647899.870316969580000","349030.986488852180000","246765.587149404570000","273793.579821330380000","2001222.454137160200000","528505.851081224040000","157537.350429073330000","12646.532541280130000","960.889508904636270","328.327714712074620","47941.725558863203000","392.819854559529460","164132.667580747340000","13397.398783192089000","232022.514814842080000"]],"container":"<table class=\"display\">\n  <thead>\n    <tr>\n      <th> <\/th>\n      <th>ID<\/th>\n      <th>Type<\/th>\n      <th>Administration<\/th>\n      <th>Comment<\/th>\n      <th>Perimeter<\/th>\n      <th>Area<\/th>\n    <\/tr>\n  <\/thead>\n<\/table>","options":{"pageLength":5,"columnDefs":[{"className":"dt-right","targets":1},{"orderable":false,"targets":0}],"order":[],"autoWidth":false,"orderClasses":false,"lengthMenu":[5,10,25,50,100]}},"evals":[],"jsHooks":[]}</script> Видно, что все столбцы, кроме двух, хранящих идентификаторы, были прочитаны как строки и преобразованы в факторы (номинальные переменные). Это означает, что мы не сможем работать привычным образом со столбцами периметра и площади, а столбец комментариев теперь также является номинальной переменной, что противоречит здравому смыслу (он вообще переменной не является).</p>
<p>Когда вы отображаете таблицу в консоли или графическом интерфейсе, факторы выглядят и ведут себя как обычные строки. Подвох заключается в том, что хранятся они в виде пар “ключ — значение” (об этом мы говорили выше) и все операции преобразования осуществляются <strong>над ключами</strong>, а не значениями. Рассмотрим, как следует правильно преобразовывать номинальные переменные в <strong>R</strong>.</p>
<p>Чтобы привести столбцы к нужному типу, необходимо использовать преобразования типов. Для этого в <strong>R</strong> существует множество функций семейства <code>as(object,class)</code>, где в качестве первого параметра <code>object</code> вы указываете преобразуемый объект, а в качестве второго параметра <code>class</code> — тип, к которому вы хотите его привести. Например:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">s &lt;-<span class="st"> &quot;5456.788&quot;</span>
s <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
## Error in s + 1: нечисловой аргумент для бинарного оператора
n &lt;-<span class="st"> </span><span class="kw">as</span>(s, <span class="st">&quot;numeric&quot;</span>)
## Error in as(s, &quot;numeric&quot;): не могу найти функцию &quot;as&quot;
n <span class="op">+</span><span class="st"> </span><span class="dv">1</span>
## Error in eval(expr, envir, enclos): объект &#39;n&#39; не найден
s &lt;-<span class="st"> </span><span class="kw">as</span>(n, <span class="st">&quot;character&quot;</span>)
## Error in as(n, &quot;character&quot;): не могу найти функцию &quot;as&quot;
s
## [1] &quot;5456.788&quot;
<span class="kw">nchar</span>(s)
## [1] 8</code></pre></div>
<p>На практике обычно пользуются не функцией <code>as()</code>, а ее обертками (<em>wrappers</em>), которые имеют вид <code>as.numeric()</code>, <code>as.character()</code>, <code>as.Date()</code> и так далее:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.numeric</span>(s) <span class="co"># то же самое, что и as(s, &quot;numeric&quot;)</span>
## [1] 5456.788</code></pre></div>
<p>Для начала преобразуем столбец <code>Comment</code> к обычному символьному представлению:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tab<span class="op">$</span>Comment &lt;-<span class="st"> </span><span class="kw">as.character</span>(tab<span class="op">$</span>Comment)
<span class="kw">str</span>(tab)
## &#39;data.frame&#39;:    160 obs. of  6 variables:
##  $ ID            : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ Type          : Factor w/ 12 levels &quot;Выгоны&quot;,&quot;Вырубки&quot;,..: 11 1 1 9 5 1 5 12 9 10 ...
##  $ Administration: Factor w/ 7 levels &quot;&quot;,&quot;РФ&quot;,&quot;Совьяковская администрация&quot;,..: 5 5 5 1 1 5 1 5 5 6 ...
##  $ Comment       : chr  &quot;Село Беницы&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
##  $ Perimeter     : Factor w/ 160 levels &quot;1014.155593894044800&quot;,..: 67 155 51 104 78 153 17 19 108 57 ...
##  $ Area          : Factor w/ 160 levels &quot;0.238070145845919&quot;,..: 73 49 121 100 63 72 88 128 99 24 ...</code></pre></div>
<p>Посмотрим теперь, что произойдет, если мы попытаемся преобразовать столбец <code>Perimeter</code> к числовому виду:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">as.numeric</span>(tab<span class="op">$</span>Perimeter)
##   [1]  67 155  51 104  78 153  17  19 108  57   7   3 158 159 156  50  91
##  [18] 143   6  58   4   5 131 148 113 128 147 114   9  18 118 132  84 134
##  [35]  81  40 130  98  83 157  42  95  71 141   8 100  34   1  87  77 160
##  [52]  93 119  90  74  35 125 150 101 136  31 109 110 103  75  14  32  63
##  [69] 145  56 102  25  65  88  72  53  92  30 117  73  43  54 121  44  52
##  [86]  27 115 149 120  45  26  41   2  60  36 123  29 151 144 106 127  12
## [103] 116  94  82 146 142  69  21  48 139 105 154 124  47  61  33  80  97
## [120]  64  10  76 111  11 112  89  28 129  68  39  49  86  96  59  24 137
## [137]  46 152  55  15  99  85  22 126  16 122  79  66 133  23 107  38 138
## [154]  13 135  37 140  70  20  62</code></pre></div>
<p>Вместо значений перметра мы получили загадочные числа, которых в таблице нет. Это и есть ключи факторов. Чтобы получить их значения, необходимо использовать функцию <code>levels()</code> (для краткости выведем первые 10 значений):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(tab<span class="op">$</span>Perimeter)[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]
##  [1] &quot;1014.155593894044800&quot; &quot;1019.457949256323400&quot; &quot;1020.278536197552200&quot;
##  [4] &quot;1021.109926202218700&quot; &quot;1041.122684298658400&quot; &quot;1060.678503301135200&quot;
##  [7] &quot;1081.964408568060900&quot; &quot;1094.945610298295600&quot; &quot;114.701418496307100&quot; 
## [10] &quot;1155.916232728818800&quot;</code></pre></div>
<p>Обратите внимание на то, что значения фактора отсортированы в алфавитном порядке, без учете порядка их встречаемости в исходной таблице. Для корректного преобразования факторов в числа необходимо сначала привести их к обычному строковому виду:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tab<span class="op">$</span>Perimeter &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(tab<span class="op">$</span>Perimeter))
<span class="kw">str</span>(tab)
## &#39;data.frame&#39;:    160 obs. of  6 variables:
##  $ ID            : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ Type          : Factor w/ 12 levels &quot;Выгоны&quot;,&quot;Вырубки&quot;,..: 11 1 1 9 5 1 5 12 9 10 ...
##  $ Administration: Factor w/ 7 levels &quot;&quot;,&quot;РФ&quot;,&quot;Совьяковская администрация&quot;,..: 5 5 5 1 1 5 1 5 5 6 ...
##  $ Comment       : chr  &quot;Село Беницы&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
##  $ Perimeter     : num  2396 922 2181 3948 279 ...
##  $ Area          : Factor w/ 160 levels &quot;0.238070145845919&quot;,..: 73 49 121 100 63 72 88 128 99 24 ...

<span class="co"># Теперь попробуем преобразовать столбец Area</span>
temp &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(tab<span class="op">$</span>Area))
## Warning: в результате преобразования созданы NA
temp[<span class="dv">1</span><span class="op">:</span><span class="dv">10</span>]
##  [1]  286159.159   21651.964   56826.463  450293.759    2612.615
##  [6]   28608.401 3469445.793   62299.631  450291.261  147943.134</code></pre></div>
<p>Все прошло вроде бы успешно, но с предупреждением, что некоторые значения были преобразованы в <code>NA</code> (<em>Not Available</em>) — отсутствующие значения. По всей видимости, данные в соответствущих ячейках не соответствуют представлениям <strong>R</strong> о том, как должно выглядеть число: ячейка или пустая, или число набрано с ошибкой/опечаткой.</p>
<p>Чтобы найти и исправить все неверно заданные данные, необходимо выполнить следующие действия:</p>
<ol style="list-style-type: decimal">
<li>Получить индексы всех элементов, имеющих значение <code>NA</code>.</li>
<li>Просмотреть, какие значения были в исходных данных под этими индексами</li>
<li>Исправить ошибки в этих значениях, если это поддается автоматизации</li>
<li>Повторить конвертацию в числовой тип данных</li>
</ol>
<p>Проверку на отсутствующие данные осуществляют с помощью функции <code>is.na()</code>. Передав ей в качестве аргумента вектор значений, вы получите вектор булевых значений, в котором <code>TRUE</code> будет стоять для пустых элементов. Проверим с помощью него, какие элементы столюца <code>Area</code> привели к ошибкам конвертации данных:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tab[<span class="kw">is.na</span>(temp), <span class="st">&quot;Area&quot;</span>]
## [1] 89499,573298880117000 11922,638460079328000 5153,570673500797100 
## 160 Levels: 0.238070145845919 ... 9865.323033935605100</code></pre></div>
<p>Видно, что <strong>R</strong> не справился с преобразованием типов там, где содержится опечатка в десятичном разделителе — вместо точки указана запятая.</p>
<p>Для исправления этой ошибки мы можем воспользоваться стандартной функцией замены символа <code>gsub(pattern, replacement, x)</code>. Ее стандартные параметры означают соответственно: что искать, на что заменять, где искать:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tab<span class="op">$</span>Area &lt;-<span class="st"> </span><span class="kw">gsub</span>(<span class="st">&#39;,&#39;</span>, <span class="st">&#39;.&#39;</span>, tab<span class="op">$</span>Area) <span class="co"># заменим запятые на точки</span>
tab<span class="op">$</span>Area &lt;-<span class="st"> </span><span class="kw">as.numeric</span>(<span class="kw">as.character</span>(tab<span class="op">$</span>Area)) <span class="co"># Теперь можно преобразовать в числа</span>
<span class="kw">str</span>(tab)
## &#39;data.frame&#39;:    160 obs. of  6 variables:
##  $ ID            : int  1 2 3 4 5 6 7 8 9 10 ...
##  $ Type          : Factor w/ 12 levels &quot;Выгоны&quot;,&quot;Вырубки&quot;,..: 11 1 1 9 5 1 5 12 9 10 ...
##  $ Administration: Factor w/ 7 levels &quot;&quot;,&quot;РФ&quot;,&quot;Совьяковская администрация&quot;,..: 5 5 5 1 1 5 1 5 5 6 ...
##  $ Comment       : chr  &quot;Село Беницы&quot; &quot;&quot; &quot;&quot; &quot;&quot; ...
##  $ Perimeter     : num  2396 922 2181 3948 279 ...
##  $ Area          : num  286159 21652 56826 450294 2613 ...</code></pre></div>
<p>Теперь необходимо навести порядок в значениях факторов, убедившись, что и там нет опечаток. Выведем все уникальные значения с помощью функции <code>levels()</code>:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">levels</span>(tab<span class="op">$</span>Type)
##  [1] &quot;Выгоны&quot;                        &quot;Вырубки&quot;                      
##  [3] &quot;Гидрологические объекты&quot;       &quot;Заболоченные земли&quot;           
##  [5] &quot;Леса&quot;                          &quot;Лесные поляны&quot;                
##  [7] &quot;Луга&quot;                          &quot;Нет данных&quot;                   
##  [9] &quot;Пашни&quot;                         &quot;Сады&quot;                         
## [11] &quot;Территории населенных пунктов&quot; &quot;Фермерские хозяйства&quot;
<span class="kw">levels</span>(tab<span class="op">$</span>Administration)
## [1] &quot;&quot;                                    
## [2] &quot;РФ&quot;                                  
## [3] &quot;Совьяковская администрация&quot;          
## [4] &quot;Совьяковская сельскаая администрация&quot;
## [5] &quot;Совьяковская сельская администрация&quot; 
## [6] &quot;Совьяковская сельская Администрация&quot; 
## [7] &quot;Совьяковская сельская админитрация&quot;</code></pre></div>
<p>Видно, что если с типами все в порядке, то в данных об административном подчинении содержится 5 вариантов названия одной и той же Совьяковской сельской администрации. Помимо этого, пустые ячейки хорошо бы заменить на значение <code>&quot;Прочее&quot;</code>.</p>
<p>Чтобы найти все строчки, относящиеся к одному и тому же объекту, можно воспользоваться уже знакомой нам функцией <code>grep()</code>, передав ей подстроку, которая является для них общей. Например, <code>&quot;Совьяковская&quot;</code> (хотя в данном случае было бы вообще достаточно одной буквы <code>&quot;с&quot;</code>).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">filter &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;Совьяковская&quot;</span>, tab<span class="op">$</span>Administration) <span class="co"># Найдем все записи</span>
tab[filter, <span class="st">&quot;Administration&quot;</span>] &lt;-<span class="st"> &quot;Совьяковская сельская администрация&quot;</span> <span class="co"># Заменим их одним значением</span>
tab<span class="op">$</span>Administration &lt;-<span class="st"> </span><span class="kw">droplevels</span>(tab<span class="op">$</span>Administration) <span class="co"># Удаляем неиспользуемые уровни</span>
<span class="kw">levels</span>(tab<span class="op">$</span>Administration)
## [1] &quot;&quot;                                   
## [2] &quot;РФ&quot;                                 
## [3] &quot;Совьяковская сельская администрация&quot;</code></pre></div>
<p>Пустые строки можно также найти c помощью <code>grep()</code>, но мы этого делать не будем, так как это требует дополнительных знаний о регулярных выражениях. Вместо этого воспользуемся тем, что пустые строки имеют длину 0. Обратите внимание ниже, что преобразование в вектор столбца <code>Administration</code> необходимо, т.к. <code>nchar()</code> не понимает объекты типа <code>data.frame</code>, которыми являются не только таблицы, но и их столбцы:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">filter &lt;-<span class="st"> </span><span class="kw">nchar</span>(<span class="kw">as.vector</span>(tab<span class="op">$</span>Administration)) <span class="op">==</span><span class="st"> </span><span class="dv">0</span> <span class="co"># TRUE если длина равна 0</span>
<span class="co"># Пробуем заменить:</span>
tab[filter, <span class="st">&quot;Administration&quot;</span>] &lt;-<span class="st"> &quot;Прочее&quot;</span>
## Warning in `[&lt;-.factor`(`*tmp*`, iseq, value = c(&quot;Прочее&quot;, &quot;Прочее&quot;, :
## неправильный уровень фактора, получились NA</code></pre></div>
<p>Ошибка выше связана с тем, что <strong>R</strong> строго следит за неизменностью набора значений фактора для того чтобы избежать всевозможных ошибок при работе с данными (опечаток и т.д.). Предыдущий раз мы заменили все значаниея одним из существующих. В данном случае необходимо ввести новое значение фактора. Чтобы это сделать, придется преобразовать данные в символьные, произвести замену срок и после этого снова конвертировать столбец в фактор:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">tab<span class="op">$</span>Administration &lt;-<span class="st"> </span><span class="kw">as.character</span>(tab<span class="op">$</span>Administration)
tab[filter, <span class="st">&quot;Administration&quot;</span>] &lt;-<span class="st"> &quot;Прочее&quot;</span>
tab<span class="op">$</span>Administration &lt;-<span class="st"> </span><span class="kw">as.factor</span>(tab<span class="op">$</span>Administration)
<span class="kw">levels</span>(tab<span class="op">$</span>Administration)
## [1] &quot;Прочее&quot;                             
## [2] &quot;РФ&quot;                                 
## [3] &quot;Совьяковская сельская администрация&quot;</code></pre></div>
<p>Теперь таблица готова к работе. Можно, например, подсчитать по ней сводную статистику:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">summary</span>(tab)
##        ID                                    Type   
##  Min.   :  1.00   Леса                         :52  
##  1st Qu.: 40.75   Выгоны                       :27  
##  Median : 80.50   Фермерские хозяйства         :22  
##  Mean   : 80.50   Пашни                        :15  
##  3rd Qu.:120.25   Луга                         :11  
##  Max.   :160.00   Территории населенных пунктов: 8  
##                   (Other)                      :25  
##                              Administration   Comment         
##  Прочее                             :76     Length:160        
##  РФ                                 : 3     Class :character  
##  Совьяковская сельская администрация:81     Mode  :character  
##                                                               
##                                                               
##                                                               
##                                                               
##    Perimeter              Area        
##  Min.   :    3.087   Min.   :      0  
##  1st Qu.:  421.431   1st Qu.:   5087  
##  Median :  939.369   Median :  21260  
##  Mean   : 1761.654   Mean   : 125002  
##  3rd Qu.: 2135.987   3rd Qu.:  83019  
##  Max.   :23920.945   Max.   :3469446  
## </code></pre></div>
<p>Обратите внимание, что строки, интервальные и номинальные (факторы) переменные обрабатываются функцией <code>summary()</code> по-разному.</p>
</div>
<div id="table_writing" class="section level2">
<h2><span class="header-section-number">4.8</span> Сохранение таблиц CSV и Microsoft Excel</h2>
<p>Одной из завершающих стадий анализа данных, помимо графиков и отчетов, часто являются новые табличные представления, которые было бы неплохо сохранить в виде файлов. К счастью, сохранение таблиц в <strong>R</strong> столь же просто, как и чтение. Для текстовых файлов в формате <strong>CSV</strong> можно использовать функции <code>write.table()</code>, <code>write.csv()</code> и <code>write.csv2()</code>. Для файлов <strong>Microsoft Excel</strong> используйте функцию <code>write.xlsx()</code> из пакета <code>openxlsx</code> соответственно.</p>
<blockquote>
<p>По умолчанию функции <code>write.table()</code>, <code>write.csv()</code> и <code>write.csv2()</code> записывают в таблицы в качестве первого столбца названия (номера) строк таблиц. Если вы не хотите, чтобы это происходило, укажите дополнительный параметр <code>row.names=FALSE</code>.</p>
</blockquote>
<p>Сохраним таблицы <code>okruga</code> и <code>neokruga</code>, раздельно хранящие статистику по объему сброса сточных в поверхностные водные объекты по федеральным округам и субъектам соответственно:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">write.csv2</span>(okruga, <span class="st">&quot;okruga.csv&quot;</span>, <span class="dt">fileEncoding =</span> <span class="st">&#39;UTF-8&#39;</span>) <span class="co"># Сохраним первую таблицу в CSV в кодировке Unicode</span>
<span class="kw">write.xlsx</span>(neokruga, <span class="st">&quot;neokruga.xlsx&quot;</span>) <span class="co"># Сохраним вторую таблицу в XLSX без названий строк</span>

<span class="co"># Проверим, все ли в порядке с сохраненными таблицами:</span>

okruga.saved &lt;-<span class="st"> </span><span class="kw">read.csv2</span>(<span class="st">&quot;okruga.csv&quot;</span>, <span class="dt">encoding =</span> <span class="st">&#39;UTF-8&#39;</span>)
<span class="kw">head</span>(okruga.saved)
##    X                               Region Year05 Year10 Year11 Year12
## 1  2       Центральный федеральный округ    4341   3761   3613   3651
## 2 21   Северо-Западный федеральный округ    3192   3088   2866   2877
## 3 35             Южный федеральный округ    1409   1446   1436   1394
## 4 42 Северо-Кавказский федеральный округ     496    390    397    395
## 5 49       Приволжский федеральный округ    3162   2883   2857   2854
## 6 64         Уральский федеральный округ    1681   1860   1834   1665
##   Year13
## 1   3570
## 2   2796
## 3   1321
## 4    374
## 5   2849
## 6   1624

neokruga.saved &lt;-<span class="st"> </span><span class="kw">read.xlsx</span>(<span class="st">&quot;neokruga.xlsx&quot;</span>,<span class="dv">1</span>)
<span class="kw">head</span>(neokruga.saved)
##                 Region Year05 Year10 Year11 Year12 Year13
## 1 Белгородская область     11     77     72     71     71
## 2     Брянская область     89     78     75     71     68
## 3 Владимирская область    155    129    126    124    120
## 4  Воронежская область    169    134    135    131    129
## 5   Ивановская область    144    102     99     97     88
## 6    Калужская область     99     92     88     84     93</code></pre></div>
<p>Видно, что в файле <strong>CSV</strong> присутствует также дополнительный столбец с названиями строк, а в файле <strong>XLSX</strong> его нет. Если вы не задавали названия строк явным образом и они не несут какого-то смысла, всегда указывайте параметр <code>row.names=FALSE</code></p>
<blockquote>
<p>Вы можете дать строкам таблицы названия и извлечь их, используя функцию <code>row.names()</code> аналогично функции <code>colnames()</code> для столбцов.</p>
</blockquote>
</div>
<div id="table_rules" class="section level2">
<h2><span class="header-section-number">4.9</span> Правила подготовки таблиц для чтения в R</h2>
<p>С таблицами, которые мы использовали в настоящем модуле, все прошло гладко, поскольку они были подготовлены специальным образом. Несмотря на то, что каких-то четких правил подготовки таблиц для программной обработки не существует, можно дать несколько полезных рекомендаций по данному поводу:</p>
<ol style="list-style-type: decimal">
<li>В первой строке таблицы должны располагаться названия столбцов.</li>
<li>В названиях столбцов недопустимы объединенные ячейки, покрывающие несколько столбцов. Это может привести к неверному подсчету количества столбцов и, как следствие, некорректному чтению таблицы в целом.</li>
<li>Названия столбцов должны состоять из латинских букв и цифр, начинаться с буквы и не содержать пробелов. Сложносочиненные названия выделяйте прописными буквами. Плохое название столбца: <code>Валовый внутренний продукт за 2015 г.</code>. Хорошее название столбца: <code>GDP2015</code>.</li>
<li>Во второй строке таблицы должны начинаться данные. Не допускайте многострочных заголовков.</li>
<li>Некоторые ошибки данных в таблицах (такие как неверные десятичные разделители), проще найти и исправить в табличном/текстовом редакторе, нежели после загрузки в R.</li>
</ol>
<p>Следование этим правилам значительно облегчит работу с табличными данными.</p>
</div>
<div id="questions_tables" class="section level2">
<h2><span class="header-section-number">4.10</span> Контрольные вопросы</h2>
<table>
<tbody>
<tr class="odd">
<td><em>Самсонов Т.Е.</em> <strong>Визуализация и анализ географических данных на языке R.</strong> М.: Географический факультет МГУ, 2017. DOI: 10.5281/zenodo.901911</td>
</tr>
</tbody>
</table>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="matrix-dataframes.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["r-geo-course.pdf", "r-geo-course.epub"],
"toc": {
"collapse": "section",
"edit": "https://github.com/tsamsonov/r-geo-course/edit/master/%s"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(script.src))
      script.src  = script.src.replace(/^https?:/, '');
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
