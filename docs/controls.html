<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>Визуализация и анализ географических данных на языке R</title>
  <meta name="description" content="Курс лекций, посвященных использованию языка программирования R для визуализации и анализа географических данных">
  <meta name="generator" content="bookdown 0.6 and GitBook 2.6.7">

  <meta property="og:title" content="Визуализация и анализ географических данных на языке R" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Курс лекций, посвященных использованию языка программирования R для визуализации и анализа географических данных" />
  <meta name="github-repo" content="tsamsonov/r-geo-course" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Визуализация и анализ географических данных на языке R" />
  
  <meta name="twitter:description" content="Курс лекций, посвященных использованию языка программирования R для визуализации и анализа географических данных" />
  

<meta name="author" content="Тимофей Самсонов">


<meta name="date" content="2018-01-28">

  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="tables.html">
<link rel="next" href="graphics.html">
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/htmlwidgets-1.0/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.3/datatables.js"></script>
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.16/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.16/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>
<script src="libs/plotly-binding-4.7.1/plotly.js"></script>
<script src="libs/typedarray-0.1/typedarray.min.js"></script>
<link href="libs/plotlyjs-1.29.2/plotly-htmlwidgets.css" rel="stylesheet" />
<script src="libs/plotlyjs-1.29.2/plotly-latest.min.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Визуализация и анализ географических данных на языке R</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Введение</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#-"><i class="fa fa-check"></i>Программное обеспечение</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#---"><i class="fa fa-check"></i>Установка и подключение пакетов</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#--"><i class="fa fa-check"></i>Выполнение программного кода</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#--"><i class="fa fa-check"></i>Установка рабочей директории</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#-"><i class="fa fa-check"></i>Диагностические функции</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#-"><i class="fa fa-check"></i>Получение справки</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#d09ad0bed0bcd0bcd0b5d0bdd182d0b0d180d0b8d0b8"><i class="fa fa-check"></i>Комментарии</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#----r"><i class="fa fa-check"></i>Стандарт оформления кода на R</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#-"><i class="fa fa-check"></i>Зарезервированные слова</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#-"><i class="fa fa-check"></i>Названия переменных</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#--"><i class="fa fa-check"></i>Названия специальных символов</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#--"><i class="fa fa-check"></i>Ссылка на пособие</a></li>
</ul></li>
<li class="chapter" data-level="1" data-path="data-types.html"><a href="data-types.html"><i class="fa fa-check"></i><b>1</b> Типы данных, ввод и вывод</a><ul>
<li class="chapter" data-level="1.1" data-path="data-types.html"><a href="data-types.html#numbers"><i class="fa fa-check"></i><b>1.1</b> Числа</a><ul>
<li class="chapter" data-level="1.1.1" data-path="data-types.html"><a href="data-types.html#number_functions"><i class="fa fa-check"></i><b>1.1.1</b> Числовые функции</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="data-types.html"><a href="data-types.html#strings"><i class="fa fa-check"></i><b>1.2</b> Строки</a></li>
<li class="chapter" data-level="1.3" data-path="data-types.html"><a href="data-types.html#dates"><i class="fa fa-check"></i><b>1.3</b> Даты</a></li>
<li class="chapter" data-level="1.4" data-path="data-types.html"><a href="data-types.html#booleans"><i class="fa fa-check"></i><b>1.4</b> Логические</a></li>
<li class="chapter" data-level="1.5" data-path="data-types.html"><a href="data-types.html#determine_data_type"><i class="fa fa-check"></i><b>1.5</b> Определение типа данных</a></li>
<li class="chapter" data-level="1.6" data-path="data-types.html"><a href="data-types.html#---conversion"><i class="fa fa-check"></i><b>1.6</b> Преобразование типов данных {conversion}</a></li>
<li class="chapter" data-level="1.7" data-path="data-types.html"><a href="data-types.html#read_write_console"><i class="fa fa-check"></i><b>1.7</b> Ввод и вывод данных в консоли</a></li>
<li class="chapter" data-level="1.8" data-path="data-types.html"><a href="data-types.html#questions_tasks_basics"><i class="fa fa-check"></i><b>1.8</b> Контрольные вопросы и задачи</a><ul>
<li class="chapter" data-level="1.8.1" data-path="data-types.html"><a href="data-types.html#questions_basics"><i class="fa fa-check"></i><b>1.8.1</b> Вопросы</a></li>
<li class="chapter" data-level="1.8.2" data-path="data-types.html"><a href="data-types.html#tasks_basics"><i class="fa fa-check"></i><b>1.8.2</b> Задачи</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="data-structures.html"><a href="data-structures.html"><i class="fa fa-check"></i><b>2</b> Структуры данных</a><ul>
<li class="chapter" data-level="2.1" data-path="data-structures.html"><a href="data-structures.html#section-2.1"><i class="fa fa-check"></i><b>2.1</b> Векторы</a><ul>
<li class="chapter" data-level="2.1.1" data-path="data-structures.html"><a href="data-structures.html#vector_creation"><i class="fa fa-check"></i><b>2.1.1</b> Создание вектора</a></li>
<li class="chapter" data-level="2.1.2" data-path="data-structures.html"><a href="data-structures.html#vector_elements"><i class="fa fa-check"></i><b>2.1.2</b> Работа с элементами вектора</a></li>
<li class="chapter" data-level="2.1.3" data-path="data-structures.html"><a href="data-structures.html#vector_transform"><i class="fa fa-check"></i><b>2.1.3</b> Анализ и преобразования векторов</a></li>
<li class="chapter" data-level="2.1.4" data-path="data-structures.html"><a href="data-structures.html#vector_search_sorting"><i class="fa fa-check"></i><b>2.1.4</b> Поиск и сортировка элементов</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-structures.html"><a href="data-structures.html#matrices"><i class="fa fa-check"></i><b>2.2</b> Матрицы</a></li>
<li class="chapter" data-level="2.3" data-path="data-structures.html"><a href="data-structures.html#arrays"><i class="fa fa-check"></i><b>2.3</b> Массивы</a></li>
<li class="chapter" data-level="2.4" data-path="data-structures.html"><a href="data-structures.html#data_frames"><i class="fa fa-check"></i><b>2.4</b> Фреймы данных</a></li>
<li class="chapter" data-level="2.5" data-path="data-structures.html"><a href="data-structures.html#lists"><i class="fa fa-check"></i><b>2.5</b> Списки</a></li>
<li class="chapter" data-level="2.6" data-path="data-structures.html"><a href="data-structures.html#section-2.6"><i class="fa fa-check"></i><b>2.6</b> Факторы</a></li>
<li class="chapter" data-level="2.7" data-path="data-structures.html"><a href="data-structures.html#questions_tasks_vectors"><i class="fa fa-check"></i><b>2.7</b> Контрольные вопросы и задачи</a><ul>
<li class="chapter" data-level="2.7.1" data-path="data-structures.html"><a href="data-structures.html#questions_vectors"><i class="fa fa-check"></i><b>2.7.1</b> Вопросы</a></li>
<li class="chapter" data-level="2.7.2" data-path="data-structures.html"><a href="data-structures.html#tasks_vectors"><i class="fa fa-check"></i><b>2.7.2</b> Задачи</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="tables.html"><a href="tables.html"><i class="fa fa-check"></i><b>3</b> Работа с таблицами</a><ul>
<li class="chapter" data-level="3.1" data-path="tables.html"><a href="tables.html#reading_tables"><i class="fa fa-check"></i><b>3.1</b> Чтение таблиц</a><ul>
<li class="chapter" data-level="3.1.1" data-path="tables.html"><a href="tables.html#reading_csv"><i class="fa fa-check"></i><b>3.1.1</b> Таблицы CSV</a></li>
<li class="chapter" data-level="3.1.2" data-path="tables.html"><a href="tables.html#excel_reading"><i class="fa fa-check"></i><b>3.1.2</b> Таблицы Microsoft Excel</a></li>
<li class="chapter" data-level="3.1.3" data-path="tables.html"><a href="tables.html#excel_read_types"><i class="fa fa-check"></i><b>3.1.3</b> Типы данных столбцов</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="tables.html"><a href="tables.html#view_table"><i class="fa fa-check"></i><b>3.2</b> Просмотр таблицы</a></li>
<li class="chapter" data-level="3.3" data-path="tables.html"><a href="tables.html#working_with_columns"><i class="fa fa-check"></i><b>3.3</b> Работа со столбцами</a><ul>
<li class="chapter" data-level="3.3.1" data-path="tables.html"><a href="tables.html#colnames"><i class="fa fa-check"></i><b>3.3.1</b> Названия столбцов</a></li>
<li class="chapter" data-level="3.3.2" data-path="tables.html"><a href="tables.html#col_calling"><i class="fa fa-check"></i><b>3.3.2</b> Обращение к столбцам</a></li>
<li class="chapter" data-level="3.3.3" data-path="tables.html"><a href="tables.html#col_select"><i class="fa fa-check"></i><b>3.3.3</b> Выбор и исключение столбцов</a></li>
<li class="chapter" data-level="3.3.4" data-path="tables.html"><a href="tables.html#----col_add"><i class="fa fa-check"></i><b>3.3.4</b> Добавление и вычисление столбцов {col_add}</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="tables.html"><a href="tables.html#filtering_sorting"><i class="fa fa-check"></i><b>3.4</b> Сортировка и фильтрация</a><ul>
<li class="chapter" data-level="3.4.1" data-path="tables.html"><a href="tables.html#table_sorting"><i class="fa fa-check"></i><b>3.4.1</b> Сортировка</a></li>
<li class="chapter" data-level="3.4.2" data-path="tables.html"><a href="tables.html#table_filtering"><i class="fa fa-check"></i><b>3.4.2</b> Фильтрация</a></li>
</ul></li>
<li class="chapter" data-level="3.5" data-path="tables.html"><a href="tables.html#missed_values"><i class="fa fa-check"></i><b>3.5</b> Пропущенные значения</a></li>
<li class="chapter" data-level="3.6" data-path="tables.html"><a href="tables.html#data_conversion"><i class="fa fa-check"></i><b>3.6</b> Преобразование типов и поиск ошибок</a></li>
<li class="chapter" data-level="3.7" data-path="tables.html"><a href="tables.html#table_writing"><i class="fa fa-check"></i><b>3.7</b> Сохранение таблиц</a></li>
<li class="chapter" data-level="3.8" data-path="tables.html"><a href="tables.html#dplyr"><i class="fa fa-check"></i><b>3.8</b> Обработка таблиц в dplyr</a></li>
<li class="chapter" data-level="3.9" data-path="tables.html"><a href="tables.html#table_rules"><i class="fa fa-check"></i><b>3.9</b> Правила подготовки таблиц для чтения в R</a></li>
<li class="chapter" data-level="3.10" data-path="tables.html"><a href="tables.html#questions_tasks_tables"><i class="fa fa-check"></i><b>3.10</b> Контрольные вопросы и задачи</a><ul>
<li class="chapter" data-level="3.10.1" data-path="tables.html"><a href="tables.html#questions_tables"><i class="fa fa-check"></i><b>3.10.1</b> Вопросы</a></li>
<li class="chapter" data-level="3.10.2" data-path="tables.html"><a href="tables.html#tasks_tables"><i class="fa fa-check"></i><b>3.10.2</b> Задачи</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="controls.html"><a href="controls.html"><i class="fa fa-check"></i><b>4</b> Управление выполнением и векторизованные вычисления</a><ul>
<li class="chapter" data-level="4.1" data-path="controls.html"><a href="controls.html#cycles"><i class="fa fa-check"></i><b>4.1</b> Циклы</a></li>
<li class="chapter" data-level="4.2" data-path="controls.html"><a href="controls.html#ifelse"><i class="fa fa-check"></i><b>4.2</b> Условия</a></li>
<li class="chapter" data-level="4.3" data-path="controls.html"><a href="controls.html#functions"><i class="fa fa-check"></i><b>4.3</b> Функции</a></li>
<li class="chapter" data-level="4.4" data-path="controls.html"><a href="controls.html#vectorized"><i class="fa fa-check"></i><b>4.4</b> Векторизованые вычисления</a></li>
<li class="chapter" data-level="4.5" data-path="controls.html"><a href="controls.html#questions_tasks_controls"><i class="fa fa-check"></i><b>4.5</b> Контрольные вопросы и задачи</a><ul>
<li class="chapter" data-level="4.5.1" data-path="controls.html"><a href="controls.html#questions_controls"><i class="fa fa-check"></i><b>4.5.1</b> Вопросы</a></li>
<li class="chapter" data-level="4.5.2" data-path="controls.html"><a href="controls.html#tasks_controls"><i class="fa fa-check"></i><b>4.5.2</b> Задачи</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="graphics.html"><a href="graphics.html"><i class="fa fa-check"></i><b>5</b> Основы графики в R</a><ul>
<li class="chapter" data-level="5.1" data-path="graphics.html"><a href="graphics.html#yfxcharts"><i class="fa fa-check"></i><b>5.1</b> Стандартные графики</a><ul>
<li class="chapter" data-level="5.1.1" data-path="graphics.html"><a href="graphics.html#scatterplots"><i class="fa fa-check"></i><b>5.1.1</b> Диаграммы рассеяния</a></li>
<li class="chapter" data-level="5.1.2" data-path="graphics.html"><a href="graphics.html#linear_graphs"><i class="fa fa-check"></i><b>5.1.2</b> Линейные графики</a></li>
<li class="chapter" data-level="5.1.3" data-path="graphics.html"><a href="graphics.html#graph_combining"><i class="fa fa-check"></i><b>5.1.3</b> Совмещение графиков</a></li>
<li class="chapter" data-level="5.1.4" data-path="graphics.html"><a href="graphics.html#func_parameters"><i class="fa fa-check"></i><b>5.1.4</b> Функциональные параметры</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="graphics.html"><a href="graphics.html#histograms"><i class="fa fa-check"></i><b>5.2</b> Гистограммы</a></li>
<li class="chapter" data-level="5.3" data-path="graphics.html"><a href="graphics.html#barplots"><i class="fa fa-check"></i><b>5.3</b> Столбчатые графики</a></li>
<li class="chapter" data-level="5.4" data-path="graphics.html"><a href="graphics.html#piecharts"><i class="fa fa-check"></i><b>5.4</b> Круговые (секторные) диаграммы</a></li>
<li class="chapter" data-level="5.5" data-path="graphics.html"><a href="graphics.html#colors"><i class="fa fa-check"></i><b>5.5</b> Цвет и прозрачность</a></li>
<li class="chapter" data-level="5.6" data-path="graphics.html"><a href="graphics.html#disp_settings"><i class="fa fa-check"></i><b>5.6</b> Настройки отображения</a><ul>
<li class="chapter" data-level="5.6.1" data-path="graphics.html"><a href="graphics.html#graph_params"><i class="fa fa-check"></i><b>5.6.1</b> Графические параметры</a></li>
<li class="chapter" data-level="5.6.2" data-path="graphics.html"><a href="graphics.html#axes"><i class="fa fa-check"></i><b>5.6.2</b> Разметка осей, рамка, сетка координат и произвольные линии</a></li>
<li class="chapter" data-level="5.6.3" data-path="graphics.html"><a href="graphics.html#annotations"><i class="fa fa-check"></i><b>5.6.3</b> Аннотации данных (текст на графике)</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="graphics.html"><a href="graphics.html#legend"><i class="fa fa-check"></i><b>5.7</b> Легенда</a></li>
<li class="chapter" data-level="5.8" data-path="graphics.html"><a href="graphics.html#questions_tasks_graphics"><i class="fa fa-check"></i><b>5.8</b> Контрольные вопросы и задачи</a><ul>
<li class="chapter" data-level="5.8.1" data-path="graphics.html"><a href="graphics.html#questions_graphics"><i class="fa fa-check"></i><b>5.8.1</b> Вопросы</a></li>
<li class="chapter" data-level="5.8.2" data-path="graphics.html"><a href="graphics.html#tasks_graphics"><i class="fa fa-check"></i><b>5.8.2</b> Задачи</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="circular.html"><a href="circular.html"><i class="fa fa-check"></i><b>6</b> Круговая статистика и визуализация</a><ul>
<li class="chapter" data-level="6.1" data-path="circular.html"><a href="circular.html#circular-intro"><i class="fa fa-check"></i><b>6.1</b> Введение</a></li>
<li class="chapter" data-level="6.2" data-path="circular.html"><a href="circular.html#circular-stats"><i class="fa fa-check"></i><b>6.2</b> Вычисление статистических моментов</a></li>
<li class="chapter" data-level="6.3" data-path="circular.html"><a href="circular.html#circular-modes"><i class="fa fa-check"></i><b>6.3</b> Определение модальных направлений</a></li>
<li class="chapter" data-level="6.4" data-path="circular.html"><a href="circular.html#circular-stats-vis"><i class="fa fa-check"></i><b>6.4</b> Визуализация круговой статистики</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="spatial-data.html"><a href="spatial-data.html"><i class="fa fa-check"></i><b>7</b> Пространственные данные в R</a><ul>
<li class="chapter" data-level="7.1" data-path="spatial-data.html"><a href="spatial-data.html#spatial_models"><i class="fa fa-check"></i><b>7.1</b> Модели пространственных данных</a><ul>
<li class="chapter" data-level="7.1.1" data-path="spatial-data.html"><a href="spatial-data.html#simple_features"><i class="fa fa-check"></i><b>7.1.1</b> Векторные данные</a></li>
<li class="chapter" data-level="7.1.2" data-path="spatial-data.html"><a href="spatial-data.html#raster_data"><i class="fa fa-check"></i><b>7.1.2</b> Растровые данные</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="spatial-data.html"><a href="spatial-data.html#spatref"><i class="fa fa-check"></i><b>7.2</b> Пространственная привязка</a><ul>
<li class="chapter" data-level="7.2.1" data-path="spatial-data.html"><a href="spatial-data.html#spatref_components"><i class="fa fa-check"></i><b>7.2.1</b> Компоненты пространственной привязки</a></li>
<li class="chapter" data-level="7.2.2" data-path="spatial-data.html"><a href="spatial-data.html#spatref_formats"><i class="fa fa-check"></i><b>7.2.2</b> Форматы описания пространственной привязки</a></li>
<li class="chapter" data-level="7.2.3" data-path="spatial-data.html"><a href="spatial-data.html#spatref_transform"><i class="fa fa-check"></i><b>7.2.3</b> Преобразование координат</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="spatial-data.html"><a href="spatial-data.html#vector_data_r"><i class="fa fa-check"></i><b>7.3</b> Векторные данные</a><ul>
<li class="chapter" data-level="7.3.1" data-path="spatial-data.html"><a href="spatial-data.html#vector_data_packages"><i class="fa fa-check"></i><b>7.3.1</b> Базовые библиотеки</a></li>
<li class="chapter" data-level="7.3.2" data-path="spatial-data.html"><a href="spatial-data.html#vector_data_reading"><i class="fa fa-check"></i><b>7.3.2</b> Чтение</a></li>
<li class="chapter" data-level="7.3.3" data-path="spatial-data.html"><a href="spatial-data.html#sf_structure"><i class="fa fa-check"></i><b>7.3.3</b> Внутренняя структура</a></li>
<li class="chapter" data-level="7.3.4" data-path="spatial-data.html"><a href="spatial-data.html#sf_plotting"><i class="fa fa-check"></i><b>7.3.4</b> Визуализация</a></li>
<li class="chapter" data-level="7.3.5" data-path="spatial-data.html"><a href="spatial-data.html#sf_crs"><i class="fa fa-check"></i><b>7.3.5</b> Системы координат и проекции</a></li>
<li class="chapter" data-level="7.3.6" data-path="spatial-data.html"><a href="spatial-data.html#sf_attrs"><i class="fa fa-check"></i><b>7.3.6</b> Атрибутивные операции</a></li>
<li class="chapter" data-level="7.3.7" data-path="spatial-data.html"><a href="spatial-data.html#sf_spat_selection"><i class="fa fa-check"></i><b>7.3.7</b> Пространственные операции</a></li>
<li class="chapter" data-level="7.3.8" data-path="spatial-data.html"><a href="spatial-data.html#sf_creation"><i class="fa fa-check"></i><b>7.3.8</b> Создание пространственных объектов</a></li>
<li class="chapter" data-level="7.3.9" data-path="spatial-data.html"><a href="spatial-data.html#sf_geom_attrs"><i class="fa fa-check"></i><b>7.3.9</b> Геометрические атрибуты</a></li>
<li class="chapter" data-level="7.3.10" data-path="spatial-data.html"><a href="spatial-data.html#sf_export"><i class="fa fa-check"></i><b>7.3.10</b> Экспорт</a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="spatial-data.html"><a href="spatial-data.html#raster_data_r"><i class="fa fa-check"></i><b>7.4</b> Растровые данные</a><ul>
<li class="chapter" data-level="7.4.1" data-path="spatial-data.html"><a href="spatial-data.html#raster_read"><i class="fa fa-check"></i><b>7.4.1</b> Чтение</a></li>
<li class="chapter" data-level="7.4.2" data-path="spatial-data.html"><a href="spatial-data.html#raster_viz"><i class="fa fa-check"></i><b>7.4.2</b> Визуализация</a></li>
<li class="chapter" data-level="7.4.3" data-path="spatial-data.html"><a href="spatial-data.html#raster_proj"><i class="fa fa-check"></i><b>7.4.3</b> Системы координат и проекции</a></li>
<li class="chapter" data-level="7.4.4" data-path="index.html"><a href="index.html#--"><i class="fa fa-check"></i><b>7.4.4</b> Операции со значениями</a></li>
<li class="chapter" data-level="7.4.5" data-path="spatial-data.html"><a href="spatial-data.html#section-7.4.5"><i class="fa fa-check"></i><b>7.4.5</b> Экспорт</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="thematic-mapping.html"><a href="thematic-mapping.html"><i class="fa fa-check"></i><b>8</b> Тематические карты в R</a><ul>
<li class="chapter" data-level="8.1" data-path="thematic-mapping.html"><a href="thematic-mapping.html#table_join"><i class="fa fa-check"></i><b>8.1</b> Соединение таблиц в R</a></li>
<li class="chapter" data-level="8.2" data-path="thematic-mapping.html"><a href="thematic-mapping.html#data_classify"><i class="fa fa-check"></i><b>8.2</b> Классификация данных</a></li>
<li class="chapter" data-level="8.3" data-path="thematic-mapping.html"><a href="thematic-mapping.html#lattice_maps"><i class="fa fa-check"></i><b>8.3</b> Серии карт lattice</a><ul>
<li class="chapter" data-level="8.3.1" data-path="thematic-mapping.html"><a href="thematic-mapping.html#lattice_choropleth"><i class="fa fa-check"></i><b>8.3.1</b> Картограммы</a></li>
<li class="chapter" data-level="8.3.2" data-path="thematic-mapping.html"><a href="thematic-mapping.html#lattice_diagrams"><i class="fa fa-check"></i><b>8.3.2</b> Картодиграммы</a></li>
<li class="chapter" data-level="8.3.3" data-path="thematic-mapping.html"><a href="thematic-mapping.html#lattice_legends"><i class="fa fa-check"></i><b>8.3.3</b> Легенда и компоновка</a></li>
<li class="chapter" data-level="8.3.4" data-path="thematic-mapping.html"><a href="thematic-mapping.html#lattice_basemap"><i class="fa fa-check"></i><b>8.3.4</b> Элементы картографической основы</a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="thematic-mapping.html"><a href="thematic-mapping.html#raster_maps"><i class="fa fa-check"></i><b>8.4</b> Карты растров</a><ul>
<li class="chapter" data-level="8.4.1" data-path="thematic-mapping.html"><a href="thematic-mapping.html#raster_single_map"><i class="fa fa-check"></i><b>8.4.1</b> Одиночный растр</a></li>
<li class="chapter" data-level="8.4.2" data-path="thematic-mapping.html"><a href="thematic-mapping.html#multiple_raster_map"><i class="fa fa-check"></i><b>8.4.2</b> Серия растров</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="thematic-mapping.html"><a href="thematic-mapping.html#export_graphics"><i class="fa fa-check"></i><b>8.5</b> Экспорт изображения в графический файл</a><ul>
<li class="chapter" data-level="8.5.1" data-path="thematic-mapping.html"><a href="thematic-mapping.html#singlepage_png"><i class="fa fa-check"></i><b>8.5.1</b> Одностраничные файлы PNG</a></li>
<li class="chapter" data-level="8.5.2" data-path="thematic-mapping.html"><a href="thematic-mapping.html#multipage_pdf"><i class="fa fa-check"></i><b>8.5.2</b> Многостраничные файлы PDF</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="vector-analysis.html"><a href="vector-analysis.html"><i class="fa fa-check"></i><b>9</b> Пространственный анализ 1. Векторные методы</a><ul>
<li class="chapter" data-level="9.1" data-path="vector-analysis.html"><a href="vector-analysis.html#spatial_queries"><i class="fa fa-check"></i><b>9.1</b> Пространственные запросы</a><ul>
<li class="chapter" data-level="9.1.1" data-path="vector-analysis.html"><a href="vector-analysis.html#context_objects"><i class="fa fa-check"></i><b>9.1.1</b> Контекстные и целевые объекты</a></li>
<li class="chapter" data-level="9.1.2" data-path="vector-analysis.html"><a href="vector-analysis.html#zones"><i class="fa fa-check"></i><b>9.1.2</b> Зоны окружения объектов</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="vector-analysis.html"><a href="vector-analysis.html#use_case"><i class="fa fa-check"></i><b>9.2</b> Постановка задач и изучение данных</a></li>
<li class="chapter" data-level="9.3" data-path="vector-analysis.html"><a href="vector-analysis.html#distance_analysis"><i class="fa fa-check"></i><b>9.3</b> Анализ расстояний</a></li>
<li class="chapter" data-level="9.4" data-path="vector-analysis.html"><a href="vector-analysis.html#topology_analysis"><i class="fa fa-check"></i><b>9.4</b> Анализ взаимного положения (топологический)</a></li>
<li class="chapter" data-level="9.5" data-path="vector-analysis.html"><a href="vector-analysis.html#absolute_zones"><i class="fa fa-check"></i><b>9.5</b> Анализ абсолютных зон окружения</a></li>
<li class="chapter" data-level="9.6" data-path="vector-analysis.html"><a href="vector-analysis.html#conc_zones"><i class="fa fa-check"></i><b>9.6</b> Анализ конкурентных зон окружения</a></li>
<li class="chapter" data-level="9.7" data-path="vector-analysis.html"><a href="vector-analysis.html#transport_zones"><i class="fa fa-check"></i><b>9.7</b> Анализ зон транспортной доступности</a></li>
<li class="chapter" data-level="9.8" data-path="vector-analysis.html"><a href="vector-analysis.html#routes"><i class="fa fa-check"></i><b>9.8</b> Построение маршрутов и матриц времени движения</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="raster-analysis.html"><a href="raster-analysis.html"><i class="fa fa-check"></i><b>10</b> Пространственный анализ 2. Растровые методы</a><ul>
<li class="chapter" data-level="10.1" data-path="raster-analysis.html"><a href="raster-analysis.html#raster_intro"><i class="fa fa-check"></i><b>10.1</b> Введение</a></li>
<li class="chapter" data-level="10.2" data-path="raster-analysis.html"><a href="raster-analysis.html#raster_local"><i class="fa fa-check"></i><b>10.2</b> Локальные операции</a></li>
<li class="chapter" data-level="10.3" data-path="raster-analysis.html"><a href="raster-analysis.html#raster_focal"><i class="fa fa-check"></i><b>10.3</b> Фокальные операции</a><ul>
<li class="chapter" data-level="10.3.1" data-path="raster-analysis.html"><a href="raster-analysis.html#raster_focal_fixed"><i class="fa fa-check"></i><b>10.3.1</b> Фиксированная окрестность</a></li>
<li class="chapter" data-level="10.3.2" data-path="raster-analysis.html"><a href="raster-analysis.html#raster_focal_extended"><i class="fa fa-check"></i><b>10.3.2</b> Расширенная окрестность</a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="raster-analysis.html"><a href="raster-analysis.html#raster_zonal"><i class="fa fa-check"></i><b>10.4</b> Зональные операции</a></li>
<li class="chapter" data-level="10.5" data-path="raster-analysis.html"><a href="raster-analysis.html#raster_global"><i class="fa fa-check"></i><b>10.5</b> Глобальные операции</a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html"><i class="fa fa-check"></i><b>11</b> Пространственная интерполяция 1. Детерминистические методы</a><ul>
<li class="chapter" data-level="11.1" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_intro"><i class="fa fa-check"></i><b>11.1</b> Введение</a></li>
<li class="chapter" data-level="11.2" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_grid"><i class="fa fa-check"></i><b>11.2</b> Построение сетки</a></li>
<li class="chapter" data-level="11.3" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_methods"><i class="fa fa-check"></i><b>11.3</b> Интерполяционные методы</a><ul>
<li class="chapter" data-level="11.3.1" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_nn"><i class="fa fa-check"></i><b>11.3.1</b> Метод ближайшего соседа (nearest neighbour)</a></li>
<li class="chapter" data-level="11.3.2" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_tin"><i class="fa fa-check"></i><b>11.3.2</b> Интерполяция на основе триангуляции</a></li>
<li class="chapter" data-level="11.3.3" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_idw"><i class="fa fa-check"></i><b>11.3.3</b> Метод обратно взвешенных расстояний (IDW)</a></li>
<li class="chapter" data-level="11.3.4" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_rbf"><i class="fa fa-check"></i><b>11.3.4</b> Метод радиальных базисных функций (РБФ)</a></li>
<li class="chapter" data-level="11.3.5" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#interpolation_bspline"><i class="fa fa-check"></i><b>11.3.5</b> Метод иерархических базисных сплайнов (B-сплайнов)</a></li>
</ul></li>
<li class="chapter" data-level="11.4" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#approximation_methods"><i class="fa fa-check"></i><b>11.4</b> Аппроксимационные методы</a><ul>
<li class="chapter" data-level="11.4.1" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#approximation_global"><i class="fa fa-check"></i><b>11.4.1</b> Глобальный тренд</a></li>
<li class="chapter" data-level="11.4.2" data-path="interpolation-deterministic.html"><a href="interpolation-deterministic.html#approximation_local"><i class="fa fa-check"></i><b>11.4.2</b> Локальный тренд</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="autocorrelation.html"><a href="autocorrelation.html"><i class="fa fa-check"></i><b>12</b> Пространственная статистика 1. Пространственная автокорреляция</a><ul>
<li class="chapter" data-level="12.1" data-path="autocorrelation.html"><a href="autocorrelation.html#autocorrelation_intro"><i class="fa fa-check"></i><b>12.1</b> Введение</a></li>
<li class="chapter" data-level="12.2" data-path="autocorrelation.html"><a href="autocorrelation.html#autocorrelation_neighbors"><i class="fa fa-check"></i><b>12.2</b> Пространственное соседство</a><ul>
<li class="chapter" data-level="12.2.1" data-path="autocorrelation.html"><a href="autocorrelation.html#autocorrelation_neighbors_contguity"><i class="fa fa-check"></i><b>12.2.1</b> Соседи по смежности</a></li>
<li class="chapter" data-level="12.2.2" data-path="autocorrelation.html"><a href="autocorrelation.html#autocorrelation_neighbors_graph"><i class="fa fa-check"></i><b>12.2.2</b> Соседи по графу</a></li>
<li class="chapter" data-level="12.2.3" data-path="autocorrelation.html"><a href="autocorrelation.html#autocorrelation_neighbors_metrics"><i class="fa fa-check"></i><b>12.2.3</b> Соседи по метрике</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="autocorrelation.html"><a href="autocorrelation.html#autocorrelation_weights"><i class="fa fa-check"></i><b>12.3</b> Пространственные веса</a></li>
<li class="chapter" data-level="12.4" data-path="autocorrelation.html"><a href="autocorrelation.html#autocorrelation_measures"><i class="fa fa-check"></i><b>12.4</b> Пространственная автокорреляция</a><ul>
<li class="chapter" data-level="12.4.1" data-path="autocorrelation.html"><a href="autocorrelation.html#autocorrelation_moran"><i class="fa fa-check"></i><b>12.4.1</b> Индекс Морана (Moran’s I)</a></li>
<li class="chapter" data-level="12.4.2" data-path="autocorrelation.html"><a href="autocorrelation.html#autocorrelation_permutation"><i class="fa fa-check"></i><b>12.4.2</b> Перестановочный тест Морана</a></li>
<li class="chapter" data-level="12.4.3" data-path="autocorrelation.html"><a href="autocorrelation.html#autocorrelation_moranscatter"><i class="fa fa-check"></i><b>12.4.3</b> Диаграмма рассеяния Морана</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="autocorrelation.html"><a href="autocorrelation.html#autocorrelation_autoregression"><i class="fa fa-check"></i><b>12.5</b> Пространственная авторегрессия</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://istina.msu.ru/profile/tsamsonov/" target="blank">Тимофей Самсонов</a></li>
<li><a href="https://doi.org/10.5281/zenodo.901911"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.901911.svg" title="DOI"></a><li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Визуализация и анализ географических данных на языке R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="controls" class="section level1">
<h1><span class="header-section-number">Глава 4</span> Управление выполнением и векторизованные вычисления</h1>
<p><a href="https://github.com/tsamsonov/r-geo-course/blob/master/code/05-Controls.R">Программный код главы</a></p>
<p>Данный модуль посвящен введению в работу с управлением выполнением команд в R, а также методами их пакетного выполнения в виде векторизованных вычислений. Мы рассмотрим такие полезные конструкции как циклы, условия, функции, функции семейства <code>apply</code>. Вместе они представляют собой мощное средство для организации сложных технологических схем обработки данных, требующих повторения идентичных операций над каждым элементом множества входных данных, ветвления алгоритма в зависимости от значений переменных, а также структурирования программного кода на автономные блоки команд, выполняющие специфичный набор операций.</p>
<p>Мы рассмотрим управление командами на примере построения графиков.</p>
<div id="cycles" class="section level2">
<h2><span class="header-section-number">4.1</span> Циклы</h2>
<p>Цикл — это разновидность управляющей конструкции, предназначенная для организации многократного исполнения набора инструкций. В R циклы наиболее часто используются для пакетной обработки данных, ввода и вывода. Типичными примерами использования циклов являются чтение множества файлов входных данных, а также построение серий графиков и карт одного типа по различным данным. При этом обработка множества строк таблиц в R обычно организуется не средствами циклов, а средствами функций семейства <a href="http://stat.ethz.ch/R-manual/R-devel/library/base/html/lapply.html"><code>lapply</code></a>, о которых мы поговорим отдельно.</p>
<p>В R, как и во многих других языках программирования, существует несколько вариантов циклов. Первый вид циклов — это конструкция <strong>for</strong> с синтаксисом <code>for (x in X) statement</code>. Она означает, что:</p>
<ul>
<li>переменная <code>x</code> должна пробежать по всем элементам последовательности <code>X</code>. В качестве последовательности может выступать любой вектор или список.</li>
<li>каждый раз, когда <code>x</code> будет присвоено значение очередного элемента из <code>X</code>, будет выполнено выражение <code>statement</code>, которое называют <em>телом цикла</em>. Соответственно, цикл выполнится столько раз, сколько элементов содержится в последовательности <code>X</code>.</li>
</ul>
<blockquote>
<p>Выполнение тела цикла на каждом проходе называют <em>итерацией</em>.</p>
</blockquote>
<p>Например, с помощью цикла можно вывести на экран числа от 1 до 10, по одному с каждой строки:</p>
<div class="sourceCode" id="cb160"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb160-1" data-line-number="1">## ЦИКЛЫ</a>
<a class="sourceLine" id="cb160-2" data-line-number="2"></a>
<a class="sourceLine" id="cb160-3" data-line-number="3"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>) <span class="kw">print</span>(i)</a>
<a class="sourceLine" id="cb160-4" data-line-number="4">## [1] 1</a>
<a class="sourceLine" id="cb160-5" data-line-number="5">## [1] 2</a>
<a class="sourceLine" id="cb160-6" data-line-number="6">## [1] 3</a>
<a class="sourceLine" id="cb160-7" data-line-number="7">## [1] 4</a>
<a class="sourceLine" id="cb160-8" data-line-number="8">## [1] 5</a>
<a class="sourceLine" id="cb160-9" data-line-number="9">## [1] 6</a>
<a class="sourceLine" id="cb160-10" data-line-number="10">## [1] 7</a>
<a class="sourceLine" id="cb160-11" data-line-number="11">## [1] 8</a>
<a class="sourceLine" id="cb160-12" data-line-number="12">## [1] 9</a>
<a class="sourceLine" id="cb160-13" data-line-number="13">## [1] 10</a></code></pre></div>
<p>Если тело цикла содержит более одной инструкции R, оно должно быть заключено в фигурные скобки, иначе выполнится только первое выражение, а оставшиеся будут запущены один раз после выхода из цикла:</p>
<div class="sourceCode" id="cb161"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb161-1" data-line-number="1"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>) {</a>
<a class="sourceLine" id="cb161-2" data-line-number="2">  a &lt;-<span class="st"> </span><span class="kw">factorial</span>(i) <span class="co"># факториал i</span></a>
<a class="sourceLine" id="cb161-3" data-line-number="3">  b &lt;-<span class="st"> </span><span class="kw">exp</span>(i) <span class="co"># e в степени i</span></a>
<a class="sourceLine" id="cb161-4" data-line-number="4">  <span class="kw">print</span>(a<span class="op">/</span>b) <span class="co"># факториал растет быстрее экспоненты</span></a>
<a class="sourceLine" id="cb161-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb161-6" data-line-number="6">## [1] 0.3678794</a>
<a class="sourceLine" id="cb161-7" data-line-number="7">## [1] 0.2706706</a>
<a class="sourceLine" id="cb161-8" data-line-number="8">## [1] 0.2987224</a>
<a class="sourceLine" id="cb161-9" data-line-number="9">## [1] 0.4395753</a>
<a class="sourceLine" id="cb161-10" data-line-number="10">## [1] 0.8085536</a>
<a class="sourceLine" id="cb161-11" data-line-number="11">## [1] 1.784702</a>
<a class="sourceLine" id="cb161-12" data-line-number="12">## [1] 4.595885</a>
<a class="sourceLine" id="cb161-13" data-line-number="13">## [1] 13.52585</a>
<a class="sourceLine" id="cb161-14" data-line-number="14">## [1] 44.78295</a>
<a class="sourceLine" id="cb161-15" data-line-number="15">## [1] 164.7473</a></code></pre></div>
<p>Другой вариант цикла организуется с помощью конструкции <code>while</code>, имеющей синтаксис <code>while (condition) statement</code>. Такая конструкция означает, что тело цикла будет выполняться, пока значение выражения <code>condition</code> (условия) равно <code>TRUE</code>. Как правило, в теле цикла обновляется некоторая переменная, которая участвует в проверке условия, и предполагается, что рано или поздно оно станет равным <code>FALSE</code>, что приведет к выходу из цикла. Например, вышеприведенный цикл, печатающий числа от 1 до 10, можно переписать на <code>while</code> следуюшим образом:</p>
<div class="sourceCode" id="cb162"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb162-1" data-line-number="1">i &lt;-<span class="st"> </span><span class="dv">0</span></a>
<a class="sourceLine" id="cb162-2" data-line-number="2"><span class="cf">while</span>(i <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>) {</a>
<a class="sourceLine" id="cb162-3" data-line-number="3">  i &lt;-<span class="st"> </span>i<span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb162-4" data-line-number="4">  <span class="kw">print</span>(i)</a>
<a class="sourceLine" id="cb162-5" data-line-number="5">}</a>
<a class="sourceLine" id="cb162-6" data-line-number="6">## [1] 1</a>
<a class="sourceLine" id="cb162-7" data-line-number="7">## [1] 2</a>
<a class="sourceLine" id="cb162-8" data-line-number="8">## [1] 3</a>
<a class="sourceLine" id="cb162-9" data-line-number="9">## [1] 4</a>
<a class="sourceLine" id="cb162-10" data-line-number="10">## [1] 5</a>
<a class="sourceLine" id="cb162-11" data-line-number="11">## [1] 6</a>
<a class="sourceLine" id="cb162-12" data-line-number="12">## [1] 7</a>
<a class="sourceLine" id="cb162-13" data-line-number="13">## [1] 8</a>
<a class="sourceLine" id="cb162-14" data-line-number="14">## [1] 9</a>
<a class="sourceLine" id="cb162-15" data-line-number="15">## [1] 10</a></code></pre></div>
<p>Обратите внимание на то, что мы внутри цикла обновляем значение переменной i.</p>
<blockquote>
<p>Увеличение значения переменной цикла называется <em>инкрементом</em>, а уменьшение — <em>декрементом</em></p>
</blockquote>
<p>Одной из самых распространенных ошибок программистов (особенно начинающих, но и професионалы ее не избегают) является забытая инструкция инкремента (или деккремента) переменной цикла, в результате чего цикл становится бесконечным. В этом плане конструкция <code>for</code> более надежна.</p>
<p>Перейдем теперь от искусственных примеров к реальной практике. В качестве исходных данных используем знакомую нам таблицу Росстата по доходам и расходам граждан:</p>
<div class="sourceCode" id="cb163"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb163-1" data-line-number="1"><span class="kw">library</span>(openxlsx)</a>
<a class="sourceLine" id="cb163-2" data-line-number="2"></a>
<a class="sourceLine" id="cb163-3" data-line-number="3"><span class="co"># Чтение данных</span></a>
<a class="sourceLine" id="cb163-4" data-line-number="4"></a>
<a class="sourceLine" id="cb163-5" data-line-number="5">tab &lt;-<span class="st"> </span><span class="kw">read.xlsx</span>(<span class="st">&quot;IncomeConsumption.xlsx&quot;</span>, <span class="dv">1</span>)</a>
<a class="sourceLine" id="cb163-6" data-line-number="6">filter &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;федеральный округ&quot;</span>, tab<span class="op">$</span>Регион)</a>
<a class="sourceLine" id="cb163-7" data-line-number="7">okr &lt;-<span class="st"> </span>tab[filter, ]</a>
<a class="sourceLine" id="cb163-8" data-line-number="8"></a>
<a class="sourceLine" id="cb163-9" data-line-number="9">names &lt;-<span class="st"> </span><span class="kw">sub</span>(<span class="st">&quot;федеральный округ&quot;</span>, <span class="st">&quot;&quot;</span>, okr<span class="op">$</span>Регион)</a>
<a class="sourceLine" id="cb163-10" data-line-number="10"></a>
<a class="sourceLine" id="cb163-11" data-line-number="11">filter&lt;-<span class="kw">grepl</span>(<span class="st">&quot;федеральный округ|Федерация|числе&quot;</span>, tab<span class="op">$</span>Регион)</a>
<a class="sourceLine" id="cb163-12" data-line-number="12">sub &lt;-<span class="st"> </span>tab[<span class="op">!</span>filter, ]</a></code></pre></div>
<p>Например, посмотрим как можно построить столбчатые диаграммы по каждому столбцу таблицы <code>okr</code>:</p>
<div class="sourceCode" id="cb164"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb164-1" data-line-number="1"><span class="co"># Пакетное рисование графиков</span></a>
<a class="sourceLine" id="cb164-2" data-line-number="2"><span class="cf">for</span>(var <span class="cf">in</span> <span class="kw">colnames</span>(okr)[<span class="op">-</span><span class="dv">1</span>]) {</a>
<a class="sourceLine" id="cb164-3" data-line-number="3">  <span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">9</span>,<span class="dv">4</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb164-4" data-line-number="4">  <span class="kw">barplot</span>(okr[,var], </a>
<a class="sourceLine" id="cb164-5" data-line-number="5">          <span class="dt">names.arg =</span> names, </a>
<a class="sourceLine" id="cb164-6" data-line-number="6">          <span class="dt">horiz =</span> <span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb164-7" data-line-number="7">          <span class="dt">las =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb164-8" data-line-number="8">          <span class="dt">main =</span> var,</a>
<a class="sourceLine" id="cb164-9" data-line-number="9">          <span class="dt">col =</span> <span class="st">&quot;steelblue&quot;</span>)</a>
<a class="sourceLine" id="cb164-10" data-line-number="10">}</a></code></pre></div>
<p><img src="04-Controls_files/figure-html4/unnamed-chunk-5-1.png" width="672" /><img src="04-Controls_files/figure-html4/unnamed-chunk-5-2.png" width="672" /><img src="04-Controls_files/figure-html4/unnamed-chunk-5-3.png" width="672" /><img src="04-Controls_files/figure-html4/unnamed-chunk-5-4.png" width="672" /><img src="04-Controls_files/figure-html4/unnamed-chunk-5-5.png" width="672" /><img src="04-Controls_files/figure-html4/unnamed-chunk-5-6.png" width="672" /><img src="04-Controls_files/figure-html4/unnamed-chunk-5-7.png" width="672" /><img src="04-Controls_files/figure-html4/unnamed-chunk-5-8.png" width="672" /></p>
<p>А теперь усложним тело цикла, добавив рисование гистограммы распределения по тому же показателю, но взятому из таблицы <code>sub</code>:</p>
<div class="sourceCode" id="cb165"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb165-1" data-line-number="1"><span class="co"># Пакетное рисование графиков</span></a>
<a class="sourceLine" id="cb165-2" data-line-number="2"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">1</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb165-3" data-line-number="3"><span class="kw">options</span>(<span class="dt">scipen =</span> <span class="dv">999</span>) <span class="co"># запрещаем использовать экспоненциальную форму записи больших чисел</span></a>
<a class="sourceLine" id="cb165-4" data-line-number="4"></a>
<a class="sourceLine" id="cb165-5" data-line-number="5"><span class="cf">for</span>(var <span class="cf">in</span> <span class="kw">colnames</span>(okr)[<span class="op">-</span><span class="dv">1</span>]) {</a>
<a class="sourceLine" id="cb165-6" data-line-number="6">  <span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">9</span>,<span class="dv">4</span>,<span class="dv">3</span>)) <span class="co"># устанавливаем поля для столбчатой диаграммы</span></a>
<a class="sourceLine" id="cb165-7" data-line-number="7">  <span class="kw">barplot</span>(okr[,var], </a>
<a class="sourceLine" id="cb165-8" data-line-number="8">          <span class="dt">names.arg =</span> names, </a>
<a class="sourceLine" id="cb165-9" data-line-number="9">          <span class="dt">horiz =</span> <span class="ot">TRUE</span>, </a>
<a class="sourceLine" id="cb165-10" data-line-number="10">          <span class="dt">las =</span> <span class="dv">1</span>, </a>
<a class="sourceLine" id="cb165-11" data-line-number="11">          <span class="dt">main =</span> var, </a>
<a class="sourceLine" id="cb165-12" data-line-number="12">          <span class="dt">xlab =</span> <span class="st">&quot;По федеральным округам&quot;</span>,</a>
<a class="sourceLine" id="cb165-13" data-line-number="13">          <span class="dt">col =</span> <span class="st">&quot;steelblue&quot;</span>)</a>
<a class="sourceLine" id="cb165-14" data-line-number="14">  <span class="kw">par</span>(<span class="dt">mar =</span> <span class="kw">c</span>(<span class="dv">5</span>,<span class="dv">3</span>,<span class="dv">4</span>,<span class="dv">1</span>)) <span class="co"># устанавливаем поля для гистограммы</span></a>
<a class="sourceLine" id="cb165-15" data-line-number="15">  <span class="kw">hist</span>(sub[,var], <span class="dt">breaks =</span> <span class="dv">12</span>, <span class="dt">col=</span><span class="st">&quot;green&quot;</span>, <span class="dt">main =</span> var, <span class="dt">xlab =</span> <span class="st">&quot;По субъектам&quot;</span>)</a>
<a class="sourceLine" id="cb165-16" data-line-number="16">}</a></code></pre></div>
<p><img src="04-Controls_files/figure-html4/unnamed-chunk-6-1.png" width="672" /><img src="04-Controls_files/figure-html4/unnamed-chunk-6-2.png" width="672" /><img src="04-Controls_files/figure-html4/unnamed-chunk-6-3.png" width="672" /><img src="04-Controls_files/figure-html4/unnamed-chunk-6-4.png" width="672" /><img src="04-Controls_files/figure-html4/unnamed-chunk-6-5.png" width="672" /><img src="04-Controls_files/figure-html4/unnamed-chunk-6-6.png" width="672" /><img src="04-Controls_files/figure-html4/unnamed-chunk-6-7.png" width="672" /><img src="04-Controls_files/figure-html4/unnamed-chunk-6-8.png" width="672" /></p>
</div>
<div id="ifelse" class="section level2">
<h2><span class="header-section-number">4.2</span> Условия</h2>
<p>Проверка условий позволяет осуществлять так называемое ветвление в программе. Ветвление означает, что при определенных условиях (значениях переменных) будет выполнен один программный код, а при других условиях — другой. В R для проверки условий используется условный оператор <strong>if — else if — else</strong> следующего вида:</p>
<pre><code>if (condition) {
  statement1
} else if (condition) {
  statement2
} else {
  statement3
}</code></pre>
<p>Сначала проверяется условие в выражении <code>if (condition)</code>, и если оно истинно, то выполнится вложенный в фигурные скобки программный код <code>statement1</code>, после чего оставшиеся условия не будут проверяться. Если первое условие ложно, программа перейдет к проверке следующего условия <code>else if (condition)</code>. Далее, если оно истинно, то выполнится вложенный код <code>statement2</code>, если нет — проверка переключится на следующее условие и так далее. Заключительный код <code>statement3</code>, следующий за словом <code>else</code>, выполнится только если ложными окажутся все предыдущие условия.</p>
<blockquote>
<p>Конструкций <code>else if</code> может быть произвольное количество, конструкции <code>if</code> и <code>else</code> могут встречаться в условном операторе только один раз, в начале и конце соответственно. При этом условный оператор может состоять только из конструкции <code>if</code>, а <code>else if</code> и <code>else</code> не являются обязательными.</p>
</blockquote>
<p>Например, используя вышеприведенный код с вычислением экспоненты и факториала, можно вывести на экран информацию о том, больше ли экспонента чем факториал на данной итерации цикла:</p>
<div class="sourceCode" id="cb167"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb167-1" data-line-number="1">## УСЛОВИЯ</a>
<a class="sourceLine" id="cb167-2" data-line-number="2"></a>
<a class="sourceLine" id="cb167-3" data-line-number="3"><span class="cf">for</span> (i <span class="cf">in</span> <span class="dv">1</span><span class="op">:</span><span class="dv">10</span>){</a>
<a class="sourceLine" id="cb167-4" data-line-number="4">  a &lt;-<span class="st"> </span><span class="kw">factorial</span>(i) <span class="co"># факториал i</span></a>
<a class="sourceLine" id="cb167-5" data-line-number="5">  b &lt;-<span class="st"> </span><span class="kw">exp</span>(i) <span class="co"># e в степени i</span></a>
<a class="sourceLine" id="cb167-6" data-line-number="6">  ratio &lt;-<span class="st"> </span>a<span class="op">/</span>b <span class="co"># вычисляем отношение экспоненты и факториала</span></a>
<a class="sourceLine" id="cb167-7" data-line-number="7">  </a>
<a class="sourceLine" id="cb167-8" data-line-number="8">  <span class="cf">if</span> (ratio <span class="op">&lt;</span><span class="st"> </span><span class="dv">1</span>){ <span class="co"># если экспонента больше, то...</span></a>
<a class="sourceLine" id="cb167-9" data-line-number="9">    <span class="kw">cat</span>(i,<span class="st">&#39;! &lt; exp(&#39;</span>, i, <span class="st">&#39;)</span><span class="ch">\n</span><span class="st">&#39;</span>, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)</a>
<a class="sourceLine" id="cb167-10" data-line-number="10">  } <span class="cf">else</span> { <span class="co"># в противном случае</span></a>
<a class="sourceLine" id="cb167-11" data-line-number="11">    <span class="kw">cat</span>(i,<span class="st">&#39;! &gt; exp(&#39;</span>, i, <span class="st">&#39;)</span><span class="ch">\n</span><span class="st">&#39;</span>, <span class="dt">sep =</span> <span class="st">&#39;&#39;</span>)</a>
<a class="sourceLine" id="cb167-12" data-line-number="12">  }</a>
<a class="sourceLine" id="cb167-13" data-line-number="13">}</a>
<a class="sourceLine" id="cb167-14" data-line-number="14">## 1! &lt; exp(1)</a>
<a class="sourceLine" id="cb167-15" data-line-number="15">## 2! &lt; exp(2)</a>
<a class="sourceLine" id="cb167-16" data-line-number="16">## 3! &lt; exp(3)</a>
<a class="sourceLine" id="cb167-17" data-line-number="17">## 4! &lt; exp(4)</a>
<a class="sourceLine" id="cb167-18" data-line-number="18">## 5! &lt; exp(5)</a>
<a class="sourceLine" id="cb167-19" data-line-number="19">## 6! &gt; exp(6)</a>
<a class="sourceLine" id="cb167-20" data-line-number="20">## 7! &gt; exp(7)</a>
<a class="sourceLine" id="cb167-21" data-line-number="21">## 8! &gt; exp(8)</a>
<a class="sourceLine" id="cb167-22" data-line-number="22">## 9! &gt; exp(9)</a>
<a class="sourceLine" id="cb167-23" data-line-number="23">## 10! &gt; exp(10)</a></code></pre></div>
<p>Теперь рассмотрим более практическую задачу. В нашем распоряжении имеются данные по среднеклиматическим (за последние 50 лет) температурам на территории юга Европейской части России с разрешением <span class="math inline">\(30&#39;&#39;\)</span> (около 1 км), полученные с портала <a href="http://www.worldclim.org">WorldClim</a>. Необходимо построить гистограммы распределения температур по месяцам года, раскрасив их в различные цвета соответственно среднему значению температуры:</p>
<ul>
<li>Если средняя температура ниже <span class="math inline">\(0^\circ C\)</span>, то цвет гистограммы синий</li>
<li>Если средняя температура от <span class="math inline">\(0^\circ C\)</span> до <span class="math inline">\(10^\circ C\)</span>, то цвет гистограммы желтый</li>
<li>Если средняя температура выше <span class="math inline">\(10^\circ C\)</span>, то цвет гистограммы оранжевый</li>
</ul>
<div class="sourceCode" id="cb168"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb168-1" data-line-number="1"><span class="co"># ПАКЕТНОЕ ЧТЕНИЕ ДАННЫХ</span></a>
<a class="sourceLine" id="cb168-2" data-line-number="2"></a>
<a class="sourceLine" id="cb168-3" data-line-number="3"><span class="kw">library</span>(foreign) <span class="co"># для чтения dbf необходима библиотека foreign</span></a>
<a class="sourceLine" id="cb168-4" data-line-number="4"></a>
<a class="sourceLine" id="cb168-5" data-line-number="5">files &lt;-<span class="st"> </span><span class="kw">list.files</span>(<span class="st">&quot;dbf&quot;</span>) <span class="co"># прочитаем список файлов в директории dbf</span></a>
<a class="sourceLine" id="cb168-6" data-line-number="6"></a>
<a class="sourceLine" id="cb168-7" data-line-number="7">files &lt;-<span class="st"> </span>files[<span class="kw">grep</span>(<span class="st">&quot;.dbf&quot;</span>, files, <span class="dt">fixed =</span> <span class="ot">TRUE</span>)] <span class="co"># отфильтруем файлы с расширением .dbf</span></a>
<a class="sourceLine" id="cb168-8" data-line-number="8"></a>
<a class="sourceLine" id="cb168-9" data-line-number="9">names &lt;-<span class="st"> </span><span class="kw">sub</span>(<span class="st">&quot;.dbf&quot;</span>,<span class="st">&quot;&quot;</span>,files) <span class="co"># получим названия месяцев, избавившись от расширений</span></a>
<a class="sourceLine" id="cb168-10" data-line-number="10"></a>
<a class="sourceLine" id="cb168-11" data-line-number="11">i &lt;-<span class="st"> </span><span class="dv">1</span> <span class="co"># Создадим дополнительно переменную цикла, чтобы выбирать i-е название месяца</span></a>
<a class="sourceLine" id="cb168-12" data-line-number="12"></a>
<a class="sourceLine" id="cb168-13" data-line-number="13"><span class="cf">for</span> (file <span class="cf">in</span> files){ <span class="co"># пройдемся по всем файлам</span></a>
<a class="sourceLine" id="cb168-14" data-line-number="14">  </a>
<a class="sourceLine" id="cb168-15" data-line-number="15">  temp &lt;-<span class="st"> </span><span class="kw">read.dbf</span>(<span class="kw">paste</span>(<span class="st">&quot;dbf/&quot;</span>, file, <span class="dt">sep=</span><span class="st">&#39;&#39;</span>)) <span class="co"># прочитаем текущий файл</span></a>
<a class="sourceLine" id="cb168-16" data-line-number="16">  </a>
<a class="sourceLine" id="cb168-17" data-line-number="17">  tmean &lt;-<span class="st"> </span><span class="kw">mean</span>(temp<span class="op">$</span>Temp) <span class="co"># вычислим среднюю температуру из столбца Temp</span></a>
<a class="sourceLine" id="cb168-18" data-line-number="18">  </a>
<a class="sourceLine" id="cb168-19" data-line-number="19">  hist.col &lt;-<span class="st"> &quot;white&quot;</span> <span class="co"># иницилизируем переменную цвета за пределами условия </span></a>
<a class="sourceLine" id="cb168-20" data-line-number="20">  </a>
<a class="sourceLine" id="cb168-21" data-line-number="21">  <span class="co"># Проверим наше условие</span></a>
<a class="sourceLine" id="cb168-22" data-line-number="22">  <span class="cf">if</span> (tmean <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>){ </a>
<a class="sourceLine" id="cb168-23" data-line-number="23">    hist.col &lt;-<span class="st"> &quot;steelblue&quot;</span></a>
<a class="sourceLine" id="cb168-24" data-line-number="24">  } <span class="cf">else</span> <span class="cf">if</span> (tmean <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>){</a>
<a class="sourceLine" id="cb168-25" data-line-number="25">    hist.col &lt;-<span class="st"> &quot;yellow&quot;</span></a>
<a class="sourceLine" id="cb168-26" data-line-number="26">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb168-27" data-line-number="27">    hist.col &lt;-<span class="st"> &quot;orange&quot;</span></a>
<a class="sourceLine" id="cb168-28" data-line-number="28">  }</a>
<a class="sourceLine" id="cb168-29" data-line-number="29">  </a>
<a class="sourceLine" id="cb168-30" data-line-number="30">  <span class="co"># Построим гистограмму</span></a>
<a class="sourceLine" id="cb168-31" data-line-number="31">  <span class="kw">hist</span>(temp<span class="op">$</span>Temp, </a>
<a class="sourceLine" id="cb168-32" data-line-number="32">       <span class="dt">col =</span> hist.col, </a>
<a class="sourceLine" id="cb168-33" data-line-number="33">       <span class="dt">main =</span> names[i]) <span class="co"># Вот здесь нам нужна дополнительная переменная цикла</span></a>
<a class="sourceLine" id="cb168-34" data-line-number="34">  </a>
<a class="sourceLine" id="cb168-35" data-line-number="35">  <span class="co"># Нанесем линию среднего значения</span></a>
<a class="sourceLine" id="cb168-36" data-line-number="36">  <span class="kw">abline</span>(<span class="dt">v =</span> tmean, </a>
<a class="sourceLine" id="cb168-37" data-line-number="37">         <span class="dt">lwd =</span> <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb168-38" data-line-number="38">         <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>) </a>
<a class="sourceLine" id="cb168-39" data-line-number="39">  </a>
<a class="sourceLine" id="cb168-40" data-line-number="40">  <span class="co"># Подпишем среднюю температуру</span></a>
<a class="sourceLine" id="cb168-41" data-line-number="41">  <span class="kw">text</span>(tmean, </a>
<a class="sourceLine" id="cb168-42" data-line-number="42">       <span class="dv">1000</span>, </a>
<a class="sourceLine" id="cb168-43" data-line-number="43">       <span class="dt">labels =</span> <span class="kw">round</span>(tmean,<span class="dv">1</span>), </a>
<a class="sourceLine" id="cb168-44" data-line-number="44">       <span class="dt">pos =</span> <span class="dv">4</span>, </a>
<a class="sourceLine" id="cb168-45" data-line-number="45">       <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</a>
<a class="sourceLine" id="cb168-46" data-line-number="46">  </a>
<a class="sourceLine" id="cb168-47" data-line-number="47">  i &lt;-<span class="st"> </span>i <span class="op">+</span><span class="st"> </span><span class="dv">1</span> <span class="co"># Не забудем сделать инкремент переменной цикла</span></a>
<a class="sourceLine" id="cb168-48" data-line-number="48">}</a></code></pre></div>
<p><img src="04-Controls_files/figure-html4/unnamed-chunk-8-1.png" width="672" /><img src="04-Controls_files/figure-html4/unnamed-chunk-8-2.png" width="672" /></p>
</div>
<div id="functions" class="section level2">
<h2><span class="header-section-number">4.3</span> Функции</h2>
<p>Функции в R можно использовать для структурирования кода на логически завершенные, автономные фрагменты кода, каждый из которых выполняет конкретную задачу. Чем сильнее разрастается ваш программный код, тем больше проявляется потребность в наличии функций. Функции позволяют использовать один и тот же код в разных местах программы, не повторяя его.</p>
<p>Синтаксис функции выглядит следующим образом:</p>
<pre><code>functionName &lt;- function(parameter1, parameter2, ...){
  ...
  return(result)
}</code></pre>
<p>Функция создается c помощью ключевого слова <code>function</code>, за которым в круглых скобках заключается произвольное количество параметров (столько, сколько вам нужно: от нуля и более). С помощью этих параметров вы сможете передавать внутрь функции значения переменных. Созданной функции необходимо дать имя, используя оператор присвоения <code>&lt;-</code>. После того как выполнится код внутри функции, результат можно вернуть, используя ключевого слово <code>return</code>.</p>
<blockquote>
<p><strong>R</strong> не поддерживает возврат множественных результатов. Если вам необходимо вернуть несколько объектов (переменных, векторов, таблиц и т.д.), создайте список (list), включите в него все возвращаемые объекты и верните из функции этот список.</p>
</blockquote>
<p>В вышеприведенном примере мы использовали проверку условия для того чтобы вычислить рекомендуемый цвет гистограммы. С одной стороны, это некая вспомогательная процедура, не имеющая непосредственного отношения к построению гистограммы. С другой стороны, это полезная процедура, которой мы захотим воспользоваться в дальнейшем — всегда приятно, когда программа тебе с выбором стилей оформления данных<a href="#fn2" class="footnote-ref" id="fnref2"><sup>2</sup></a>.</p>
<p>Оформим выбор цвета в виде функции, которая принимает в каестве параметра число (температуру), а возвращает название цвета.</p>
<div class="sourceCode" id="cb170"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb170-1" data-line-number="1">## ФУНКЦИИ</a>
<a class="sourceLine" id="cb170-2" data-line-number="2"></a>
<a class="sourceLine" id="cb170-3" data-line-number="3"><span class="co"># Создадим функцию, возвращающую цвет в зависимости от температуры</span></a>
<a class="sourceLine" id="cb170-4" data-line-number="4">selectColor &lt;-<span class="st"> </span><span class="cf">function</span>(value) { </a>
<a class="sourceLine" id="cb170-5" data-line-number="5">  hist.col &lt;-<span class="st"> &quot;white&quot;</span></a>
<a class="sourceLine" id="cb170-6" data-line-number="6">  <span class="cf">if</span> (tmean <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>){</a>
<a class="sourceLine" id="cb170-7" data-line-number="7">    hist.col &lt;-<span class="st"> &quot;steelblue&quot;</span></a>
<a class="sourceLine" id="cb170-8" data-line-number="8">  } <span class="cf">else</span> <span class="cf">if</span> (tmean <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>){</a>
<a class="sourceLine" id="cb170-9" data-line-number="9">    hist.col &lt;-<span class="st"> &quot;yellow&quot;</span></a>
<a class="sourceLine" id="cb170-10" data-line-number="10">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb170-11" data-line-number="11">    hist.col &lt;-<span class="st"> &quot;orange&quot;</span></a>
<a class="sourceLine" id="cb170-12" data-line-number="12">  }</a>
<a class="sourceLine" id="cb170-13" data-line-number="13">  <span class="kw">return</span>(hist.col)</a>
<a class="sourceLine" id="cb170-14" data-line-number="14">}</a>
<a class="sourceLine" id="cb170-15" data-line-number="15"></a>
<a class="sourceLine" id="cb170-16" data-line-number="16">i &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb170-17" data-line-number="17"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb170-18" data-line-number="18"></a>
<a class="sourceLine" id="cb170-19" data-line-number="19"><span class="cf">for</span> (file <span class="cf">in</span> files) {</a>
<a class="sourceLine" id="cb170-20" data-line-number="20">  temp &lt;-<span class="st">  </span><span class="kw">read.dbf</span>(file)</a>
<a class="sourceLine" id="cb170-21" data-line-number="21">  tmean &lt;-<span class="st">  </span><span class="kw">mean</span>(temp<span class="op">$</span>Temp)</a>
<a class="sourceLine" id="cb170-22" data-line-number="22">  </a>
<a class="sourceLine" id="cb170-23" data-line-number="23">  <span class="co"># выберем цвет с помощью нашей функции</span></a>
<a class="sourceLine" id="cb170-24" data-line-number="24">  hist.col &lt;-<span class="st"> </span><span class="kw">selectColor</span>(tmean)</a>
<a class="sourceLine" id="cb170-25" data-line-number="25">  </a>
<a class="sourceLine" id="cb170-26" data-line-number="26">  <span class="co"># построим гистограмму</span></a>
<a class="sourceLine" id="cb170-27" data-line-number="27">  <span class="kw">hist</span>(temp<span class="op">$</span>Temp, </a>
<a class="sourceLine" id="cb170-28" data-line-number="28">       <span class="dt">col =</span> hist.col, </a>
<a class="sourceLine" id="cb170-29" data-line-number="29">       <span class="dt">main =</span> names[i])</a>
<a class="sourceLine" id="cb170-30" data-line-number="30">  </a>
<a class="sourceLine" id="cb170-31" data-line-number="31">  <span class="co"># добавим линию среднего</span></a>
<a class="sourceLine" id="cb170-32" data-line-number="32">  <span class="kw">abline</span>(<span class="dt">v =</span> tmean, </a>
<a class="sourceLine" id="cb170-33" data-line-number="33">         <span class="dt">lwd =</span> <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb170-34" data-line-number="34">         <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</a>
<a class="sourceLine" id="cb170-35" data-line-number="35">  </a>
<a class="sourceLine" id="cb170-36" data-line-number="36">  <span class="co"># подпишем среднее</span></a>
<a class="sourceLine" id="cb170-37" data-line-number="37">  <span class="kw">text</span>(tmean, </a>
<a class="sourceLine" id="cb170-38" data-line-number="38">       <span class="dv">1000</span>, </a>
<a class="sourceLine" id="cb170-39" data-line-number="39">       <span class="dt">labels =</span> <span class="kw">round</span>(tmean,<span class="dv">1</span>), </a>
<a class="sourceLine" id="cb170-40" data-line-number="40">       <span class="dt">pos =</span> <span class="dv">4</span>, </a>
<a class="sourceLine" id="cb170-41" data-line-number="41">       <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</a>
<a class="sourceLine" id="cb170-42" data-line-number="42">  i &lt;-<span class="st"> </span>i<span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb170-43" data-line-number="43">}</a></code></pre></div>
<p><img src="04-Controls_files/figure-html4/unnamed-chunk-9-1.png" width="672" /></p>
<p>Усложним задачу, чтобы показать, как работать с несколькими аргументами функции. Например, мы хотим не одноцветные диаграммы, а чтобы цвет менялся плавным градиентом от первого столбика гистограммы до последнего. Соответственно, количество возвращаемых цветов должно быть равно количеству столбиков в гистограмме. Нашей функции не важно, столбики это или нет, но ей надо знать, сколько цветов надо вернуть. Для этого добавим в нее второй параметр <code>ncolors</code>. Это позволит пользователю при желании не задвать этот параметр, если необходим только один цвет.</p>
<div class="sourceCode" id="cb171"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb171-1" data-line-number="1"><span class="co"># ГИСТОГРАММЫ С ГРАДИЕНТОМ</span></a>
<a class="sourceLine" id="cb171-2" data-line-number="2"></a>
<a class="sourceLine" id="cb171-3" data-line-number="3">selectColor2 &lt;-<span class="st"> </span><span class="cf">function</span>(value, ncolors){ <span class="co"># передаем в качестве дополнительного параметра количество цветов</span></a>
<a class="sourceLine" id="cb171-4" data-line-number="4">  hist.col &lt;-<span class="st"> &quot;white&quot;</span></a>
<a class="sourceLine" id="cb171-5" data-line-number="5">  <span class="co"># генерируем ncolors цветов из соответствующей палитры</span></a>
<a class="sourceLine" id="cb171-6" data-line-number="6">  <span class="cf">if</span> (tmean <span class="op">&lt;</span><span class="st"> </span><span class="dv">0</span>){</a>
<a class="sourceLine" id="cb171-7" data-line-number="7">    hist.col &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&quot;darkslateblue&quot;</span>, <span class="st">&quot;steelblue1&quot;</span>))(ncolors)  </a>
<a class="sourceLine" id="cb171-8" data-line-number="8">  } <span class="cf">else</span> <span class="cf">if</span> (tmean <span class="op">&lt;</span><span class="st"> </span><span class="dv">10</span>){</a>
<a class="sourceLine" id="cb171-9" data-line-number="9">    hist.col &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&quot;steelblue1&quot;</span>, <span class="st">&quot;yellow&quot;</span>))(ncolors)</a>
<a class="sourceLine" id="cb171-10" data-line-number="10">  } <span class="cf">else</span> {</a>
<a class="sourceLine" id="cb171-11" data-line-number="11">    hist.col &lt;-<span class="st"> </span><span class="kw">colorRampPalette</span>(<span class="kw">c</span>(<span class="st">&quot;yellow&quot;</span>, <span class="st">&quot;red&quot;</span>))(ncolors)</a>
<a class="sourceLine" id="cb171-12" data-line-number="12">  }</a>
<a class="sourceLine" id="cb171-13" data-line-number="13">  <span class="kw">return</span>(hist.col)</a>
<a class="sourceLine" id="cb171-14" data-line-number="14">}</a>
<a class="sourceLine" id="cb171-15" data-line-number="15"></a>
<a class="sourceLine" id="cb171-16" data-line-number="16">i &lt;-<span class="st"> </span><span class="dv">1</span></a>
<a class="sourceLine" id="cb171-17" data-line-number="17"></a>
<a class="sourceLine" id="cb171-18" data-line-number="18"><span class="kw">par</span>(<span class="dt">mfrow =</span> <span class="kw">c</span>(<span class="dv">2</span>,<span class="dv">2</span>))</a>
<a class="sourceLine" id="cb171-19" data-line-number="19"></a>
<a class="sourceLine" id="cb171-20" data-line-number="20">ncells &lt;-<span class="st"> </span><span class="dv">25</span> <span class="co"># установим фиксированное количество столбцов гистограммы</span></a>
<a class="sourceLine" id="cb171-21" data-line-number="21"></a>
<a class="sourceLine" id="cb171-22" data-line-number="22"><span class="cf">for</span> (file <span class="cf">in</span> files){</a>
<a class="sourceLine" id="cb171-23" data-line-number="23">  temp &lt;-<span class="st"> </span><span class="kw">read.dbf</span>(file)</a>
<a class="sourceLine" id="cb171-24" data-line-number="24">  tmean &lt;-<span class="st"> </span><span class="kw">mean</span>(temp<span class="op">$</span>Temp)</a>
<a class="sourceLine" id="cb171-25" data-line-number="25">  </a>
<a class="sourceLine" id="cb171-26" data-line-number="26">  <span class="co"># получим для раскраски требуемое количество цветов</span></a>
<a class="sourceLine" id="cb171-27" data-line-number="27">  hist.col &lt;-<span class="st"> </span><span class="kw">selectColor2</span>(tmean, ncells)</a>
<a class="sourceLine" id="cb171-28" data-line-number="28">  </a>
<a class="sourceLine" id="cb171-29" data-line-number="29">  <span class="co"># построим гистограмму</span></a>
<a class="sourceLine" id="cb171-30" data-line-number="30">  <span class="kw">hist</span>(temp<span class="op">$</span>Temp, </a>
<a class="sourceLine" id="cb171-31" data-line-number="31">       <span class="dt">col =</span> hist.col, </a>
<a class="sourceLine" id="cb171-32" data-line-number="32">       <span class="dt">main =</span> names[i], </a>
<a class="sourceLine" id="cb171-33" data-line-number="33">       <span class="dt">breaks =</span> ncells)</a>
<a class="sourceLine" id="cb171-34" data-line-number="34">  </a>
<a class="sourceLine" id="cb171-35" data-line-number="35">  <span class="co"># добавим линию среднего</span></a>
<a class="sourceLine" id="cb171-36" data-line-number="36">  <span class="kw">abline</span>(<span class="dt">v =</span> tmean, </a>
<a class="sourceLine" id="cb171-37" data-line-number="37">         <span class="dt">lwd =</span> <span class="dv">2</span>, </a>
<a class="sourceLine" id="cb171-38" data-line-number="38">         <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</a>
<a class="sourceLine" id="cb171-39" data-line-number="39">  </a>
<a class="sourceLine" id="cb171-40" data-line-number="40">  <span class="co"># подпишем среднее</span></a>
<a class="sourceLine" id="cb171-41" data-line-number="41">  <span class="kw">text</span>(tmean, <span class="dv">1000</span>, </a>
<a class="sourceLine" id="cb171-42" data-line-number="42">       <span class="dt">labels =</span> <span class="kw">round</span>(tmean,<span class="dv">1</span>), </a>
<a class="sourceLine" id="cb171-43" data-line-number="43">       <span class="dt">pos =</span> <span class="dv">4</span>, </a>
<a class="sourceLine" id="cb171-44" data-line-number="44">       <span class="dt">col =</span> <span class="st">&quot;red&quot;</span>)</a>
<a class="sourceLine" id="cb171-45" data-line-number="45">  </a>
<a class="sourceLine" id="cb171-46" data-line-number="46">  i &lt;-<span class="st"> </span>i<span class="op">+</span><span class="dv">1</span></a>
<a class="sourceLine" id="cb171-47" data-line-number="47">}</a></code></pre></div>
<p><img src="04-Controls_files/figure-html4/unnamed-chunk-10-1.png" width="672" /></p>
</div>
<div id="vectorized" class="section level2">
<h2><span class="header-section-number">4.4</span> Векторизованые вычисления</h2>
<p>Данные (в том числе географические) практически всегда носят множественный характер и организованы в определенные структуры (см. главу 2). Эта особенность данных выдвигает логичное желание иметь процедуры, которые можно применять к полному набору данных, а не к его отдельным компонентам. Это и есть процедуры векторизованных высчислений.</p>
<p>Предположим, вам необходимо что-то вычислить для каждой строки таблицы, при этом порядок вычисления зависит от содержимого ячеек данной строки. Вы можете организовать подобные вычисления с помощью циклов, однако в <strong>R</strong> существуют специальные функции семейста <code>apply</code>, которые позволяют решать подобные задачи более элегантно и с высокой скоростью. Это достигается за счет того, что функции <code>apply</code> написаны на языке <strong>C</strong> (как и многие другие функции <strong>R</strong>), в то время как при организации цикла ваши данные будут обрабатываться стандартными средствами языка.</p>
<table>
<colgroup>
<col width="12%" />
<col width="87%" />
</colgroup>
<thead>
<tr class="header">
<th>Функция</th>
<th>Назначение</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td><code>apply()</code></td>
<td>применить функцию ко всем строкам или столбцам матрицы</td>
</tr>
<tr class="even">
<td><code>lapply()</code></td>
<td>применить функцию к каждому компоненту вектора или списка и получить результат также в виде списка (<em>l — list</em>)</td>
</tr>
<tr class="odd">
<td><code>sapply()</code></td>
<td>применить функцию к каждому компоненту вектора или списка и получить результат в виде вектора (<em>s — simplify</em>)</td>
</tr>
<tr class="even">
<td><code>vapply()</code></td>
<td>аналогична vapply, но требует явного задания типа данных возвращаемого вектора, за счет чего работает быстрее (<em>v — velocity</em>)</td>
</tr>
<tr class="odd">
<td><code>mapply()</code></td>
<td>применить функцию к каждому компоненту нескольких векторов или списков и вернуть результат в виде списка (<em>m — multivariate</em>)</td>
</tr>
<tr class="even">
<td><code>rapply()</code></td>
<td>применить функцию рекурсивно ко всем элементам переданного списка и вернуть результат в аналогичной структур (<em>r — recursive</em>)</td>
</tr>
<tr class="odd">
<td><code>tapply()</code></td>
<td>применить функцию ко всем компонентам вектора или списка, сгруппировав их по значению переданного фактора</td>
</tr>
</tbody>
</table>
<blockquote>
<p>Функции семейства <code>apply</code>, принимающие на вход списки, могут работать и с фреймами данных. В этом случае фрейм внутри функции будет преобразован с помощью функции <code>as.list()</code> в список, элементами которого являются столбцы (переменные) входного фрейма данных. Данные при этом не потеряются, их типы тоже не изменятся.</p>
</blockquote>
<p>Базовая функция <code>apply()</code> имеет следующие аргументы:</p>
<ul>
<li><code>X</code> — массив любой размерности (включая вектор)</li>
<li><code>MARGIN</code> — измерения по которым необходимо вести вычисления. Для матрицы <code>1</code> означает строку, <code>2</code> означает столбец, <code>c(1, 2)</code> будет означать, что вычисления производятся по всем комбинациям строк и столбцов</li>
<li><code>FUN</code> — функция, которая будет применяться к каждому элементу указанных измерений</li>
</ul>
<p>Рассмотрим, как можно вычислять значения по строкам. У нас есть подготовленная таблица Росстата <a href="http://www.gks.ru/free_doc/new_site/oxrana/tabl/oxr_vibr3.xls">Выбросы в атмосферу загрязняющих веществ, отходящих от стационарных источников, по видам экономической деятельности</a>. Рассчитаем, какой тип источника занимает максимальное и минимальное место среди газообразных и жидких. Обратите внимание, что в первом случае используется заранее созданнаф функция, а во втором мы определяем анонимную функцию непосредственно при вызове <code>apply()</code>:</p>
<div class="sourceCode" id="cb172"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb172-1" data-line-number="1">## ВЕКТОРИЗОВАННЫЕ ВЫЧИСЛЕНИЯ </a>
<a class="sourceLine" id="cb172-2" data-line-number="2"></a>
<a class="sourceLine" id="cb172-3" data-line-number="3"><span class="kw">library</span>(dplyr)</a>
<a class="sourceLine" id="cb172-4" data-line-number="4">## </a>
<a class="sourceLine" id="cb172-5" data-line-number="5">## Присоединяю пакет: &#39;dplyr&#39;</a>
<a class="sourceLine" id="cb172-6" data-line-number="6">## Следующие объекты скрыты от &#39;package:stats&#39;:</a>
<a class="sourceLine" id="cb172-7" data-line-number="7">## </a>
<a class="sourceLine" id="cb172-8" data-line-number="8">##     filter, lag</a>
<a class="sourceLine" id="cb172-9" data-line-number="9">## Следующие объекты скрыты от &#39;package:base&#39;:</a>
<a class="sourceLine" id="cb172-10" data-line-number="10">## </a>
<a class="sourceLine" id="cb172-11" data-line-number="11">##     intersect, setdiff, setequal, union</a>
<a class="sourceLine" id="cb172-12" data-line-number="12">df &lt;-<span class="st"> </span><span class="kw">read.csv2</span>(<span class="st">&quot;atm_emissions.csv&quot;</span>)</a>
<a class="sourceLine" id="cb172-13" data-line-number="13"><span class="kw">head</span>(df)</a>
<a class="sourceLine" id="cb172-14" data-line-number="14">##   YEAR   TOTAL  SOLID   FLGAS     SO     NO     CO     CH    ORG</a>
<a class="sourceLine" id="cb172-15" data-line-number="15">## 1 1992 28207.6 5609.1 22598.5 8171.3 2718.1 6813.0 2583.9 1608.9</a>
<a class="sourceLine" id="cb172-16" data-line-number="16">## 2 1993 24788.3 4746.1 20042.2 7217.9 2462.0 5894.0 2386.7 1604.8</a>
<a class="sourceLine" id="cb172-17" data-line-number="17">## 3 1994 21929.1 3870.2 18058.9 6512.5 2085.2 5140.8 2609.3 1238.0</a>
<a class="sourceLine" id="cb172-18" data-line-number="18">## 4 1995 21269.6 3600.4 17669.2 6424.8 1996.6 5005.6 2735.7 1110.9</a>
<a class="sourceLine" id="cb172-19" data-line-number="19">## 5 1996 20274.1 3233.4 17040.8 6156.7 1920.4 4876.6 2531.3 1161.8</a>
<a class="sourceLine" id="cb172-20" data-line-number="20">## 6 1997 19332.9 3041.8 16291.1 5991.1 1799.7 4653.0 2554.2  989.9</a>
<a class="sourceLine" id="cb172-21" data-line-number="21"></a>
<a class="sourceLine" id="cb172-22" data-line-number="22">find.max &lt;-<span class="st"> </span><span class="cf">function</span>(x) {</a>
<a class="sourceLine" id="cb172-23" data-line-number="23">  <span class="kw">return</span>(<span class="kw">names</span>(x)[<span class="kw">which.max</span>(x)])</a>
<a class="sourceLine" id="cb172-24" data-line-number="24">}</a>
<a class="sourceLine" id="cb172-25" data-line-number="25"></a>
<a class="sourceLine" id="cb172-26" data-line-number="26">df<span class="op">$</span>MAXSRC &lt;-<span class="st"> </span><span class="kw">apply</span>(df[<span class="dv">5</span><span class="op">:</span><span class="dv">9</span>], <span class="dv">1</span>, find.max)</a>
<a class="sourceLine" id="cb172-27" data-line-number="27">df<span class="op">$</span>MINSRC &lt;-<span class="st"> </span><span class="kw">apply</span>(df[<span class="dv">5</span><span class="op">:</span><span class="dv">9</span>], <span class="dv">1</span>, <span class="cf">function</span>(x) <span class="kw">names</span>(x)[<span class="kw">which.min</span>(x)])</a>
<a class="sourceLine" id="cb172-28" data-line-number="28"></a>
<a class="sourceLine" id="cb172-29" data-line-number="29"><span class="kw">print</span>(df)</a>
<a class="sourceLine" id="cb172-30" data-line-number="30">##    YEAR   TOTAL  SOLID   FLGAS     SO     NO     CO     CH    ORG MAXSRC</a>
<a class="sourceLine" id="cb172-31" data-line-number="31">## 1  1992 28207.6 5609.1 22598.5 8171.3 2718.1 6813.0 2583.9 1608.9     SO</a>
<a class="sourceLine" id="cb172-32" data-line-number="32">## 2  1993 24788.3 4746.1 20042.2 7217.9 2462.0 5894.0 2386.7 1604.8     SO</a>
<a class="sourceLine" id="cb172-33" data-line-number="33">## 3  1994 21929.1 3870.2 18058.9 6512.5 2085.2 5140.8 2609.3 1238.0     SO</a>
<a class="sourceLine" id="cb172-34" data-line-number="34">## 4  1995 21269.6 3600.4 17669.2 6424.8 1996.6 5005.6 2735.7 1110.9     SO</a>
<a class="sourceLine" id="cb172-35" data-line-number="35">## 5  1996 20274.1 3233.4 17040.8 6156.7 1920.4 4876.6 2531.3 1161.8     SO</a>
<a class="sourceLine" id="cb172-36" data-line-number="36">## 6  1997 19332.9 3041.8 16291.1 5991.1 1799.7 4653.0 2554.2  989.9     SO</a>
<a class="sourceLine" id="cb172-37" data-line-number="37">## 7  1998 18661.8 2864.4 15797.4 5679.3 1753.3 4562.9 2571.6  921.9     SO</a>
<a class="sourceLine" id="cb172-38" data-line-number="38">## 8  1999 18539.7 2768.4 15771.2 5505.5 1716.4 4663.9 2767.7  831.0     SO</a>
<a class="sourceLine" id="cb172-39" data-line-number="39">## 9  2000 18819.8 2972.2 15847.6 5407.1 1698.4 4997.9 2685.4  850.4     SO</a>
<a class="sourceLine" id="cb172-40" data-line-number="40">## 10 2001 19123.6 2973.2 16150.4 5254.0 1678.9 5148.1 2723.6 1130.8     SO</a>
<a class="sourceLine" id="cb172-41" data-line-number="41">## 11 2002 19481.2 2882.8 16598.4 4987.4 1646.2 5857.5 2733.2 1164.8     CO</a>
<a class="sourceLine" id="cb172-42" data-line-number="42">## 12 2003 19829.4 2868.0 16961.4 4959.6 1661.8 5929.4 2834.1 1356.5     CO</a>
<a class="sourceLine" id="cb172-43" data-line-number="43">## 13 2004 20491.3 2855.7 17635.6 4768.4 1628.9 6774.4 2786.8 1448.2     CO</a>
<a class="sourceLine" id="cb172-44" data-line-number="44">## 14 2005 20425.4 2802.0 17623.3 4675.0 1666.8 6521.2 2868.1 1650.6     CO</a>
<a class="sourceLine" id="cb172-45" data-line-number="45">## 15 2006 20568.4 2842.8 17725.6 4764.7 1703.1 6338.3 2815.0 1863.1     CO</a>
<a class="sourceLine" id="cb172-46" data-line-number="46">## 16 2007 20636.9 2743.4 17893.5 4573.1 1732.8 6448.4 2992.4 1908.6     CO</a>
<a class="sourceLine" id="cb172-47" data-line-number="47">## 17 2008 20103.3 2704.2 17399.0 4534.1 1816.6 6091.5 3217.5 1532.0     CO</a>
<a class="sourceLine" id="cb172-48" data-line-number="48">## 18 2009 19021.2 2341.1 16680.1 4370.6 1730.5 5500.5 3347.3 1546.0     CO</a>
<a class="sourceLine" id="cb172-49" data-line-number="49">## 19 2010 19115.6 2381.2 16734.4 4385.3 1855.2 5565.1 3135.9 1605.3     CO</a>
<a class="sourceLine" id="cb172-50" data-line-number="50">## 20 2011 19162.3 2283.1 16879.2 4342.7 1880.0 5753.5 3105.8 1622.8     CO</a>
<a class="sourceLine" id="cb172-51" data-line-number="51">## 21 2012 19630.3 2249.4 17380.9 4340.9 1937.5 6001.8 3293.3 1638.2     CO</a>
<a class="sourceLine" id="cb172-52" data-line-number="52">## 22 2013 18446.5 2008.5 16438.0 4173.3 1874.2 5350.9 3424.8 1455.8     CO</a>
<a class="sourceLine" id="cb172-53" data-line-number="53">## 23 2014 17451.9 1922.2 15529.7 4036.3 1805.5 4938.4 3251.0 1340.0     CO</a>
<a class="sourceLine" id="cb172-54" data-line-number="54">## 24 2015 17295.7 1820.4 15475.3 4099.4 1787.4 4799.6 3323.0 1294.5     CO</a>
<a class="sourceLine" id="cb172-55" data-line-number="55">## 25 2016 17349.3 1723.9 15625.4 4011.4 1830.1 4907.1 3406.1 1304.6     CO</a>
<a class="sourceLine" id="cb172-56" data-line-number="56">##    MINSRC</a>
<a class="sourceLine" id="cb172-57" data-line-number="57">## 1     ORG</a>
<a class="sourceLine" id="cb172-58" data-line-number="58">## 2     ORG</a>
<a class="sourceLine" id="cb172-59" data-line-number="59">## 3     ORG</a>
<a class="sourceLine" id="cb172-60" data-line-number="60">## 4     ORG</a>
<a class="sourceLine" id="cb172-61" data-line-number="61">## 5     ORG</a>
<a class="sourceLine" id="cb172-62" data-line-number="62">## 6     ORG</a>
<a class="sourceLine" id="cb172-63" data-line-number="63">## 7     ORG</a>
<a class="sourceLine" id="cb172-64" data-line-number="64">## 8     ORG</a>
<a class="sourceLine" id="cb172-65" data-line-number="65">## 9     ORG</a>
<a class="sourceLine" id="cb172-66" data-line-number="66">## 10    ORG</a>
<a class="sourceLine" id="cb172-67" data-line-number="67">## 11    ORG</a>
<a class="sourceLine" id="cb172-68" data-line-number="68">## 12    ORG</a>
<a class="sourceLine" id="cb172-69" data-line-number="69">## 13    ORG</a>
<a class="sourceLine" id="cb172-70" data-line-number="70">## 14    ORG</a>
<a class="sourceLine" id="cb172-71" data-line-number="71">## 15     NO</a>
<a class="sourceLine" id="cb172-72" data-line-number="72">## 16     NO</a>
<a class="sourceLine" id="cb172-73" data-line-number="73">## 17    ORG</a>
<a class="sourceLine" id="cb172-74" data-line-number="74">## 18    ORG</a>
<a class="sourceLine" id="cb172-75" data-line-number="75">## 19    ORG</a>
<a class="sourceLine" id="cb172-76" data-line-number="76">## 20    ORG</a>
<a class="sourceLine" id="cb172-77" data-line-number="77">## 21    ORG</a>
<a class="sourceLine" id="cb172-78" data-line-number="78">## 22    ORG</a>
<a class="sourceLine" id="cb172-79" data-line-number="79">## 23    ORG</a>
<a class="sourceLine" id="cb172-80" data-line-number="80">## 24    ORG</a>
<a class="sourceLine" id="cb172-81" data-line-number="81">## 25    ORG</a></code></pre></div>
<p>Другие функции семейства <code>apply</code> в приложении к фреймам данных будут работать со столбцами (переменными), интерпретируя их как элементы списка. Наиболее часто из них используются <code>lapply()</code>, <code>sapply()</code> и <code>vapply()</code>.В отличие от <code>apply()</code>, они уже не принимаеют номера измерений и работают только с элементами переданного списка. Например, мы можем посчитать среднее значение экономического показателя по каждой переменной в таблице округов. Поскольку функция среднего уже есть в составе базовых средств <code>R</code>, достаточно указать ее при вызове <code>sapply()</code>:</p>
<div class="sourceCode" id="cb173"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb173-1" data-line-number="1"><span class="kw">sapply</span>(okr, mean)</a>
<a class="sourceLine" id="cb173-2" data-line-number="2">## Warning in mean.default(X[[i]], ...): аргумент не является числовым или</a>
<a class="sourceLine" id="cb173-3" data-line-number="3">## логическим: возвращаю NA</a>
<a class="sourceLine" id="cb173-4" data-line-number="4">##       Регион      Площадь    Население   Трудящиеся        Доход </a>
<a class="sourceLine" id="cb173-5" data-line-number="5">##           NA     2137.287    17958.362     8487.625    25077.125 </a>
<a class="sourceLine" id="cb173-6" data-line-number="6">##      Расходы     Зарплата          ВРП       Активы </a>
<a class="sourceLine" id="cb173-7" data-line-number="7">##    18338.375    28976.375  6239994.875 16690191.375</a></code></pre></div>
<p>В данном случае для первого столбца было возвращено значение <code>NA</code>, что логично, поскольку он имеет строковый тип.</p>
<p>В качестве альтернативы функциям <code>apply</code> можно также воспользоваться вычислениями посредством функций семейства <code>map</code> из пакета <code>purrr</code> (еще один пакет из <a href="https://www.tidyverse.org/packages/">tidyverse</a>). Эти функции работают аналогично <code>lapply()</code> и поддерживают последовательности с помощью пайп-оператора:</p>
<ul>
<li><code>map()</code> возвращает список.</li>
<li><code>map_lgl()</code> возвращает вектор логических значений.</li>
<li><code>map_int()</code> возвращает вектор целочисленных значений.</li>
<li><code>map_dbl()</code> возвращает вектор чисел с плавающей точкой.</li>
<li><code>map_chr()</code> возвращает вектор строк.</li>
</ul>
<p>Например, предыдущая задача с помощью <code>purrr</code> решались бы так:</p>
<div class="sourceCode" id="cb174"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb174-1" data-line-number="1"><span class="kw">library</span>(purrr)</a>
<a class="sourceLine" id="cb174-2" data-line-number="2"><span class="kw">map_dbl</span>(okr, mean)</a>
<a class="sourceLine" id="cb174-3" data-line-number="3">## Warning in mean.default(.x[[i]], ...): аргумент не является числовым или</a>
<a class="sourceLine" id="cb174-4" data-line-number="4">## логическим: возвращаю NA</a>
<a class="sourceLine" id="cb174-5" data-line-number="5">##       Регион      Площадь    Население   Трудящиеся        Доход </a>
<a class="sourceLine" id="cb174-6" data-line-number="6">##           NA     2137.287    17958.362     8487.625    25077.125 </a>
<a class="sourceLine" id="cb174-7" data-line-number="7">##      Расходы     Зарплата          ВРП       Активы </a>
<a class="sourceLine" id="cb174-8" data-line-number="8">##    18338.375    28976.375  6239994.875 16690191.375</a></code></pre></div>
</div>
<div id="questions_tasks_controls" class="section level2">
<h2><span class="header-section-number">4.5</span> Контрольные вопросы и задачи</h2>
<ol style="list-style-type: decimal">
<li>Что такое цикл и для каких сценариев обработки данных могут быть полезны циклы?</li>
<li>Перечислите несколько способов организации циклов в <strong>R</strong>, необходимые ключевые слова и параметры.</li>
<li>Что такое инкремент и декремент?</li>
<li>Какое ключевое слово позволяет прервать цикл и выйти из него принудительно?</li>
<li>Какое ключевое слово позволяет прекратить текущую итерацию цикла и перейти сразу к новой итерации?</li>
<li>Являются ли необходимыми фигурные скобки в случае когда цикл или условный оператор содержит только одно выражение? Что говорит об этом стиль программирования на <strong>R</strong>?</li>
<li>Что такое условный оператор и для каких сценариев обработки данных необходимы условные операторы?</li>
<li>Перечислите ключевые слова, которые могут быть использованы для организации условных операторов</li>
<li>Что такое функция и для каких сценариев обработки данных могут быть полезны функции?</li>
<li>Может ли функция возвращать более одного значения? Что необходимо сделать, чтобы реализовать такую возможность?</li>
<li>Что такое векторизованные вычисления?</li>
<li>Перечислите функции семейства <code>apply</code> и задачи, которые они позволяют решить.</li>
<li>Какая функция семейства <code>apply</code> позволяет выполнять вычисления не только по столбцам, но и по строкам?</li>
<li>Можно ли передавать в функции семейства <code>apply</code> фреймы данных? Если да, то как интерпретируются такие данные?</li>
<li>Какой пакет <strong>R</strong> позволяет выполнять векторизованные вычисления в более простой и быстрой форме, чем функции семейства <code>apply</code>? Можно ли с помощью него выполнять вычисления по строкам?</li>
</ol>
<div id="questions_controls" class="section level3">
<h3><span class="header-section-number">4.5.1</span> Вопросы</h3>
</div>
<div id="tasks_controls" class="section level3">
<h3><span class="header-section-number">4.5.2</span> Задачи</h3>
<table>
<tbody>
<tr class="odd">
<td><em>Самсонов Т.Е.</em> <strong>Визуализация и анализ географических данных на языке R.</strong> М.: Географический факультет МГУ, 2017. DOI: 10.5281/zenodo.901911</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<div class="footnotes">
<hr />
<ol start="2">
<li id="fn2"><p>в картографии это называется “smart mapping”, что переводят как “умное картографирование”, хотя это и не самый удачный вариант перевода<a href="controls.html#fnref2" class="footnote-back">↩</a></p></li>
</ol>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="tables.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="graphics.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": ["r-geo-course.pdf", "r-geo-course.epub"],
"toc": {
"collapse": "section",
"edit": "https://github.com/tsamsonov/r-geo-course/edit/master/%s"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
